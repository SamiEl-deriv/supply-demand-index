<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>mvapi &mdash; API Testing Automation Project 0.0.1 documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=92fd9be5" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css?v=19f00094" />
      <link rel="stylesheet" type="text/css" href="../_static/custom.css?v=948e7bc5" />

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../_static/jquery.js?v=5d32c60e"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="../_static/documentation_options.js?v=d45e8c67"></script>
        <script src="../_static/doctools.js?v=9a2dae69"></script>
        <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            API Testing Automation Project
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <!-- Local TOC -->
              <div class="local-toc"></div>
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">API Testing Automation Project</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="index.html">Module code</a></li>
      <li class="breadcrumb-item active">mvapi</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for mvapi</h1><div class="highlight"><pre>
<span></span><span class="ch">#!/usr/bin/env python</span>
<span class="c1"># coding: utf-8</span>

<span class="kn">from</span> <span class="nn">IPython.display</span> <span class="kn">import</span> <span class="n">display</span><span class="p">,</span> <span class="n">clear_output</span>
<span class="kn">import</span> <span class="nn">json</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">import</span> <span class="nn">websocket</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">scipy.stats</span> <span class="kn">import</span> <span class="n">norm</span>
<span class="kn">from</span> <span class="nn">scipy.optimize</span> <span class="kn">import</span> <span class="n">fsolve</span>
<span class="kn">import</span> <span class="nn">random</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">yaml</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span>
<span class="kn">from</span> <span class="nn">scipy.special</span> <span class="kn">import</span> <span class="n">betainc</span>
<span class="kn">import</span> <span class="nn">tkinter</span> <span class="k">as</span> <span class="nn">tk</span>
<span class="kn">from</span> <span class="nn">tkinter</span> <span class="kn">import</span> <span class="n">ttk</span>
<span class="kn">import</span> <span class="nn">inspect</span>
<span class="kn">from</span> <span class="nn">tabulate</span> <span class="kn">import</span> <span class="n">tabulate</span>

<div class="viewcode-block" id="convert_np_types">
<a class="viewcode-back" href="../index.html#mvapi.convert_np_types">[docs]</a>
<span class="k">def</span> <span class="nf">convert_np_types</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">any</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Converts NumPy types to native Python types for serialization.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    obj : any</span>
<span class="sd">        The object to be converted.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    any</span>
<span class="sd">        The converted object, compatible with JSON serialization.</span>

<span class="sd">    Raises</span>
<span class="sd">    ------</span>
<span class="sd">    TypeError</span>
<span class="sd">        If the object type is not serializable.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">integer</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">int_</span><span class="p">)):</span>
        <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">floating</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float_</span><span class="p">)):</span>
        <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">bool_</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">bool</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">obj</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>  <span class="c1"># Convert numpy arrays to lists</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Type </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span><span class="si">}</span><span class="s2"> not serializable&quot;</span><span class="p">)</span></div>

        
<div class="viewcode-block" id="MvapiGUI">
<a class="viewcode-back" href="../index.html#mvapi.MvapiGUI">[docs]</a>
<span class="k">class</span> <span class="nc">MvapiGUI</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Graphical User Interface (GUI) for managing the MVAPI interactions.</span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">    master : Tk</span>
<span class="sd">        The main Tkinter root window.</span>
<span class="sd">    Product : object</span>
<span class="sd">        The product object associated with the GUI.</span>
<span class="sd">    api_token : str</span>
<span class="sd">        API token for WebSocket communication.</span>
<span class="sd">    &quot;&quot;&quot;</span>
<div class="viewcode-block" id="MvapiGUI.__init__">
<a class="viewcode-back" href="../index.html#mvapi.MvapiGUI.__init__">[docs]</a>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">master</span><span class="p">,</span> <span class="n">product</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initializes the GUI with the given master window and product.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        master : Tk</span>
<span class="sd">            The Tkinter root window.</span>
<span class="sd">        product : bool or object</span>
<span class="sd">            The product to associate with the GUI. If False, defaults to the Accumulator instance.</span>
<span class="sd">        &quot;&quot;&quot;</span>        
        <span class="bp">self</span><span class="o">.</span><span class="n">master</span> <span class="o">=</span> <span class="n">master</span>
        <span class="n">master</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;MVAPI GUI&quot;</span><span class="p">)</span>
        <span class="n">master</span><span class="o">.</span><span class="n">geometry</span><span class="p">(</span><span class="s2">&quot;1600x1000&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">product</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Product</span> <span class="o">=</span> <span class="n">Accumulator</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Product</span> <span class="o">=</span> <span class="n">product</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">api_token</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">create_frames</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">create_api_frame</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">create_endpoint_frame</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">create_button_frame</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">create_product_dropdown</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">create_check_dropdown</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">create_param_frames</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">create_output_frame</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">create_export_subframe</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">create_status_bar</span><span class="p">()</span></div>


<div class="viewcode-block" id="MvapiGUI.create_frames">
<a class="viewcode-back" href="../index.html#mvapi.MvapiGUI.create_frames">[docs]</a>
    <span class="k">def</span> <span class="nf">create_frames</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Creates the left and right frames for the GUI, with scrolling support in the left frame.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Create a canvas and scrollbar for the left frame with defined width</span>
        <span class="n">left_frame_canvas</span> <span class="o">=</span> <span class="n">tk</span><span class="o">.</span><span class="n">Canvas</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">master</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">300</span><span class="p">)</span>  <span class="c1"># Set a fixed width for left frame canvas</span>
        <span class="c1"># Create the right frame as usual, ensuring it fills the remaining space</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">right_frame</span> <span class="o">=</span> <span class="n">tk</span><span class="o">.</span><span class="n">Frame</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">master</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">right_frame</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">side</span><span class="o">=</span><span class="n">tk</span><span class="o">.</span><span class="n">RIGHT</span><span class="p">,</span> <span class="n">expand</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">fill</span><span class="o">=</span><span class="n">tk</span><span class="o">.</span><span class="n">BOTH</span><span class="p">,</span> <span class="n">padx</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span> <span class="n">pady</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>

        <span class="c1"># Scrollbar for left frame canvas</span>
        <span class="n">left_scrollbar</span> <span class="o">=</span> <span class="n">tk</span><span class="o">.</span><span class="n">Scrollbar</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">master</span><span class="p">,</span> <span class="n">orient</span><span class="o">=</span><span class="s2">&quot;vertical&quot;</span><span class="p">,</span> <span class="n">command</span><span class="o">=</span><span class="n">left_frame_canvas</span><span class="o">.</span><span class="n">yview</span><span class="p">)</span>
        <span class="n">left_frame_canvas</span><span class="o">.</span><span class="n">configure</span><span class="p">(</span><span class="n">yscrollcommand</span><span class="o">=</span><span class="n">left_scrollbar</span><span class="o">.</span><span class="n">set</span><span class="p">)</span>

        <span class="c1"># Pack the scrollbar and left frame canvas side by side</span>
        <span class="n">left_scrollbar</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">side</span><span class="o">=</span><span class="n">tk</span><span class="o">.</span><span class="n">LEFT</span><span class="p">,</span> <span class="n">fill</span><span class="o">=</span><span class="n">tk</span><span class="o">.</span><span class="n">Y</span><span class="p">)</span>
        <span class="n">left_frame_canvas</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">side</span><span class="o">=</span><span class="n">tk</span><span class="o">.</span><span class="n">LEFT</span><span class="p">,</span> <span class="n">fill</span><span class="o">=</span><span class="n">tk</span><span class="o">.</span><span class="n">BOTH</span><span class="p">,</span> <span class="n">expand</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>  <span class="c1"># Set expand to False</span>

        <span class="c1"># Create an internal frame for widgets within the left frame canvas</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">left_frame</span> <span class="o">=</span> <span class="n">tk</span><span class="o">.</span><span class="n">Frame</span><span class="p">(</span><span class="n">left_frame_canvas</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">left_frame</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span>
            <span class="s2">&quot;&lt;Configure&gt;&quot;</span><span class="p">,</span>
            <span class="k">lambda</span> <span class="n">e</span><span class="p">:</span> <span class="n">left_frame_canvas</span><span class="o">.</span><span class="n">configure</span><span class="p">(</span><span class="n">scrollregion</span><span class="o">=</span><span class="n">left_frame_canvas</span><span class="o">.</span><span class="n">bbox</span><span class="p">(</span><span class="s2">&quot;all&quot;</span><span class="p">))</span>
        <span class="p">)</span>

        <span class="c1"># Add the frame to the canvas</span>
        <span class="n">left_frame_canvas</span><span class="o">.</span><span class="n">create_window</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">window</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">left_frame</span><span class="p">,</span> <span class="n">anchor</span><span class="o">=</span><span class="s2">&quot;nw&quot;</span><span class="p">)</span>

        <span class="c1"># Smooth scrolling setup</span>
        <span class="k">def</span> <span class="nf">on_mouse_wheel</span><span class="p">(</span><span class="n">event</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">num</span> <span class="o">==</span> <span class="mi">5</span> <span class="ow">or</span> <span class="n">event</span><span class="o">.</span><span class="n">delta</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">left_frame_canvas</span><span class="o">.</span><span class="n">yview_scroll</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;units&quot;</span><span class="p">)</span>  <span class="c1"># Scroll down</span>
            <span class="k">elif</span> <span class="n">event</span><span class="o">.</span><span class="n">num</span> <span class="o">==</span> <span class="mi">4</span> <span class="ow">or</span> <span class="n">event</span><span class="o">.</span><span class="n">delta</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">left_frame_canvas</span><span class="o">.</span><span class="n">yview_scroll</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;units&quot;</span><span class="p">)</span>  <span class="c1"># Scroll up</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">left_frame</span><span class="o">.</span><span class="n">bind_all</span><span class="p">(</span><span class="s2">&quot;&lt;MouseWheel&gt;&quot;</span><span class="p">,</span> <span class="n">on_mouse_wheel</span><span class="p">)</span>   <span class="c1"># For Windows</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">left_frame</span><span class="o">.</span><span class="n">bind_all</span><span class="p">(</span><span class="s2">&quot;&lt;Button-4&gt;&quot;</span><span class="p">,</span> <span class="n">on_mouse_wheel</span><span class="p">)</span>     <span class="c1"># For Linux, scroll up</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">left_frame</span><span class="o">.</span><span class="n">bind_all</span><span class="p">(</span><span class="s2">&quot;&lt;Button-5&gt;&quot;</span><span class="p">,</span> <span class="n">on_mouse_wheel</span><span class="p">)</span>     <span class="c1"># For Linux, scroll down</span></div>


<div class="viewcode-block" id="MvapiGUI.create_api_frame">
<a class="viewcode-back" href="../index.html#mvapi.MvapiGUI.create_api_frame">[docs]</a>
    <span class="k">def</span> <span class="nf">create_api_frame</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Creates the API Token frame where tokens can be entered, saved, or deleted.</span>
<span class="sd">        &quot;&quot;&quot;</span>        
        <span class="n">api_frame</span> <span class="o">=</span> <span class="n">tk</span><span class="o">.</span><span class="n">Frame</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">left_frame</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
        <span class="n">api_frame</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">fill</span><span class="o">=</span><span class="n">tk</span><span class="o">.</span><span class="n">X</span><span class="p">,</span> <span class="n">padx</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">pady</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>

        <span class="n">tk</span><span class="o">.</span><span class="n">Label</span><span class="p">(</span><span class="n">api_frame</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="s2">&quot;API Token:&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">anchor</span><span class="o">=</span><span class="n">tk</span><span class="o">.</span><span class="n">W</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">api_entry</span> <span class="o">=</span> <span class="n">tk</span><span class="o">.</span><span class="n">Entry</span><span class="p">(</span><span class="n">api_frame</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">api_entry</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">anchor</span><span class="o">=</span><span class="n">tk</span><span class="o">.</span><span class="n">W</span><span class="p">)</span>

        <span class="n">button_container</span> <span class="o">=</span> <span class="n">tk</span><span class="o">.</span><span class="n">Frame</span><span class="p">(</span><span class="n">api_frame</span><span class="p">)</span>
        <span class="n">button_container</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">anchor</span><span class="o">=</span><span class="n">tk</span><span class="o">.</span><span class="n">W</span><span class="p">,</span> <span class="n">pady</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>

        <span class="n">tk</span><span class="o">.</span><span class="n">Button</span><span class="p">(</span><span class="n">button_container</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="s2">&quot;Save&quot;</span><span class="p">,</span> <span class="n">command</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">set_api_token</span><span class="p">)</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">side</span><span class="o">=</span><span class="n">tk</span><span class="o">.</span><span class="n">LEFT</span><span class="p">,</span> <span class="n">padx</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
        <span class="n">tk</span><span class="o">.</span><span class="n">Button</span><span class="p">(</span><span class="n">button_container</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="s2">&quot;Delete&quot;</span><span class="p">,</span> <span class="n">command</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">delete_api_token</span><span class="p">)</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">side</span><span class="o">=</span><span class="n">tk</span><span class="o">.</span><span class="n">LEFT</span><span class="p">)</span></div>


<div class="viewcode-block" id="MvapiGUI.create_endpoint_frame">
<a class="viewcode-back" href="../index.html#mvapi.MvapiGUI.create_endpoint_frame">[docs]</a>
    <span class="k">def</span> <span class="nf">create_endpoint_frame</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Creates a frame for managing the WebSocket endpoint.</span>
<span class="sd">        &quot;&quot;&quot;</span>        
        <span class="n">endpoint_frame</span> <span class="o">=</span> <span class="n">tk</span><span class="o">.</span><span class="n">Frame</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">left_frame</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
        <span class="n">endpoint_frame</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">fill</span><span class="o">=</span><span class="n">tk</span><span class="o">.</span><span class="n">X</span><span class="p">,</span> <span class="n">padx</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">pady</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>

        <span class="n">tk</span><span class="o">.</span><span class="n">Label</span><span class="p">(</span><span class="n">endpoint_frame</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="s2">&quot;Endpoint:&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">anchor</span><span class="o">=</span><span class="n">tk</span><span class="o">.</span><span class="n">W</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">endpoint_entry</span> <span class="o">=</span> <span class="n">tk</span><span class="o">.</span><span class="n">Entry</span><span class="p">(</span><span class="n">endpoint_frame</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">endpoint_entry</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">anchor</span><span class="o">=</span><span class="n">tk</span><span class="o">.</span><span class="n">W</span><span class="p">)</span>

        <span class="n">button_container</span> <span class="o">=</span> <span class="n">tk</span><span class="o">.</span><span class="n">Frame</span><span class="p">(</span><span class="n">endpoint_frame</span><span class="p">)</span>
        <span class="n">button_container</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">anchor</span><span class="o">=</span><span class="n">tk</span><span class="o">.</span><span class="n">W</span><span class="p">,</span> <span class="n">pady</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>

        <span class="n">tk</span><span class="o">.</span><span class="n">Button</span><span class="p">(</span><span class="n">button_container</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="s2">&quot;Save&quot;</span><span class="p">,</span> <span class="n">command</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">set_endpoint</span><span class="p">)</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">side</span><span class="o">=</span><span class="n">tk</span><span class="o">.</span><span class="n">LEFT</span><span class="p">,</span> <span class="n">padx</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span></div>

        
<div class="viewcode-block" id="MvapiGUI.create_button_frame">
<a class="viewcode-back" href="../index.html#mvapi.MvapiGUI.create_button_frame">[docs]</a>
    <span class="k">def</span> <span class="nf">create_button_frame</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Creates buttons for buying, proposing, and managing contracts.</span>
<span class="sd">        &quot;&quot;&quot;</span>        
        <span class="n">button_frame</span> <span class="o">=</span> <span class="n">tk</span><span class="o">.</span><span class="n">Frame</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">left_frame</span><span class="p">)</span>
        <span class="n">button_frame</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">fill</span><span class="o">=</span><span class="n">tk</span><span class="o">.</span><span class="n">X</span><span class="p">,</span> <span class="n">padx</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">pady</span><span class="o">=</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span>

        <span class="n">tk</span><span class="o">.</span><span class="n">Button</span><span class="p">(</span><span class="n">button_frame</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="s2">&quot;Buy Contract&quot;</span><span class="p">,</span> <span class="n">command</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">buy_contract</span><span class="p">)</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">fill</span><span class="o">=</span><span class="n">tk</span><span class="o">.</span><span class="n">X</span><span class="p">,</span> <span class="n">pady</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
        <span class="n">tk</span><span class="o">.</span><span class="n">Button</span><span class="p">(</span><span class="n">button_frame</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="s2">&quot;Price Proposal&quot;</span><span class="p">,</span> <span class="n">command</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">price_proposal</span><span class="p">)</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">fill</span><span class="o">=</span><span class="n">tk</span><span class="o">.</span><span class="n">X</span><span class="p">,</span> <span class="n">pady</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
        <span class="n">tk</span><span class="o">.</span><span class="n">Button</span><span class="p">(</span><span class="n">button_frame</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="s2">&quot;Sell Contract&quot;</span><span class="p">,</span> <span class="n">command</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">sell_contract</span><span class="p">)</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">fill</span><span class="o">=</span><span class="n">tk</span><span class="o">.</span><span class="n">X</span><span class="p">,</span> <span class="n">pady</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
        <span class="n">tk</span><span class="o">.</span><span class="n">Button</span><span class="p">(</span><span class="n">button_frame</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="s2">&quot;Sell All Contracts&quot;</span><span class="p">,</span> <span class="n">command</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">sell_all</span><span class="p">)</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">fill</span><span class="o">=</span><span class="n">tk</span><span class="o">.</span><span class="n">X</span><span class="p">,</span> <span class="n">pady</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span></div>


<div class="viewcode-block" id="MvapiGUI.create_product_dropdown">
<a class="viewcode-back" href="../index.html#mvapi.MvapiGUI.create_product_dropdown">[docs]</a>
    <span class="k">def</span> <span class="nf">create_product_dropdown</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Creates a dropdown to select different product types.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">product_types</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Accumulator&#39;</span><span class="p">,</span> <span class="s1">&#39;Turbo&#39;</span><span class="p">,</span> <span class="s1">&#39;Vanilla&#39;</span><span class="p">,</span> <span class="s1">&#39;RiseFall&#39;</span><span class="p">,</span> <span class="s1">&#39;Multiplier&#39;</span><span class="p">]</span>
        <span class="n">tk</span><span class="o">.</span><span class="n">Label</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">left_frame</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="s2">&quot;Available Product Types&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">pack</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">product_box</span> <span class="o">=</span> <span class="n">ttk</span><span class="o">.</span><span class="n">Combobox</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">left_frame</span><span class="p">,</span> <span class="n">values</span><span class="o">=</span><span class="n">product_types</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">product_box</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">fill</span><span class="o">=</span><span class="n">tk</span><span class="o">.</span><span class="n">X</span><span class="p">,</span> <span class="n">padx</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">product_box</span><span class="o">.</span><span class="n">current</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">product_box</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="s1">&#39;&lt;&lt;ComboboxSelected&gt;&gt;&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">change_product</span><span class="p">)</span></div>


<div class="viewcode-block" id="MvapiGUI.create_check_dropdown">
<a class="viewcode-back" href="../index.html#mvapi.MvapiGUI.create_check_dropdown">[docs]</a>
    <span class="k">def</span> <span class="nf">create_check_dropdown</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Creates a dropdown to select available check functions for the product.</span>
<span class="sd">        &quot;&quot;&quot;</span>        
        <span class="n">tk</span><span class="o">.</span><span class="n">Label</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">left_frame</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="s2">&quot;Available Check Functions&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">pack</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">check_box</span> <span class="o">=</span> <span class="n">ttk</span><span class="o">.</span><span class="n">Combobox</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">left_frame</span><span class="p">,</span> <span class="n">values</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">get_check_options</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">check_box</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">fill</span><span class="o">=</span><span class="n">tk</span><span class="o">.</span><span class="n">X</span><span class="p">,</span> <span class="n">padx</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">check_box</span><span class="o">.</span><span class="n">current</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span></div>


<div class="viewcode-block" id="MvapiGUI.create_param_frames">
<a class="viewcode-back" href="../index.html#mvapi.MvapiGUI.create_param_frames">[docs]</a>
    <span class="k">def</span> <span class="nf">create_param_frames</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Creates frames for user input parameters and check function parameters.</span>
<span class="sd">        &quot;&quot;&quot;</span>        
        <span class="bp">self</span><span class="o">.</span><span class="n">check_param_frame</span> <span class="o">=</span> <span class="n">tk</span><span class="o">.</span><span class="n">Frame</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">left_frame</span><span class="p">,</span> <span class="n">bd</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">relief</span><span class="o">=</span><span class="n">tk</span><span class="o">.</span><span class="n">SOLID</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">check_param_frame</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">fill</span><span class="o">=</span><span class="n">tk</span><span class="o">.</span><span class="n">BOTH</span><span class="p">,</span> <span class="n">pady</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">0</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">param_frame</span> <span class="o">=</span> <span class="n">tk</span><span class="o">.</span><span class="n">Frame</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">left_frame</span><span class="p">,</span> <span class="n">bd</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">relief</span><span class="o">=</span><span class="n">tk</span><span class="o">.</span><span class="n">SOLID</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">param_frame</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">expand</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">fill</span><span class="o">=</span><span class="n">tk</span><span class="o">.</span><span class="n">BOTH</span><span class="p">,</span> <span class="n">pady</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">0</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">update_check_params</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_check_input_params</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_user_input_params</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_user_input_params</span><span class="p">())</span></div>


<div class="viewcode-block" id="MvapiGUI.create_output_frame">
<a class="viewcode-back" href="../index.html#mvapi.MvapiGUI.create_output_frame">[docs]</a>
    <span class="k">def</span> <span class="nf">create_output_frame</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Creates a text output frame with scrollable functionality.</span>
<span class="sd">        &quot;&quot;&quot;</span>        
        <span class="n">output_frame</span> <span class="o">=</span> <span class="n">tk</span><span class="o">.</span><span class="n">Frame</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">right_frame</span><span class="p">,</span> <span class="n">bd</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">relief</span><span class="o">=</span><span class="n">tk</span><span class="o">.</span><span class="n">SOLID</span><span class="p">)</span>
        <span class="n">output_frame</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">side</span><span class="o">=</span><span class="n">tk</span><span class="o">.</span><span class="n">BOTTOM</span><span class="p">,</span> <span class="n">fill</span><span class="o">=</span><span class="n">tk</span><span class="o">.</span><span class="n">BOTH</span><span class="p">,</span> <span class="n">expand</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">tk</span><span class="o">.</span><span class="n">Label</span><span class="p">(</span><span class="n">output_frame</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="s2">&quot;Output&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">anchor</span><span class="o">=</span><span class="n">tk</span><span class="o">.</span><span class="n">N</span><span class="p">,</span> <span class="n">padx</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">pady</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">output_text</span> <span class="o">=</span> <span class="n">tk</span><span class="o">.</span><span class="n">Text</span><span class="p">(</span><span class="n">output_frame</span><span class="p">,</span> <span class="n">font</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;Menlo&quot;</span><span class="p">,</span> <span class="mi">14</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">output_text</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">expand</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">fill</span><span class="o">=</span><span class="n">tk</span><span class="o">.</span><span class="n">BOTH</span><span class="p">)</span></div>

        
<div class="viewcode-block" id="MvapiGUI.create_export_subframe">
<a class="viewcode-back" href="../index.html#mvapi.MvapiGUI.create_export_subframe">[docs]</a>
    <span class="k">def</span> <span class="nf">create_export_subframe</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Creates a subframe for exporting data to a file.</span>
<span class="sd">        &quot;&quot;&quot;</span>        
        <span class="c1"># Create a subframe within the output frame</span>
        <span class="n">export_frame</span> <span class="o">=</span> <span class="n">tk</span><span class="o">.</span><span class="n">Frame</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">right_frame</span><span class="p">,</span> <span class="n">bd</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">relief</span><span class="o">=</span><span class="n">tk</span><span class="o">.</span><span class="n">SOLID</span><span class="p">)</span>
        <span class="n">export_frame</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">side</span><span class="o">=</span><span class="n">tk</span><span class="o">.</span><span class="n">BOTTOM</span><span class="p">,</span> <span class="n">fill</span><span class="o">=</span><span class="n">tk</span><span class="o">.</span><span class="n">X</span><span class="p">)</span><span class="c1">#, expand=True)</span>

        <span class="c1"># Input for file name</span>
        <span class="n">tk</span><span class="o">.</span><span class="n">Label</span><span class="p">(</span><span class="n">export_frame</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="s2">&quot;File Name:&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">side</span><span class="o">=</span><span class="n">tk</span><span class="o">.</span><span class="n">LEFT</span><span class="p">,</span> <span class="n">padx</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">filename_entry</span> <span class="o">=</span> <span class="n">tk</span><span class="o">.</span><span class="n">Entry</span><span class="p">(</span><span class="n">export_frame</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">filename_entry</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">side</span><span class="o">=</span><span class="n">tk</span><span class="o">.</span><span class="n">LEFT</span><span class="p">,</span> <span class="n">padx</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>

        <span class="c1"># Dropdown for timestamp option</span>
        <span class="n">tk</span><span class="o">.</span><span class="n">Label</span><span class="p">(</span><span class="n">export_frame</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="s2">&quot;Save Timestamp:&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">side</span><span class="o">=</span><span class="n">tk</span><span class="o">.</span><span class="n">LEFT</span><span class="p">,</span> <span class="n">padx</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">timestamp_var</span> <span class="o">=</span> <span class="n">tk</span><span class="o">.</span><span class="n">StringVar</span><span class="p">()</span>
        <span class="n">timestamp_dropdown</span> <span class="o">=</span> <span class="n">ttk</span><span class="o">.</span><span class="n">Combobox</span><span class="p">(</span><span class="n">export_frame</span><span class="p">,</span> <span class="n">textvariable</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">timestamp_var</span><span class="p">,</span> <span class="n">values</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;Yes&quot;</span><span class="p">,</span> <span class="s2">&quot;No&quot;</span><span class="p">],</span> <span class="n">width</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
        <span class="n">timestamp_dropdown</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">side</span><span class="o">=</span><span class="n">tk</span><span class="o">.</span><span class="n">LEFT</span><span class="p">,</span> <span class="n">padx</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
        <span class="n">timestamp_dropdown</span><span class="o">.</span><span class="n">current</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>  <span class="c1"># Default to &quot;No&quot;</span>

        <span class="c1"># Button for exporting data</span>
        <span class="n">export_button</span> <span class="o">=</span> <span class="n">tk</span><span class="o">.</span><span class="n">Button</span><span class="p">(</span><span class="n">export_frame</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="s2">&quot;Export Data&quot;</span><span class="p">,</span> <span class="n">command</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">export_data_action</span><span class="p">)</span>
        <span class="n">export_button</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">side</span><span class="o">=</span><span class="n">tk</span><span class="o">.</span><span class="n">LEFT</span><span class="p">,</span> <span class="n">padx</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span></div>

        
<div class="viewcode-block" id="MvapiGUI.create_status_bar">
<a class="viewcode-back" href="../index.html#mvapi.MvapiGUI.create_status_bar">[docs]</a>
    <span class="k">def</span> <span class="nf">create_status_bar</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Creates a status bar at the bottom of the application to display API-related statuses.</span>
<span class="sd">        &quot;&quot;&quot;</span>        
        <span class="n">status_frame</span> <span class="o">=</span> <span class="n">tk</span><span class="o">.</span><span class="n">Frame</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">left_frame</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
        <span class="n">status_frame</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">side</span><span class="o">=</span><span class="n">tk</span><span class="o">.</span><span class="n">BOTTOM</span><span class="p">,</span> <span class="n">fill</span><span class="o">=</span><span class="n">tk</span><span class="o">.</span><span class="n">X</span><span class="p">,</span> <span class="n">padx</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">pady</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span>
        <span class="n">tk</span><span class="o">.</span><span class="n">Label</span><span class="p">(</span><span class="n">status_frame</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="s2">&quot;Status: &quot;</span><span class="p">)</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">side</span><span class="o">=</span><span class="n">tk</span><span class="o">.</span><span class="n">LEFT</span><span class="p">,</span> <span class="n">anchor</span><span class="o">=</span><span class="n">tk</span><span class="o">.</span><span class="n">W</span><span class="p">,</span> <span class="n">pady</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">status_output</span> <span class="o">=</span> <span class="n">tk</span><span class="o">.</span><span class="n">Label</span><span class="p">(</span><span class="n">status_frame</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="s2">&quot;API Token not set.&quot;</span><span class="p">,</span> <span class="n">anchor</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">status_output</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">side</span><span class="o">=</span><span class="n">tk</span><span class="o">.</span><span class="n">LEFT</span><span class="p">,</span> <span class="n">fill</span><span class="o">=</span><span class="n">tk</span><span class="o">.</span><span class="n">X</span><span class="p">)</span></div>


<div class="viewcode-block" id="MvapiGUI.set_api_token">
<a class="viewcode-back" href="../index.html#mvapi.MvapiGUI.set_api_token">[docs]</a>
    <span class="k">def</span> <span class="nf">set_api_token</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Saves the given API token and attempts authorization.</span>
<span class="sd">        &quot;&quot;&quot;</span>        
        <span class="bp">self</span><span class="o">.</span><span class="n">api_token</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">api_entry</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Product</span><span class="o">.</span><span class="n">api_token</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">api_token</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_status</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;API Token set to: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">api_token</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_output</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Product</span><span class="o">.</span><span class="n">last_msg</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span></div>


<div class="viewcode-block" id="MvapiGUI.set_endpoint">
<a class="viewcode-back" href="../index.html#mvapi.MvapiGUI.set_endpoint">[docs]</a>
    <span class="k">def</span> <span class="nf">set_endpoint</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Saves and updates the WebSocket endpoint.</span>
<span class="sd">        &quot;&quot;&quot;</span>        
        <span class="bp">self</span><span class="o">.</span><span class="n">endpoint</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">endpoint_entry</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Product</span><span class="o">.</span><span class="n">endpoint</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">endpoint</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_status</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Endpoint changed.&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_output</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Product</span><span class="o">.</span><span class="n">last_msg</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span></div>

        
<div class="viewcode-block" id="MvapiGUI.delete_api_token">
<a class="viewcode-back" href="../index.html#mvapi.MvapiGUI.delete_api_token">[docs]</a>
    <span class="k">def</span> <span class="nf">delete_api_token</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Deletes the currently saved API token and resets connection.</span>
<span class="sd">        &quot;&quot;&quot;</span>        
        <span class="bp">self</span><span class="o">.</span><span class="n">api_token</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Product</span><span class="o">.</span><span class="n">api_token</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">api_token</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Product</span><span class="o">.</span><span class="n">create_ws</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_status</span><span class="p">(</span><span class="s2">&quot;API Token deleted.&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_output</span><span class="p">(</span><span class="s2">&quot;API token deleted.</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="MvapiGUI.update_status">
<a class="viewcode-back" href="../index.html#mvapi.MvapiGUI.update_status">[docs]</a>
    <span class="k">def</span> <span class="nf">update_status</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">status</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Updates the text in the status bar.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        status : str</span>
<span class="sd">            The status message to display.</span>
<span class="sd">        &quot;&quot;&quot;</span>        
        <span class="bp">self</span><span class="o">.</span><span class="n">status_output</span><span class="o">.</span><span class="n">config</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="n">status</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">master</span><span class="o">.</span><span class="n">update</span><span class="p">()</span></div>


<div class="viewcode-block" id="MvapiGUI.update_output">
<a class="viewcode-back" href="../index.html#mvapi.MvapiGUI.update_output">[docs]</a>
    <span class="k">def</span> <span class="nf">update_output</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">string</span><span class="p">,</span> <span class="n">clear</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Updates the output frame text.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        string : str</span>
<span class="sd">            The string to display in the output frame.</span>
<span class="sd">        clear : bool, optional</span>
<span class="sd">            Whether to clear existing text (default is True).</span>
<span class="sd">        &quot;&quot;&quot;</span>        
        <span class="k">if</span> <span class="n">clear</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">output_text</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="s2">&quot;1.0&quot;</span><span class="p">,</span> <span class="n">tk</span><span class="o">.</span><span class="n">END</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">output_text</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">tk</span><span class="o">.</span><span class="n">END</span><span class="p">,</span> <span class="n">string</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">master</span><span class="o">.</span><span class="n">update</span><span class="p">()</span></div>


<div class="viewcode-block" id="MvapiGUI.buy_contract">
<a class="viewcode-back" href="../index.html#mvapi.MvapiGUI.buy_contract">[docs]</a>
    <span class="k">def</span> <span class="nf">buy_contract</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initiates a contract purchase and updates output with contract details.</span>
<span class="sd">        &quot;&quot;&quot;</span>        
        <span class="bp">self</span><span class="o">.</span><span class="n">update_status</span><span class="p">(</span><span class="s2">&quot;Attempting to buy contract.&quot;</span><span class="p">)</span>
        <span class="n">temp_flag</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Product</span><span class="o">.</span><span class="n">buy_contract</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_output</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Product</span><span class="o">.</span><span class="n">last_msg</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_status</span><span class="p">(</span><span class="s2">&quot;Bought contract.&quot;</span> <span class="k">if</span> <span class="n">temp_flag</span> <span class="k">else</span> <span class="s2">&quot;Failed to buy.&quot;</span><span class="p">)</span></div>

        
<div class="viewcode-block" id="MvapiGUI.price_proposal">
<a class="viewcode-back" href="../index.html#mvapi.MvapiGUI.price_proposal">[docs]</a>
    <span class="k">def</span> <span class="nf">price_proposal</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Requests a price proposal and displays the response.</span>
<span class="sd">        &quot;&quot;&quot;</span>        
        <span class="bp">self</span><span class="o">.</span><span class="n">update_status</span><span class="p">(</span><span class="s2">&quot;Attempting to get price proposal.&quot;</span><span class="p">)</span>
        <span class="n">temp_flag</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Product</span><span class="o">.</span><span class="n">price_proposal</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_output</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Product</span><span class="o">.</span><span class="n">last_msg</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_status</span><span class="p">(</span><span class="s2">&quot;Got price proposal.&quot;</span> <span class="k">if</span> <span class="n">temp_flag</span> <span class="k">else</span> <span class="s2">&quot;Failed to get price proposal.&quot;</span><span class="p">)</span></div>

        
<div class="viewcode-block" id="MvapiGUI.sell_contract">
<a class="viewcode-back" href="../index.html#mvapi.MvapiGUI.sell_contract">[docs]</a>
    <span class="k">def</span> <span class="nf">sell_contract</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Attempts to sell a specific contract and updates the output.</span>
<span class="sd">        &quot;&quot;&quot;</span>        
        <span class="bp">self</span><span class="o">.</span><span class="n">update_status</span><span class="p">(</span><span class="s2">&quot;Attempting to sell contract.&quot;</span><span class="p">)</span>
        <span class="n">temp_flag</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Product</span><span class="o">.</span><span class="n">sell_contract</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_output</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Product</span><span class="o">.</span><span class="n">last_msg</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_status</span><span class="p">(</span><span class="s2">&quot;Sold contract.&quot;</span> <span class="k">if</span> <span class="n">temp_flag</span> <span class="k">else</span> <span class="s2">&quot;Failed to sell.&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="MvapiGUI.sell_all">
<a class="viewcode-back" href="../index.html#mvapi.MvapiGUI.sell_all">[docs]</a>
    <span class="k">def</span> <span class="nf">sell_all</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Attempts to sell all currently active contracts.</span>
<span class="sd">        &quot;&quot;&quot;</span>        
        <span class="bp">self</span><span class="o">.</span><span class="n">update_status</span><span class="p">(</span><span class="s2">&quot;Attempting to sell all contracts.&quot;</span><span class="p">)</span>
        <span class="n">temp_flag</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Product</span><span class="o">.</span><span class="n">sell_all_contracts</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">index</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Product</span><span class="o">.</span><span class="n">GUI_data</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_output</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">+</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Product</span><span class="o">.</span><span class="n">GUI_data</span><span class="p">[</span><span class="n">index</span><span class="p">:],</span> <span class="n">indent</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="n">convert_np_types</span><span class="p">),</span> <span class="n">clear</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_status</span><span class="p">(</span><span class="s2">&quot;Attempt to sell all contracts ran.&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="MvapiGUI.change_product">
<a class="viewcode-back" href="../index.html#mvapi.MvapiGUI.change_product">[docs]</a>
    <span class="k">def</span> <span class="nf">change_product</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Changes the active product in the GUI.</span>
<span class="sd">        &quot;&quot;&quot;</span>        
        <span class="n">product_type</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">product_box</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">product_type</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Product</span><span class="o">.</span><span class="n">species</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">update_status</span><span class="p">((</span><span class="s1">&#39;Changing&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Product</span><span class="o">.</span><span class="n">species</span><span class="p">,</span> <span class="s1">&#39;to&#39;</span><span class="p">,</span> <span class="n">product_type</span><span class="p">))</span>
            <span class="n">get_class</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="vm">__name__</span><span class="p">],</span> <span class="n">product_type</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Product</span> <span class="o">=</span> <span class="n">get_class</span><span class="p">(</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">Product</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">update_check_options</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">update_status</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Product type changed to </span><span class="si">{</span><span class="n">product_type</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">update_output</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Current product type is </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">Product</span><span class="o">.</span><span class="n">species</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="MvapiGUI.get_check_options">
<a class="viewcode-back" href="../index.html#mvapi.MvapiGUI.get_check_options">[docs]</a>
    <span class="k">def</span> <span class="nf">get_check_options</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Retrieves a list of available check functions for the current product.</span>
<span class="sd">        &quot;&quot;&quot;</span>        
        <span class="k">return</span> <span class="p">[</span><span class="n">s</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="nb">dir</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Product</span><span class="p">)</span> <span class="k">if</span> <span class="n">s</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;check_&#39;</span><span class="p">)]</span></div>


<div class="viewcode-block" id="MvapiGUI.update_check_options">
<a class="viewcode-back" href="../index.html#mvapi.MvapiGUI.update_check_options">[docs]</a>
    <span class="k">def</span> <span class="nf">update_check_options</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Updates the dropdown with available check functions for the selected product.</span>
<span class="sd">        &quot;&quot;&quot;</span>        
        <span class="bp">self</span><span class="o">.</span><span class="n">check_box</span><span class="p">[</span><span class="s1">&#39;values&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_check_options</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">check_box</span><span class="o">.</span><span class="n">current</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_check_params</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_check_input_params</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_user_input_params</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_user_input_params</span><span class="p">())</span></div>


<div class="viewcode-block" id="MvapiGUI.get_check_input_params">
<a class="viewcode-back" href="../index.html#mvapi.MvapiGUI.get_check_input_params">[docs]</a>
    <span class="k">def</span> <span class="nf">get_check_input_params</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Retrieves the input parameters for the currently selected check function.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">check_input_params</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">inspect</span><span class="o">.</span><span class="n">signature</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Product</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_box</span><span class="o">.</span><span class="n">get</span><span class="p">()))</span><span class="o">.</span><span class="n">parameters</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="k">if</span> <span class="s1">&#39;kwargs&#39;</span> <span class="ow">in</span> <span class="n">check_input_params</span><span class="p">:</span>
            <span class="n">check_input_params</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="s1">&#39;kwargs&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">check_input_params</span></div>


<div class="viewcode-block" id="MvapiGUI.get_user_input_params">
<a class="viewcode-back" href="../index.html#mvapi.MvapiGUI.get_user_input_params">[docs]</a>
    <span class="k">def</span> <span class="nf">get_user_input_params</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Retrieves user parameters for the active product.</span>
<span class="sd">        &quot;&quot;&quot;</span>        
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">Product</span><span class="o">.</span><span class="n">user_input_params</span></div>


<div class="viewcode-block" id="MvapiGUI.update_check_params">
<a class="viewcode-back" href="../index.html#mvapi.MvapiGUI.update_check_params">[docs]</a>
    <span class="k">def</span> <span class="nf">update_check_params</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">new_options</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Updates the displayed parameters for the selected check function.</span>
<span class="sd">        &quot;&quot;&quot;</span>        
        <span class="k">for</span> <span class="n">widget</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_param_frame</span><span class="o">.</span><span class="n">winfo_children</span><span class="p">():</span>
            <span class="n">widget</span><span class="o">.</span><span class="n">destroy</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">opt</span> <span class="ow">in</span> <span class="n">new_options</span><span class="p">:</span>
            <span class="n">tk</span><span class="o">.</span><span class="n">Label</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">check_param_frame</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">opt</span><span class="si">}</span><span class="s2">:&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">anchor</span><span class="o">=</span><span class="n">tk</span><span class="o">.</span><span class="n">W</span><span class="p">,</span> <span class="n">padx</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">pady</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
            <span class="n">tk</span><span class="o">.</span><span class="n">Entry</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">check_param_frame</span><span class="p">)</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">fill</span><span class="o">=</span><span class="n">tk</span><span class="o">.</span><span class="n">X</span><span class="p">,</span> <span class="n">padx</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">pady</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
        <span class="n">tk</span><span class="o">.</span><span class="n">Button</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">check_param_frame</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="s2">&quot;Run Check&quot;</span><span class="p">,</span> <span class="n">command</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">run_check</span><span class="p">)</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">pady</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span></div>


<div class="viewcode-block" id="MvapiGUI.update_user_input_params">
<a class="viewcode-back" href="../index.html#mvapi.MvapiGUI.update_user_input_params">[docs]</a>
    <span class="k">def</span> <span class="nf">update_user_input_params</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">new_options</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Updates the displayed parameters for user input settings.</span>
<span class="sd">        &quot;&quot;&quot;</span>        
        <span class="k">for</span> <span class="n">widget</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">param_frame</span><span class="o">.</span><span class="n">winfo_children</span><span class="p">():</span>
            <span class="n">widget</span><span class="o">.</span><span class="n">destroy</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">opt</span> <span class="ow">in</span> <span class="n">new_options</span><span class="p">:</span>
            <span class="n">tk</span><span class="o">.</span><span class="n">Label</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">param_frame</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">opt</span><span class="si">}</span><span class="s2">:&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">anchor</span><span class="o">=</span><span class="n">tk</span><span class="o">.</span><span class="n">W</span><span class="p">,</span> <span class="n">padx</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">pady</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
            <span class="n">tk</span><span class="o">.</span><span class="n">Entry</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">param_frame</span><span class="p">)</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">fill</span><span class="o">=</span><span class="n">tk</span><span class="o">.</span><span class="n">X</span><span class="p">,</span> <span class="n">padx</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">pady</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
        <span class="n">tk</span><span class="o">.</span><span class="n">Button</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">param_frame</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="s2">&quot;Update Parameters&quot;</span><span class="p">,</span> <span class="n">command</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">set_user_input_params</span><span class="p">)</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">pady</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span></div>


<div class="viewcode-block" id="MvapiGUI.process_params">
<a class="viewcode-back" href="../index.html#mvapi.MvapiGUI.process_params">[docs]</a>
    <span class="k">def</span> <span class="nf">process_params</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">params_dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Processes the input parameters and converts values to the correct types.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        params_dict : dict</span>
<span class="sd">            The dictionary containing parameter names and values.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        dict</span>
<span class="sd">            Processed parameters with converted types.</span>
<span class="sd">        &quot;&quot;&quot;</span>        
        <span class="n">temp_dict</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">params_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">value</span> <span class="o">!=</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;runs&#39;</span><span class="p">,</span> <span class="s1">&#39;duration&#39;</span><span class="p">,</span> <span class="s1">&#39;show&#39;</span><span class="p">]:</span>
                    <span class="n">temp_dict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">key</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;stake&#39;</span><span class="p">,</span> <span class="s1">&#39;take_profit&#39;</span><span class="p">,</span> <span class="s1">&#39;stop_loss&#39;</span><span class="p">,</span> <span class="s1">&#39;strike&#39;</span><span class="p">,</span> <span class="s1">&#39;growth_rate&#39;</span><span class="p">]:</span>
                    <span class="n">temp_dict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">temp_dict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
        <span class="k">return</span> <span class="n">temp_dict</span></div>


<div class="viewcode-block" id="MvapiGUI.set_check_params">
<a class="viewcode-back" href="../index.html#mvapi.MvapiGUI.set_check_params">[docs]</a>
    <span class="k">def</span> <span class="nf">set_check_params</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Collects and processes parameter values for the selected check function.</span>
<span class="sd">        &quot;&quot;&quot;</span>        
        <span class="n">params_dict</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">widget</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_param_frame</span><span class="o">.</span><span class="n">winfo_children</span><span class="p">():</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">widget</span><span class="p">,</span> <span class="n">tk</span><span class="o">.</span><span class="n">Label</span><span class="p">):</span>
                <span class="n">option_name</span> <span class="o">=</span> <span class="n">widget</span><span class="o">.</span><span class="n">cget</span><span class="p">(</span><span class="s2">&quot;text&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s2">&quot;:&quot;</span><span class="p">)</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">widget</span><span class="p">,</span> <span class="n">tk</span><span class="o">.</span><span class="n">Entry</span><span class="p">):</span>
                <span class="n">option_value</span> <span class="o">=</span> <span class="n">widget</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
                <span class="n">params_dict</span><span class="p">[</span><span class="n">option_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">option_value</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">process_params</span><span class="p">(</span><span class="n">params_dict</span><span class="p">)</span></div>


<div class="viewcode-block" id="MvapiGUI.set_user_input_params">
<a class="viewcode-back" href="../index.html#mvapi.MvapiGUI.set_user_input_params">[docs]</a>
    <span class="k">def</span> <span class="nf">set_user_input_params</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sets user-specific parameters for the active product.</span>
<span class="sd">        &quot;&quot;&quot;</span>        
        <span class="n">params_dict</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">widget</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">param_frame</span><span class="o">.</span><span class="n">winfo_children</span><span class="p">():</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">widget</span><span class="p">,</span> <span class="n">tk</span><span class="o">.</span><span class="n">Label</span><span class="p">):</span>
                <span class="n">option_name</span> <span class="o">=</span> <span class="n">widget</span><span class="o">.</span><span class="n">cget</span><span class="p">(</span><span class="s2">&quot;text&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s2">&quot;:&quot;</span><span class="p">)</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">widget</span><span class="p">,</span> <span class="n">tk</span><span class="o">.</span><span class="n">Entry</span><span class="p">):</span>
                <span class="n">option_value</span> <span class="o">=</span> <span class="n">widget</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
                <span class="n">params_dict</span><span class="p">[</span><span class="n">option_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">option_value</span>
        <span class="n">params_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">process_params</span><span class="p">(</span><span class="n">params_dict</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Product</span><span class="o">.</span><span class="n">_set_attributes</span><span class="p">(</span><span class="o">**</span><span class="n">params_dict</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_output</span><span class="p">(</span><span class="s1">&#39;Contract Parameters set to:</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_output</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">params_dict</span><span class="p">),</span> <span class="n">clear</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span></div>


<div class="viewcode-block" id="MvapiGUI.run_check">
<a class="viewcode-back" href="../index.html#mvapi.MvapiGUI.run_check">[docs]</a>
    <span class="k">def</span> <span class="nf">run_check</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Executes the selected check function with the provided parameters and displays results.</span>
<span class="sd">        &quot;&quot;&quot;</span>        
        <span class="n">check_type</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_box</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_status</span><span class="p">((</span><span class="s1">&#39;Running&#39;</span><span class="p">,</span> <span class="n">check_type</span><span class="p">))</span>
        <span class="n">index</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Product</span><span class="o">.</span><span class="n">GUI_data</span><span class="p">)</span>
        <span class="n">results_df</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Product</span><span class="p">,</span> <span class="n">check_type</span><span class="p">)(</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">set_check_params</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_output</span><span class="p">(</span><span class="n">results_df</span><span class="o">.</span><span class="n">to_markdown</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_output</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">+</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Product</span><span class="o">.</span><span class="n">GUI_data</span><span class="p">[</span><span class="n">index</span><span class="p">:],</span> <span class="n">indent</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="n">convert_np_types</span><span class="p">),</span> <span class="n">clear</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_status</span><span class="p">((</span><span class="n">check_type</span><span class="p">,</span> <span class="s1">&#39;complete&#39;</span><span class="p">))</span></div>

        
<div class="viewcode-block" id="MvapiGUI.export_data_action">
<a class="viewcode-back" href="../index.html#mvapi.MvapiGUI.export_data_action">[docs]</a>
    <span class="k">def</span> <span class="nf">export_data_action</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initiates data export to an Excel file using the specified file name and timestamp settings.</span>
<span class="sd">        &quot;&quot;&quot;</span>        
        <span class="c1"># Get values from input fields</span>
        <span class="n">filename</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">filename_entry</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
        <span class="n">timestamp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">timestamp_var</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
        <span class="c1"># Call export_data function from the Product class</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_status</span><span class="p">((</span><span class="s1">&#39;Exporting data&#39;</span><span class="p">))</span>
        <span class="n">file_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Product</span><span class="o">.</span><span class="n">export_data</span><span class="p">(</span><span class="n">file_name</span><span class="o">=</span><span class="n">filename</span><span class="p">,</span> <span class="n">save_timestamp</span><span class="o">=</span><span class="p">(</span><span class="kc">True</span> <span class="k">if</span> <span class="n">timestamp</span> <span class="o">==</span> <span class="s2">&quot;Yes&quot;</span> <span class="k">else</span> <span class="kc">False</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_output</span><span class="p">(</span><span class="s1">&#39;Data exported as &#39;</span> <span class="o">+</span> <span class="n">file_path</span><span class="p">)</span>     
        <span class="bp">self</span><span class="o">.</span><span class="n">update_status</span><span class="p">((</span><span class="s1">&#39;Data exported as &#39;</span> <span class="o">+</span> <span class="n">file_path</span><span class="p">))</span></div>
</div>


<div class="viewcode-block" id="run_gui">
<a class="viewcode-back" href="../index.html#mvapi.run_gui">[docs]</a>
<span class="k">def</span> <span class="nf">run_gui</span><span class="p">(</span><span class="n">product</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">object</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Launches the graphical user interface (GUI) for the application.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    product : bool, optional</span>
<span class="sd">        Specifies whether to initialize the GUI with a product (default is False).</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    Product</span>
<span class="sd">        The product object created or modified through the GUI.</span>
<span class="sd">    &quot;&quot;&quot;</span>    
    <span class="n">root</span> <span class="o">=</span> <span class="n">tk</span><span class="o">.</span><span class="n">Tk</span><span class="p">()</span>
    <span class="n">gui</span> <span class="o">=</span> <span class="n">MvapiGUI</span><span class="p">(</span><span class="n">master</span><span class="o">=</span><span class="n">root</span><span class="p">,</span> <span class="n">product</span><span class="o">=</span><span class="n">product</span><span class="p">)</span>
    <span class="n">root</span><span class="o">.</span><span class="n">mainloop</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">gui</span><span class="o">.</span><span class="n">Product</span></div>

    

<span class="c1"># Get the directory where the current script is located</span>
<span class="n">script_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)</span>

<div class="viewcode-block" id="load_yaml_file">
<a class="viewcode-back" href="../index.html#mvapi.load_yaml_file">[docs]</a>
<span class="k">def</span> <span class="nf">load_yaml_file</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Load a YAML file and return its contents.</span>

<span class="sd">    This function reads a YAML file located in the same directory as the script and returns its contents</span>
<span class="sd">    as a dictionary. It handles potential errors such as YAML parsing issues or file not found exceptions.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    filename : str</span>
<span class="sd">        The name of the YAML file to be loaded. The file should be located in the same directory as the script.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    dict</span>
<span class="sd">        The contents of the YAML file as a dictionary. Returns `None` if there is an error loading the file.</span>

<span class="sd">    Raises</span>
<span class="sd">    ------</span>
<span class="sd">    yaml.YAMLError</span>
<span class="sd">        If there is an error parsing the YAML file.</span>
<span class="sd">    FileNotFoundError</span>
<span class="sd">        If the specified file does not exist.</span>
<span class="sd">    Exception</span>
<span class="sd">        For any other exceptions that occur during file loading.</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; symbols = load_yaml_file(&quot;SYMBOLS.yaml&quot;)</span>
<span class="sd">    &gt;&gt;&gt; BO = load_yaml_file(&quot;BO.yaml&quot;)</span>
<span class="sd">    &gt;&gt;&gt; default_loss_probs = load_yaml_file(&quot;LOSS_PROBS.yaml&quot;)</span>
<span class="sd">    &gt;&gt;&gt; contract_types = load_yaml_file(&quot;CONTRACT_TYPES.yaml&quot;)</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    The function prints error messages to the standard output if it encounters issues while loading or parsing the file.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">filepath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">script_dir</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filepath</span><span class="p">)</span> <span class="k">as</span> <span class="n">stream</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">yaml</span><span class="o">.</span><span class="n">safe_load</span><span class="p">(</span><span class="n">stream</span><span class="p">)</span>
    <span class="k">except</span> <span class="n">yaml</span><span class="o">.</span><span class="n">YAMLError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;YAML error in </span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">FileNotFoundError</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;File not found: </span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error loading file </span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span></div>


<span class="n">symbols</span> <span class="o">=</span> <span class="n">load_yaml_file</span><span class="p">(</span><span class="s2">&quot;SYMBOLS.yaml&quot;</span><span class="p">)</span>
<span class="n">BO</span> <span class="o">=</span> <span class="n">load_yaml_file</span><span class="p">(</span><span class="s2">&quot;BO.yaml&quot;</span><span class="p">)</span>
<span class="n">default_loss_probs</span> <span class="o">=</span> <span class="n">load_yaml_file</span><span class="p">(</span><span class="s2">&quot;LOSS_PROBS.yaml&quot;</span><span class="p">)</span>
<span class="n">contract_types</span> <span class="o">=</span> <span class="n">load_yaml_file</span><span class="p">(</span><span class="s2">&quot;CONTRACT_TYPES.yaml&quot;</span><span class="p">)</span>

<div class="viewcode-block" id="accu_tick_size_barrier_builder">
<a class="viewcode-back" href="../index.html#mvapi.accu_tick_size_barrier_builder">[docs]</a>
<span class="k">def</span> <span class="nf">accu_tick_size_barrier_builder</span><span class="p">(</span><span class="n">loss_probs</span><span class="o">=</span><span class="n">default_loss_probs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Builds the tick size barriers for each growth rate for each symbol based on their loss probabilities.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    loss_probs : dict, optional</span>
<span class="sd">        A dictionary with keys as growth rates and values as corresponding loss probabilities.</span>
<span class="sd">        Defaults to `default_loss_probs`.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    None</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    Run at the start to build the tick size barrier for each growth rate for each symbol based on preset default values.</span>
<span class="sd">    </span>
<span class="sd">    The function updates the tick size barrier for each growth rate for each symbol in the &#39;symbols&#39; dictionary</span>
<span class="sd">    by solving for the barrier for each growth rate using the given loss probabilities. </span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; loss_probs = {&#39;0.01&#39;: 0.01, &#39;0.02&#39;: 0.02, &#39;0.03&#39;: 0.03, &#39;0.04&#39;: 0.04, &#39;0.05&#39;: 0.05}</span>
<span class="sd">    &gt;&gt;&gt; accu_tick_size_barrier_builder(loss_probs)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">is_vol</span><span class="p">(</span><span class="n">symbol</span><span class="p">):</span>
        <span class="k">return</span> <span class="mi">1</span> <span class="k">if</span> <span class="p">(</span><span class="s1">&#39;HZ&#39;</span> <span class="ow">in</span> <span class="n">symbol</span> <span class="ow">or</span> <span class="s1">&#39;R_&#39;</span> <span class="ow">in</span> <span class="n">symbol</span><span class="p">)</span> <span class="k">else</span> <span class="mi">0</span> 

    <span class="k">for</span> <span class="n">symbol</span> <span class="ow">in</span> <span class="n">symbols</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">is_vol</span><span class="p">(</span><span class="n">symbol</span><span class="p">):</span>
            <span class="n">symbols</span><span class="p">[</span><span class="n">symbol</span><span class="p">][</span><span class="s1">&#39;accu&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;barrier&#39;</span> <span class="p">:</span> <span class="p">{}}</span>

    <span class="k">def</span> <span class="nf">gbm</span><span class="p">(</span><span class="n">barrier</span><span class="p">,</span> <span class="n">loss_prob</span><span class="p">,</span> <span class="n">sigma</span><span class="p">,</span> <span class="n">symbol</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
        <span class="n">t</span> <span class="o">=</span> <span class="p">(</span><span class="mi">2</span> <span class="k">if</span> <span class="s1">&#39;R&#39;</span> <span class="ow">in</span> <span class="n">symbol</span> <span class="k">else</span> <span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="mi">365</span><span class="o">/</span><span class="mi">86400</span>
        <span class="n">mu</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.5</span><span class="o">*</span><span class="n">sigma</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="n">t</span>
        <span class="n">sd</span> <span class="o">=</span> <span class="n">sigma</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="n">t</span>
        <span class="n">prob_b1</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">norm</span><span class="o">.</span><span class="n">cdf</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">barrier</span><span class="p">)</span><span class="o">-</span><span class="n">mu</span><span class="p">)</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">sd</span><span class="p">))</span>
        <span class="n">prob_b2</span> <span class="o">=</span> <span class="n">norm</span><span class="o">.</span><span class="n">cdf</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">barrier</span><span class="p">)</span><span class="o">-</span><span class="n">mu</span><span class="p">)</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">sd</span><span class="p">))</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">prob_b1</span> <span class="o">+</span> <span class="n">prob_b2</span> <span class="o">-</span> <span class="n">loss_prob</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">growth_rate</span> <span class="ow">in</span> <span class="n">loss_probs</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
        <span class="n">loss_prob</span> <span class="o">=</span> <span class="n">loss_probs</span><span class="p">[</span><span class="n">growth_rate</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">symbol</span> <span class="ow">in</span> <span class="n">symbols</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">is_vol</span><span class="p">(</span><span class="n">symbol</span><span class="p">):</span>
                <span class="n">sigma</span> <span class="o">=</span> <span class="n">symbols</span><span class="p">[</span><span class="n">symbol</span><span class="p">][</span><span class="s1">&#39;sigma&#39;</span><span class="p">]</span>
                <span class="n">symbols</span><span class="p">[</span><span class="n">symbol</span><span class="p">][</span><span class="s1">&#39;accu&#39;</span><span class="p">][</span><span class="s1">&#39;barrier&#39;</span><span class="p">][</span><span class="n">growth_rate</span><span class="p">]</span> <span class="o">=</span> <span class="n">fsolve</span><span class="p">(</span><span class="n">gbm</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">args</span> <span class="o">=</span> <span class="p">(</span><span class="n">loss_prob</span><span class="p">,</span> <span class="n">sigma</span><span class="p">,</span> <span class="n">symbol</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span></div>


<span class="n">accu_tick_size_barrier_builder</span><span class="p">()</span>

<div class="viewcode-block" id="insert_dict">
<a class="viewcode-back" href="../index.html#mvapi.insert_dict">[docs]</a>
<span class="k">def</span> <span class="nf">insert_dict</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">_dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Insert or update a dictionary into the key of the given item.</span>

<span class="sd">    This function attempts to update the specified key of the provided item with the </span>
<span class="sd">    key-value pairs from the provided dictionary. If the key does not exist in the item, </span>
<span class="sd">    it initializes the key as an empty dictionary before performing the update.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    item : dict</span>
<span class="sd">        The dictionary in which the key-value pairs are to be inserted or updated.</span>
<span class="sd">    key : str</span>
<span class="sd">        The key within the item dictionary to be updated with the provided dictionary.</span>
<span class="sd">    _dict : dict</span>
<span class="sd">        The dictionary containing key-value pairs to be inserted or updated into the item.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    None</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; item = {&#39;a&#39;: {}}</span>
<span class="sd">    &gt;&gt;&gt; insert_dict(item, &#39;b&#39;, {&#39;y&#39;: 2})</span>
<span class="sd">    &gt;&gt;&gt; print(item)</span>
<span class="sd">    {&#39;a&#39;: {}, &#39;b&#39;: {&#39;y&#39;: 2}}</span>

<span class="sd">    &gt;&gt;&gt; item = {&#39;a&#39;: {}, &#39;b&#39;: {}}</span>
<span class="sd">    &gt;&gt;&gt; insert_dict(item, &#39;b&#39;, {&#39;y&#39;: 2})</span>
<span class="sd">    &gt;&gt;&gt; print(item)</span>
<span class="sd">    {&#39;a&#39;: {}, &#39;b&#39;: {&#39;y&#39;: 2}}</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">try</span><span class="p">:</span> 
        <span class="n">item</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">_dict</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">item</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">try</span><span class="p">:</span> 
            <span class="n">item</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">_dict</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
             <span class="n">item</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">_dict</span></div>


<div class="viewcode-block" id="dict_to_df">
<a class="viewcode-back" href="../index.html#mvapi.dict_to_df">[docs]</a>
<span class="k">def</span> <span class="nf">dict_to_df</span><span class="p">(</span><span class="n">_dict</span><span class="p">,</span> <span class="n">title</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Convert a dictionary to a pandas DataFrame.</span>

<span class="sd">    This function takes a dictionary and converts it to a pandas DataFrame. The dictionary&#39;s keys </span>
<span class="sd">    become a &#39;Category&#39; column in the DataFrame, and the associated values become other columns. </span>
<span class="sd">    If the dictionary cannot be converted, it creates a DataFrame with the dictionary&#39;s content.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    _dict : dict</span>
<span class="sd">        The dictionary to be converted to a DataFrame.</span>
<span class="sd">    title : str</span>
<span class="sd">        The title to be printed alongside the DataFrame for identification.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    pd.DataFrame</span>
<span class="sd">        The resulting DataFrame created from the dictionary.</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; _dict = {&#39;A&#39;: {&#39;value1&#39;: 10, &#39;value2&#39;: 20}, &#39;B&#39;: {&#39;value1&#39;: 30, &#39;value2&#39;: 40}}</span>
<span class="sd">    &gt;&gt;&gt; df = dict_to_df(_dict, &#39;Example Title&#39;)</span>
<span class="sd">    Stats for Example Title check</span>
<span class="sd">    &gt;&gt;&gt; display(df)</span>
<span class="sd">    Category  value1  value2</span>
<span class="sd">    0        A      10      20</span>
<span class="sd">    1        B      30      40</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">try</span><span class="p">:</span> 
        <span class="n">flattened_data</span> <span class="o">=</span> <span class="p">[{</span><span class="o">**</span><span class="p">{</span><span class="s1">&#39;Category&#39;</span><span class="p">:</span> <span class="n">sub_key</span><span class="p">},</span> <span class="o">**</span><span class="n">values</span><span class="p">}</span> <span class="k">for</span> <span class="n">sub_key</span><span class="p">,</span> <span class="n">values</span> <span class="ow">in</span> <span class="n">_dict</span><span class="o">.</span><span class="n">items</span><span class="p">()]</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">flattened_data</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">([</span><span class="n">_dict</span><span class="p">])</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Stats for&#39;</span><span class="p">,</span> <span class="n">title</span><span class="p">,</span> <span class="s1">&#39;check&#39;</span><span class="p">)</span>
    <span class="n">display</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">df</span></div>


<div class="viewcode-block" id="get_sigma">
<a class="viewcode-back" href="../index.html#mvapi.get_sigma">[docs]</a>
<span class="k">def</span> <span class="nf">get_sigma</span><span class="p">(</span><span class="n">symbol</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get the sigma value for a given symbol.</span>

<span class="sd">    This function retrieves the &#39;sigma&#39; value associated with the provided symbol </span>
<span class="sd">    from a predefined symbols dictionary.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    symbol : str</span>
<span class="sd">        The symbol for which the sigma value is to be retrieved.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    float</span>
<span class="sd">        The sigma value associated with the given symbol.</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; get_sigma(&#39;1HZ75V&#39;)</span>
<span class="sd">    0.75</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">symbols</span><span class="p">[</span><span class="n">symbol</span><span class="p">][</span><span class="s1">&#39;sigma&#39;</span><span class="p">]</span></div>


<div class="viewcode-block" id="get_stake">
<a class="viewcode-back" href="../index.html#mvapi.get_stake">[docs]</a>
<span class="k">def</span> <span class="nf">get_stake</span><span class="p">(</span><span class="n">prop</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get the stake amount from a given proposal.</span>

<span class="sd">    This function calculates the stake amount from the provided proposal by subtracting </span>
<span class="sd">    the app markup amount from the proposal&#39;s requested amount. If the app markup amount </span>
<span class="sd">    is not available, it returns the requested amount.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    prop : dict</span>
<span class="sd">        The proposal from which the stake amount is to be retrieved.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    float</span>
<span class="sd">        The calculated stake amount from the given proposal.</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; prop = {</span>
<span class="sd">    ...     &#39;echo_req&#39;: {&#39;amount&#39;: 100},</span>
<span class="sd">    ...     &#39;proposal&#39;: {&#39;contract_details&#39;: {&#39;app_markup_amount&#39;: &#39;5&#39;}}</span>
<span class="sd">    ... }</span>
<span class="sd">    &gt;&gt;&gt; get_stake(prop)</span>
<span class="sd">    95.0</span>

<span class="sd">    &gt;&gt;&gt; prop = {</span>
<span class="sd">    ...     &#39;echo_req&#39;: {&#39;amount&#39;: 100}</span>
<span class="sd">    ... }</span>
<span class="sd">    &gt;&gt;&gt; get_stake(prop)</span>
<span class="sd">    100.0</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">prop</span><span class="p">[</span><span class="s1">&#39;msg_type&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;proposal&#39;</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">stake</span> <span class="o">=</span> <span class="n">prop</span><span class="p">[</span><span class="s1">&#39;echo_req&#39;</span><span class="p">][</span><span class="s1">&#39;amount&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="nb">float</span><span class="p">(</span><span class="n">prop</span><span class="p">[</span><span class="s1">&#39;proposal&#39;</span><span class="p">][</span><span class="s1">&#39;contract_details&#39;</span><span class="p">][</span><span class="s1">&#39;app_markup_amount&#39;</span><span class="p">])</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">stake</span> <span class="o">=</span> <span class="n">prop</span><span class="p">[</span><span class="s1">&#39;echo_req&#39;</span><span class="p">][</span><span class="s1">&#39;amount&#39;</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">stake</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">prop</span><span class="p">[</span><span class="s1">&#39;proposal_open_contract&#39;</span><span class="p">][</span><span class="s1">&#39;buy_price&#39;</span><span class="p">])</span> <span class="o">-</span> <span class="nb">float</span><span class="p">(</span><span class="n">prop</span><span class="p">[</span><span class="s1">&#39;proposal_open_contract&#39;</span><span class="p">][</span><span class="s1">&#39;contract_details&#39;</span><span class="p">][</span><span class="s1">&#39;app_markup_amount&#39;</span><span class="p">])</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">stake</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">prop</span><span class="p">[</span><span class="s1">&#39;proposal_open_contract&#39;</span><span class="p">][</span><span class="s1">&#39;buy_price&#39;</span><span class="p">])</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">stake</span> <span class="o">=</span> <span class="n">stake</span> <span class="o">-</span> <span class="n">prop</span><span class="p">[</span><span class="s1">&#39;proposal_open_contract&#39;</span><span class="p">][</span><span class="s1">&#39;cancellation&#39;</span><span class="p">][</span><span class="s1">&#39;ask_price&#39;</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">stake</span> <span class="o">=</span> <span class="n">stake</span>
    <span class="k">return</span> <span class="n">stake</span></div>


<div class="viewcode-block" id="get_currency_precision">
<a class="viewcode-back" href="../index.html#mvapi.get_currency_precision">[docs]</a>
<span class="k">def</span> <span class="nf">get_currency_precision</span><span class="p">(</span><span class="n">prop</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Retrieves the currency precision for the given proposal.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    prop : dict</span>
<span class="sd">        The proposal object containing currency information.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    int</span>
<span class="sd">        The currency precision for the specified proposal&#39;s currency.</span>
<span class="sd">    &quot;&quot;&quot;</span>    
    <span class="k">return</span> <span class="n">BO</span><span class="p">[</span><span class="s1">&#39;currency_precision&#39;</span><span class="p">][</span><span class="n">prop</span><span class="p">[</span><span class="s1">&#39;proposal_open_contract&#39;</span><span class="p">][</span><span class="s1">&#39;currency&#39;</span><span class="p">]]</span></div>


<div class="viewcode-block" id="roundsf">
<a class="viewcode-back" href="../index.html#mvapi.roundsf">[docs]</a>
<span class="k">def</span> <span class="nf">roundsf</span><span class="p">(</span><span class="n">number</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Round a number to retain only the first non-zero digit.</span>

<span class="sd">    This function takes a number, retains only the first non-zero digit, and </span>
<span class="sd">    replaces all following digits with zeros.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    number : float</span>
<span class="sd">        The number to be rounded.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    float</span>
<span class="sd">        The rounded numeric value.</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; roundsf(123.456)</span>
<span class="sd">    100.0</span>

<span class="sd">    &gt;&gt;&gt; roundsf(0.00456)</span>
<span class="sd">    0.004</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">number</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{:.15f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">number</span><span class="p">)</span>
    <span class="n">non_zero_index</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s1">&#39;[^0.]&#39;</span><span class="p">,</span> <span class="n">number</span><span class="p">)</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>        
    <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="n">number</span><span class="p">[:</span><span class="n">non_zero_index</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s1">&#39;[0-9]&#39;</span><span class="p">,</span> <span class="s1">&#39;0&#39;</span><span class="p">,</span> <span class="n">number</span><span class="p">[</span><span class="n">non_zero_index</span><span class="o">+</span><span class="mi">1</span><span class="p">:]))</span></div>


<div class="viewcode-block" id="roundup">
<a class="viewcode-back" href="../index.html#mvapi.roundup">[docs]</a>
<span class="k">def</span> <span class="nf">roundup</span><span class="p">(</span><span class="n">num</span><span class="p">,</span> <span class="n">prec</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Round up a number to the specified precision.</span>

<span class="sd">    This function rounds up a number to the specified number of decimal places.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    num : float</span>
<span class="sd">        The number to be rounded up.</span>
<span class="sd">    prec : int</span>
<span class="sd">        The number of decimal places to round up to.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    float</span>
<span class="sd">        The number rounded up to the specified precision.</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; roundup(123.456, 2)</span>
<span class="sd">    123.46</span>

<span class="sd">    &gt;&gt;&gt; roundup(0.00456, 3)</span>
<span class="sd">    0.005</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="nb">round</span><span class="p">((</span><span class="n">num</span> <span class="o">*</span> <span class="mi">10</span><span class="o">**</span><span class="n">prec</span><span class="p">),</span><span class="mi">15</span><span class="p">))</span> <span class="o">/</span> <span class="p">(</span><span class="mi">10</span><span class="o">**</span><span class="n">prec</span><span class="p">)</span></div>


<div class="viewcode-block" id="rounddown">
<a class="viewcode-back" href="../index.html#mvapi.rounddown">[docs]</a>
<span class="k">def</span> <span class="nf">rounddown</span><span class="p">(</span><span class="n">num</span><span class="p">,</span> <span class="n">prec</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Round down a number to the specified precision.</span>

<span class="sd">    This function rounds down a number to the specified number of decimal places.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    num : float</span>
<span class="sd">        The number to be rounded down.</span>
<span class="sd">    prec : int</span>
<span class="sd">        The number of decimal places to round down to.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    float</span>
<span class="sd">        The number rounded down to the specified precision.</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; rounddown(123.456, 2)</span>
<span class="sd">    123.45</span>

<span class="sd">    &gt;&gt;&gt; rounddown(0.00456, 3)</span>
<span class="sd">    0.004</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="nb">round</span><span class="p">((</span><span class="n">num</span> <span class="o">*</span> <span class="mi">10</span><span class="o">**</span><span class="n">prec</span><span class="p">),</span><span class="mi">15</span><span class="p">))</span> <span class="o">/</span> <span class="p">(</span><span class="mi">10</span><span class="o">**</span><span class="n">prec</span><span class="p">)</span></div>


<div class="viewcode-block" id="set_limit_orders">
<a class="viewcode-back" href="../index.html#mvapi.set_limit_orders">[docs]</a>
<span class="k">def</span> <span class="nf">set_limit_orders</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">take_profit</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">stop_loss</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Sets the take profit and stop loss limits for the given object.</span>

<span class="sd">    This function updates the take profit and stop loss attributes of the object if they are</span>
<span class="sd">    specified and valid to be set according to the contract types.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    obj : object</span>
<span class="sd">        The object whose limit orders are to be set.</span>

<span class="sd">    take_profit : float, int, optional</span>
<span class="sd">        The take profit value to be set. Defaults to None.</span>

<span class="sd">    stop_loss : float, int, optional</span>
<span class="sd">        The stop loss value to be set. Defaults to None.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    None</span>
<span class="sd">    &quot;&quot;&quot;</span>    
    <span class="k">if</span> <span class="n">contract_types</span><span class="p">[</span><span class="n">obj</span><span class="o">.</span><span class="n">species</span><span class="p">][</span><span class="s1">&#39;take_profit&#39;</span><span class="p">]</span> <span class="ow">and</span> <span class="nb">type</span><span class="p">(</span><span class="n">take_profit</span><span class="p">)</span> <span class="ow">in</span> <span class="p">[</span><span class="nb">float</span><span class="p">,</span><span class="nb">int</span><span class="p">]:</span>
        <span class="n">obj</span><span class="o">.</span><span class="n">take_profit</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">take_profit</span><span class="p">,</span> <span class="n">BO</span><span class="p">[</span><span class="s1">&#39;currency_precision&#39;</span><span class="p">][</span><span class="n">obj</span><span class="o">.</span><span class="n">currency</span><span class="p">])</span>
    <span class="k">if</span> <span class="n">contract_types</span><span class="p">[</span><span class="n">obj</span><span class="o">.</span><span class="n">species</span><span class="p">][</span><span class="s1">&#39;stop_loss&#39;</span><span class="p">]</span> <span class="ow">and</span> <span class="nb">type</span><span class="p">(</span><span class="n">stop_loss</span><span class="p">)</span> <span class="ow">in</span> <span class="p">[</span><span class="nb">float</span><span class="p">,</span><span class="nb">int</span><span class="p">]:</span>
        <span class="n">obj</span><span class="o">.</span><span class="n">stop_loss</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">stop_loss</span><span class="p">,</span> <span class="n">BO</span><span class="p">[</span><span class="s1">&#39;currency_precision&#39;</span><span class="p">][</span><span class="n">obj</span><span class="o">.</span><span class="n">currency</span><span class="p">])</span></div>


<div class="viewcode-block" id="set_mult_cancellation">
<a class="viewcode-back" href="../index.html#mvapi.set_mult_cancellation">[docs]</a>
<span class="k">def</span> <span class="nf">set_mult_cancellation</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">cancellation</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span> 
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Sets the cancellation value for a multiplier contract.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    obj : object</span>
<span class="sd">        The contract object to update.</span>
<span class="sd">    cancellation : any</span>
<span class="sd">        The cancellation value to set.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    None</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    - If the symbol contains &#39;stp&#39;, the cancellation is set to 0.</span>
<span class="sd">    - If the value is invalid, it attempts to append &#39;m&#39; (e.g., &quot;10m&quot;).</span>
<span class="sd">    &quot;&quot;&quot;</span>    
    <span class="k">if</span> <span class="s1">&#39;stp&#39;</span> <span class="ow">in</span> <span class="n">obj</span><span class="o">.</span><span class="n">symbol</span><span class="p">:</span>
        <span class="n">obj</span><span class="o">.</span><span class="n">cancellation</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">elif</span> <span class="n">cancellation</span> <span class="ow">in</span> <span class="n">BO</span><span class="p">[</span><span class="s1">&#39;multipliers&#39;</span><span class="p">][</span><span class="s1">&#39;cancellation&#39;</span><span class="p">]:</span>
        <span class="n">obj</span><span class="o">.</span><span class="n">cancellation</span> <span class="o">=</span> <span class="n">cancellation</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span> 
            <span class="n">cancellation</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">cancellation</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;m&#39;</span>
            <span class="n">obj</span><span class="o">.</span><span class="n">cancellation</span> <span class="o">=</span> <span class="n">cancellation</span> <span class="k">if</span> <span class="n">cancellation</span> <span class="ow">in</span> <span class="n">BO</span><span class="p">[</span><span class="s1">&#39;multipliers&#39;</span><span class="p">][</span><span class="s1">&#39;cancellation&#39;</span><span class="p">]</span> <span class="k">else</span> <span class="mi">0</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">obj</span><span class="o">.</span><span class="n">cancellation</span> <span class="o">=</span> <span class="mi">0</span></div>


<div class="viewcode-block" id="Product">
<a class="viewcode-back" href="../index.html#mvapi.Product">[docs]</a>
<span class="k">class</span> <span class="nc">Product</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A base class to represent a product for trading contracts through DerivAPI via WebSocket.</span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">    api_token : str</span>
<span class="sd">        API token for authentication.</span>
<span class="sd">    stake : int</span>
<span class="sd">        The amount to stake in each trade.</span>
<span class="sd">    symbol : str</span>
<span class="sd">        The underlying symbol of the product.</span>
<span class="sd">    messages : list</span>
<span class="sd">        List to store messages received from the WebSocket.</span>
<span class="sd">    endpoint : str</span>
<span class="sd">        The WebSocket endpoint.</span>
<span class="sd">    retry : int</span>
<span class="sd">        Counter for retry attempts when sending/receiving messages.</span>
<span class="sd">    contract_ids : list</span>
<span class="sd">        List of contract IDs.</span>
<span class="sd">    ws : WebSocket</span>
<span class="sd">        WebSocket connection object.</span>

<span class="sd">    Methods</span>
<span class="sd">    -------</span>
<span class="sd">    __setattr__() : None</span>
<span class="sd">        Set the value of an attribute and trigger corresponding actions based on the attribute.</span>
<span class="sd">    _set_attributes(**kwargs) : None</span>
<span class="sd">        Set multiple attributes on the object using keyword arguments.</span>
<span class="sd">    _set_app_details() : None</span>
<span class="sd">        Saves application details like endpoint and API token.</span>
<span class="sd">    _get_app_markup() : float</span>
<span class="sd">        Retrieves the application markup percentage.</span>
<span class="sd">    _get_app_id(string) : int</span>
<span class="sd">        Extracts the application ID from the endpoint URL.</span>
<span class="sd">    _proposal() : str</span>
<span class="sd">        Generates a proposal based on the current proposal type.</span>
<span class="sd">    _send() : dict</span>
<span class="sd">        Sends a proposal to the WebSocket and handles the response.</span>
<span class="sd">    send_message(message) : dict</span>
<span class="sd">        Sends a user-defined JSON message to the WebSocket.</span>
<span class="sd">    stream() : int</span>
<span class="sd">        Streams data from the WebSocket.</span>
<span class="sd">    price_proposal(random=False, buy=False, take_profit=0, stop_loss=0, **kwargs) : bool</span>
<span class="sd">        Gets a price proposal.</span>
<span class="sd">    buy_contract(runs=1, random=False, **kwargs) : None</span>
<span class="sd">        Attempts to buy a contract.</span>
<span class="sd">    contract_proposal(contract_id=None, subscribe=0) : None</span>
<span class="sd">        Gets contract details and optionally subscribes to updates.</span>
<span class="sd">    get_all_poc() : None</span>
<span class="sd">        Gets all proposal open contracts from saved contract IDs.</span>
<span class="sd">    tick_history(symbol=False, count=1, end=&#39;latest&#39;) : dict</span>
<span class="sd">        Retrieves historical tick data.</span>
<span class="sd">    _check_connection() : None</span>
<span class="sd">        Checks the WebSocket connection and reopens it if closed.</span>
<span class="sd">    _check_closed() : int</span>
<span class="sd">        Checks if a contract is closed.</span>
<span class="sd">    sell_contract(contract_id=None) : None</span>
<span class="sd">        Attempts to sell a contract.</span>
<span class="sd">    sell_all_contracts() : None</span>
<span class="sd">        Attempts to sell all contracts.</span>
<span class="sd">    create_ws() : None</span>
<span class="sd">        Creates a new WebSocket connection.</span>
<span class="sd">    authorise() : int</span>
<span class="sd">        Authorises the WebSocket connection.</span>
<span class="sd">    _recv_msg_handler() : int</span>
<span class="sd">        Handles messages received from the WebSocket.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    
<div class="viewcode-block" id="Product.__init__">
<a class="viewcode-back" href="../index.html#mvapi.Product.__init__">[docs]</a>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initializes a new instance of the Product class.</span>

<span class="sd">        This constructor sets the initial attributes for the product, including default values </span>
<span class="sd">        for stake, symbol, endpoint, and others. It also creates a WebSocket connection and </span>
<span class="sd">        authorizes it if an API token is provided. Additionally, it sets application details.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        **kwargs : dict</span>
<span class="sd">            Additional attributes to be set for the instance.</span>

<span class="sd">        Attributes</span>
<span class="sd">        ----------</span>
<span class="sd">        currency : str</span>
<span class="sd">            The currency of the contract.</span>
<span class="sd">        stake : int</span>
<span class="sd">            The amount to stake in each trade. Defaults to 10.</span>
<span class="sd">        symbol : str</span>
<span class="sd">            The symbol of the product. Defaults to &#39;1HZ100V&#39;.</span>
<span class="sd">        take_profit : int</span>
<span class="sd">            The take profit amount in each trade. Defaults to 0.</span>
<span class="sd">        stop_loss : int</span>
<span class="sd">            The stop loss amount in each trade. Defaults to 0.            </span>
<span class="sd">        messages : list</span>
<span class="sd">            List to store messages received from the WebSocket. Initialized as an empty list.</span>
<span class="sd">        endpoint : str</span>
<span class="sd">            The WebSocket endpoint. Defaults to &quot;wss://blue.derivws.com/websockets/v3?app_id=16929&quot;.</span>
<span class="sd">        api_token : int</span>
<span class="sd">            API token for authentication. Defaults to 0.</span>
<span class="sd">        retry : int</span>
<span class="sd">            Counter for retry attempts when sending/receiving messages. Initialized to 0.</span>
<span class="sd">        contract_ids : list</span>
<span class="sd">            List of contract IDs. Initialized as an empty list.</span>
<span class="sd">        stats : dict</span>
<span class="sd">            Dictionary to store statistics. Initialized as an empty dictionary.</span>
<span class="sd">        app_details : dict</span>
<span class="sd">            Dictionary to store application details. Initialized as an empty dictionary.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">retry</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">currency</span> <span class="o">=</span> <span class="s1">&#39;USD&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stake</span> <span class="o">=</span> <span class="mi">10</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">symbol</span> <span class="o">=</span> <span class="s1">&#39;1HZ100V&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">take_profit</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stop_loss</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">messages</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">endpoint</span> <span class="o">=</span> <span class="s2">&quot;wss://blue.derivws.com/websockets/v3?app_id=16929&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">api_token</span> <span class="o">=</span> <span class="mi">0</span> 
        <span class="bp">self</span><span class="o">.</span><span class="n">contract_ids</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">create_ws</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stats</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">GUI_data</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_set_attributes</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>

        <span class="c1"># self._set_app_details()</span>
    
<div class="viewcode-block" id="Product.export_data">
<a class="viewcode-back" href="../index.html#mvapi.Product.export_data">[docs]</a>
    <span class="k">def</span> <span class="nf">export_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file_name</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">save_timestamp</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Exports the class data to an Excel file.</span>

<span class="sd">        This method collects various data such as details, login information, contract IDs, </span>
<span class="sd">        and messages, and stores them into separate sheets in an Excel file. The file can </span>
<span class="sd">        include a timestamp in the filename if specified.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        file_name : str, optional</span>
<span class="sd">            The base name for the output file. Defaults to &#39;mvapi_output&#39; if not specified.</span>
<span class="sd">        save_timestamp : bool, optional</span>
<span class="sd">            Whether to append the current timestamp to the filename. Defaults to False.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        str</span>
<span class="sd">            The file path of the generated Excel file.</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        - The method creates separate Excel sheets for:</span>
<span class="sd">            - General details (`endpoint`, `species`).</span>
<span class="sd">            - Login information (`loginid`, `email`).</span>
<span class="sd">            - Contract IDs.</span>
<span class="sd">            - WebSocket messages.</span>
<span class="sd">            - Statistics data (stored with the original keys from `self.stats`).</span>
<span class="sd">        - If `save_timestamp` is True, the file name will include a timestamp.</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; obj = SomeClass()</span>
<span class="sd">        &gt;&gt;&gt; obj.export_data(file_name=&quot;output&quot;, save_timestamp=True)</span>
<span class="sd">        &#39;output_2023-10-05_14-30-45.xlsx&#39;</span>
<span class="sd">        &quot;&quot;&quot;</span>        
        <span class="n">timestamp</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;_%Y-%m-</span><span class="si">%d</span><span class="s1">_%H-%M-%S&#39;</span><span class="p">)</span> <span class="k">if</span> <span class="n">save_timestamp</span> <span class="k">else</span> <span class="s1">&#39;&#39;</span>
        <span class="n">file_name</span> <span class="o">=</span> <span class="n">file_name</span> <span class="k">if</span> <span class="n">file_name</span> <span class="k">else</span> <span class="s1">&#39;mvapi_output&#39;</span>
        <span class="n">logins</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">msg</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">messages</span><span class="p">:</span>
            <span class="k">if</span> <span class="s1">&#39;authorize&#39;</span> <span class="ow">in</span> <span class="n">msg</span><span class="p">:</span>
                <span class="n">logins</span><span class="p">[</span><span class="n">msg</span><span class="p">[</span><span class="s1">&#39;authorize&#39;</span><span class="p">][</span><span class="s1">&#39;loginid&#39;</span><span class="p">]]</span> <span class="o">=</span> <span class="n">msg</span><span class="p">[</span><span class="s1">&#39;authorize&#39;</span><span class="p">][</span><span class="s1">&#39;email&#39;</span><span class="p">]</span>
        <span class="n">details</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;endpoint&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">endpoint</span><span class="p">,</span> <span class="s1">&#39;species&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">species</span><span class="p">}</span>
        <span class="n">df_details</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">details</span><span class="o">.</span><span class="n">items</span><span class="p">()),</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;area&#39;</span><span class="p">,</span> <span class="s1">&#39;detail&#39;</span><span class="p">])</span>
        <span class="n">df_logins</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">logins</span><span class="o">.</span><span class="n">items</span><span class="p">()),</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;loginid&#39;</span><span class="p">,</span> <span class="s1">&#39;email&#39;</span><span class="p">])</span>
        <span class="n">df_contract_ids</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;contract_ids&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">contract_ids</span><span class="p">})</span>
        <span class="n">df_messages</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;messages&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">messages</span><span class="p">})</span>
        <span class="n">file_path</span> <span class="o">=</span> <span class="n">file_name</span> <span class="o">+</span> <span class="n">timestamp</span> <span class="o">+</span> <span class="s1">&#39;.xlsx&#39;</span>
        <span class="k">with</span> <span class="n">pd</span><span class="o">.</span><span class="n">ExcelWriter</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="n">engine</span><span class="o">=</span><span class="s1">&#39;openpyxl&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">writer</span><span class="p">:</span>
            <span class="n">df_details</span><span class="o">.</span><span class="n">to_excel</span><span class="p">(</span><span class="n">writer</span><span class="p">,</span> <span class="n">sheet_name</span><span class="o">=</span><span class="s1">&#39;details&#39;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="n">df_logins</span><span class="o">.</span><span class="n">to_excel</span><span class="p">(</span><span class="n">writer</span><span class="p">,</span> <span class="n">sheet_name</span><span class="o">=</span><span class="s1">&#39;accounts&#39;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="n">df_contract_ids</span><span class="o">.</span><span class="n">to_excel</span><span class="p">(</span><span class="n">writer</span><span class="p">,</span> <span class="n">sheet_name</span><span class="o">=</span><span class="s1">&#39;contract_ids&#39;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="n">dict_to_df</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stats</span><span class="p">[</span><span class="n">key</span><span class="p">],</span><span class="n">key</span><span class="p">)</span><span class="o">.</span><span class="n">to_excel</span><span class="p">(</span><span class="n">writer</span><span class="p">,</span> <span class="n">sheet_name</span><span class="o">=</span><span class="n">key</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="n">df_messages</span><span class="o">.</span><span class="n">to_excel</span><span class="p">(</span><span class="n">writer</span><span class="p">,</span> <span class="n">sheet_name</span><span class="o">=</span><span class="s1">&#39;ws_responses&#39;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">file_path</span></div>


<div class="viewcode-block" id="Product.__setattr__">
<a class="viewcode-back" href="../index.html#mvapi.Product.__setattr__">[docs]</a>
    <span class="k">def</span> <span class="fm">__setattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set the value of an attribute and trigger corresponding actions based on the attribute.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        key : str</span>
<span class="sd">            The name of the attribute to set.</span>
<span class="sd">        value : any</span>
<span class="sd">            The value to assign to the attribute.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        - If `key` is &#39;endpoint&#39;, the WebSocket connection is created.</span>
<span class="sd">        - If `key` is &#39;api_token&#39;, the authorization process is initiated.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__setattr__</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
        <span class="k">match</span> <span class="n">key</span><span class="p">:</span>
            <span class="k">case</span> <span class="s1">&#39;endpoint&#39;</span><span class="p">:</span>
                <span class="c1"># self._set_app_details(self)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">create_ws</span><span class="p">()</span>
            <span class="k">case</span> <span class="s1">&#39;api_token&#39;</span><span class="p">:</span> 
                <span class="k">if</span> <span class="n">value</span><span class="p">:</span>
                    <span class="c1"># self._set_app_details(self)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">authorise</span><span class="p">()</span></div>


<div class="viewcode-block" id="Product._set_attributes">
<a class="viewcode-back" href="../index.html#mvapi.Product._set_attributes">[docs]</a>
    <span class="k">def</span> <span class="nf">_set_attributes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set multiple attributes on the object using keyword arguments and trigger corresponding actions based on the attribute.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        **kwargs : dict</span>
<span class="sd">            A dictionary of key-value pairs where each key is an attribute name and each value is the attribute value to set.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        - If `key` is &#39;take_profit&#39;, the take profit limit order is set.</span>
<span class="sd">        - If `key` is &#39;stop_loss&#39;, the stop loss limit order is set.</span>
<span class="sd">        &quot;&quot;&quot;</span>        
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">match</span> <span class="n">key</span><span class="p">:</span>
                <span class="k">case</span> <span class="s1">&#39;take_profit&#39;</span><span class="p">:</span>
                    <span class="n">set_limit_orders</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">take_profit</span><span class="o">=</span><span class="n">value</span><span class="p">)</span> 
                <span class="k">case</span> <span class="s1">&#39;stop_loss&#39;</span><span class="p">:</span>
                    <span class="n">set_limit_orders</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stop_loss</span><span class="o">=</span><span class="n">value</span><span class="p">)</span> 
                <span class="k">case</span> <span class="s1">&#39;cancellation&#39;</span><span class="p">:</span>
                    <span class="n">set_mult_cancellation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cancellation</span><span class="o">=</span><span class="n">value</span><span class="p">)</span>
                <span class="k">case</span><span class="w"> </span><span class="k">_</span><span class="p">:</span>
                    <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span></div>


    <span class="c1"># def _set_app_details(self) -&gt; None:</span>
    <span class="c1">#     &quot;&quot;&quot;</span>
    <span class="c1">#     Retrieves application details such as endpoint, API token, app ID, and app markup percentage.</span>

    <span class="c1">#     This method updates the `app_details` attribute with the current endpoint and API token. </span>
    <span class="c1">#     It also retrieves and adds the application ID and markup percentage to the `app_details`.</span>

    <span class="c1">#     Returns</span>
    <span class="c1">#     -------</span>
    <span class="c1">#     None</span>
    <span class="c1">#     &quot;&quot;&quot;</span>
    <span class="c1">#     self.app_details = {</span>
    <span class="c1">#         &#39;endpoint&#39;: self.endpoint,</span>
    <span class="c1">#         &#39;api_token&#39;: self.api_token</span>
    <span class="c1">#     }</span>
    <span class="c1">#     self.app_details[&#39;app_id&#39;] = self._get_app_id(self.endpoint)</span>
    <span class="c1">#     self.app_details[&#39;app_markup_percentage&#39;] = self._get_app_markup()</span>

    <span class="c1"># def _get_app_markup(self) -&gt; float:</span>
    <span class="c1">#     # Not feasible</span>
    <span class="c1">#     &quot;&quot;&quot;</span>
    <span class="c1">#     Retrieves the application markup percentage.</span>

    <span class="c1">#     This method sends a request to get the application markup percentage after authorizing the WebSocket connection. </span>
    <span class="c1">#     If an error occurs or the markup percentage is not available, it returns 0.</span>

    <span class="c1">#     Returns</span>
    <span class="c1">#     -------</span>
    <span class="c1">#     float</span>
    <span class="c1">#         The application markup percentage. Defaults to 0 if not retrievable.</span>
    <span class="c1">#     &quot;&quot;&quot;</span>
    <span class="c1">#     if self.authorise():</span>
    <span class="c1">#         temp_message = {</span>
    <span class="c1">#         &quot;app_get&quot;: self.app_details[&#39;app_id&#39;]</span>
    <span class="c1">#         }   </span>
    <span class="c1">#         self.send_message(temp_message)</span>
            
    <span class="c1">#     try:</span>
    <span class="c1">#         app_markup_percentage = self.last_msg[&#39;app_get&#39;][&#39;app_markup_percentage&#39;]</span>
    <span class="c1">#     except Exception as e:</span>
    <span class="c1">#         app_markup_percentage = 0</span>
    <span class="c1">#     return app_markup_percentage</span>

    <span class="c1"># def _get_app_id(self, string) -&gt; int:</span>
    <span class="c1">#     # Not feasible</span>
    <span class="c1">#     &quot;&quot;&quot;</span>
    <span class="c1">#     Extracts the application ID from the endpoint URL.</span>

    <span class="c1">#     This method parses the `app_id` from the endpoint URL string. </span>
    <span class="c1">#     If parsing fails, it returns 0.</span>

    <span class="c1">#     Parameters</span>
    <span class="c1">#     ----------</span>
    <span class="c1">#     string : str</span>
    <span class="c1">#         The endpoint URL from which to extract the application ID.</span>

    <span class="c1">#     Returns</span>
    <span class="c1">#     -------</span>
    <span class="c1">#     int</span>
    <span class="c1">#         The extracted application ID. Defaults to 0 if not found.</span>
    <span class="c1">#     &quot;&quot;&quot;</span>
    <span class="c1">#     try:</span>
    <span class="c1">#         app_id = int(re.search(r&quot;app_id=(\d+)&quot;, string).group(1))</span>
    <span class="c1">#     except Exception as e:</span>
    <span class="c1">#         app_id = 0</span>
    <span class="c1">#     return app_id</span>

<div class="viewcode-block" id="Product._proposal">
<a class="viewcode-back" href="../index.html#mvapi.Product._proposal">[docs]</a>
    <span class="k">def</span> <span class="nf">_proposal</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Generates a proposal based on the current proposal type.</span>

<span class="sd">        This method creates a JSON proposal based on the value of `proposal_type`. </span>
<span class="sd">        It handles different proposal types such as buying a contract, </span>
<span class="sd">        requesting a proposal, selling a contract, or raises an error if the type is not implemented.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        str</span>
<span class="sd">            The JSON string representation of the proposal.</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        NotImplementedError</span>
<span class="sd">            If the `proposal_type` is &#39;price_proposal&#39;, indicating that this method should be used via a subclass.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">proposal</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">proposal_type</span> <span class="o">==</span> <span class="s1">&#39;buy_contract&#39;</span><span class="p">:</span>
            <span class="n">proposal</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;buy&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">proposal_id</span><span class="p">,</span>
                <span class="s2">&quot;price&quot;</span><span class="p">:</span> <span class="mi">1000000</span>
            <span class="p">}</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">proposal_type</span> <span class="o">==</span> <span class="s1">&#39;contract_proposal&#39;</span><span class="p">:</span>
            <span class="n">proposal</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;proposal_open_contract&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
                <span class="s2">&quot;contract_id&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">contract_id</span>
            <span class="p">}</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">subscribe</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">proposal</span><span class="p">[</span><span class="s2">&quot;subscribe&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">proposal_type</span> <span class="o">==</span> <span class="s1">&#39;sell_contract&#39;</span><span class="p">:</span>
            <span class="n">proposal</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;sell&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">contract_id</span><span class="p">,</span>  
                <span class="s2">&quot;price&quot;</span><span class="p">:</span> <span class="mi">0</span>
            <span class="p">}</span>
        <span class="c1"># To ensure this class isn&#39;t used to do price proposals without a defined contract type</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">proposal_type</span> <span class="o">==</span> <span class="s1">&#39;price_proposal&#39;</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s1">&#39;Use a Subclass to use this method&#39;</span><span class="p">)</span>
                
        <span class="k">return</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">proposal</span><span class="p">)</span></div>


<div class="viewcode-block" id="Product._send">
<a class="viewcode-back" href="../index.html#mvapi.Product._send">[docs]</a>
    <span class="k">def</span> <span class="nf">_send</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sends the current proposal to the WebSocket and handles the response.</span>

<span class="sd">        This method ensures the WebSocket connection is active, sends the proposal created by `_proposal()`, </span>
<span class="sd">        and processes the response received from the WebSocket.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        bool</span>
<span class="sd">            `True` if the message was successfully sent and a response was handled, otherwise `False`.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_check_connection</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ws</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_proposal</span><span class="p">())</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_recv_msg_handler</span><span class="p">()</span></div>

        
<div class="viewcode-block" id="Product.send_message">
<a class="viewcode-back" href="../index.html#mvapi.Product.send_message">[docs]</a>
    <span class="k">def</span> <span class="nf">send_message</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sends a user-defined JSON message to the WebSocket and returns the response.</span>

<span class="sd">        This method ensures the WebSocket connection is active, sends the provided message, </span>
<span class="sd">        and processes the response. If an exception occurs, it retries sending the message.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        message : dict</span>
<span class="sd">            The JSON message to send to the WebSocket.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        dict</span>
<span class="sd">            The response received from the WebSocket.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_check_connection</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ws</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">message</span><span class="p">))</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">response</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ws</span><span class="o">.</span><span class="n">recv</span><span class="p">())</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">send_message</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">last_msg</span> <span class="o">=</span> <span class="n">response</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">messages</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">last_msg</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">response</span></div>

    
<div class="viewcode-block" id="Product.stream">
<a class="viewcode-back" href="../index.html#mvapi.Product.stream">[docs]</a>
    <span class="k">def</span> <span class="nf">stream</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Streams data from the WebSocket.</span>

<span class="sd">        This method sends a proposal to the WebSocket and processes the incoming messages. </span>
<span class="sd">        It handles the subscription to updates and stops streaming if the contract is closed or </span>
<span class="sd">        a keyboard interrupt is detected.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        int</span>
<span class="sd">            Returns 1 upon successful completion of the streaming process.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_check_connection</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ws</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_proposal</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_recv_msg_handler</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check_closed</span><span class="p">():</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Contract cannot be sold&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">subscribe</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_send</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">subscription_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">last_msg</span><span class="p">[</span><span class="s1">&#39;subscription&#39;</span><span class="p">][</span><span class="s1">&#39;id&#39;</span><span class="p">]</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
                    <span class="n">clear_output</span><span class="p">(</span><span class="n">wait</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_recv_msg_handler</span><span class="p">()</span>
                    <span class="n">display</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">last_msg</span><span class="p">)</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Keyboard Interrupt to stop streaming&#39;</span><span class="p">)</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check_closed</span><span class="p">():</span>
                        <span class="k">break</span>
            <span class="k">except</span> <span class="ne">KeyboardInterrupt</span><span class="p">:</span>
                <span class="k">pass</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ws</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">({</span><span class="s2">&quot;forget&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">subscription_id</span><span class="p">}))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_recv_msg_handler</span><span class="p">()</span>
        <span class="k">return</span> <span class="mi">1</span></div>

        
<div class="viewcode-block" id="Product.price_proposal">
<a class="viewcode-back" href="../index.html#mvapi.Product.price_proposal">[docs]</a>
    <span class="k">def</span> <span class="nf">price_proposal</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">random</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">buy</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Requests a price proposal from the WebSocket.</span>

<span class="sd">        This method sets the proposal type to &#39;price_proposal&#39; and updates attributes based on </span>
<span class="sd">        the provided arguments. It sends the proposal and optionally displays the response if </span>
<span class="sd">        the `buy` parameter is `False`.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        random : bool, optional</span>
<span class="sd">            Whether to randomize attributes before sending the proposal. Defaults to `False`.</span>
<span class="sd">        buy : bool, optional</span>
<span class="sd">            Whether to buy the contract immediately after receiving the proposal. Defaults to `False`.</span>
<span class="sd">        take_profit : float, optional</span>
<span class="sd">            The take profit value for the proposal. Defaults to 0.</span>
<span class="sd">        stop_loss : float, optional</span>
<span class="sd">            The stop loss value for the proposal. Defaults to 0.</span>
<span class="sd">        **kwargs : keyword arguments</span>
<span class="sd">            Additional attributes to set for the proposal.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        bool</span>
<span class="sd">            `True` if the proposal was successfully sent and a response was received; otherwise, `False`.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">random</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">randomise_attributes</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_set_attributes</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">proposal_type</span> <span class="o">=</span> <span class="s1">&#39;price_proposal&#39;</span>
        <span class="n">success</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_send</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">buy</span> <span class="ow">and</span> <span class="n">success</span><span class="p">:</span>
            <span class="n">display</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">last_msg</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">GUI_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">last_msg</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">success</span></div>

    
<div class="viewcode-block" id="Product.buy_contract">
<a class="viewcode-back" href="../index.html#mvapi.Product.buy_contract">[docs]</a>
    <span class="k">def</span> <span class="nf">buy_contract</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">runs</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">random</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Attempts to buy a contract.</span>

<span class="sd">        This method tries to buy a contract for a specified number of `runs`. It randomizes </span>
<span class="sd">        attributes if required and sends a price proposal with the `buy` parameter set to `True`. </span>
<span class="sd">        Upon success, it updates the `proposal_id` and sends a buy contract proposal. The contract </span>
<span class="sd">        ID is then appended to the `contract_ids` list.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        runs : int, optional</span>
<span class="sd">            The number of contracts to attempt to buy. Defaults to 1.</span>
<span class="sd">        random : bool, optional</span>
<span class="sd">            Whether to randomize attributes before sending the proposal. Defaults to `False`.</span>
<span class="sd">        **kwargs : keyword arguments</span>
<span class="sd">            Additional attributes to set for the proposal.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        int</span>
<span class="sd">            Returns 1 upon successful buy else 0.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">temp_flag</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">while</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">runs</span><span class="p">:</span>
            <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="n">random</span> <span class="ow">or</span> <span class="n">runs</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">randomise_attributes</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_set_attributes</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">price_proposal</span><span class="p">(</span><span class="n">buy</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">proposal_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">last_msg</span><span class="p">[</span><span class="s1">&#39;proposal&#39;</span><span class="p">][</span><span class="s1">&#39;id&#39;</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">proposal_type</span> <span class="o">=</span> <span class="s1">&#39;buy_contract&#39;</span>
                <span class="n">temp_flag</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_send</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">temp_flag</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">contract_ids</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">last_msg</span><span class="p">[</span><span class="s1">&#39;buy&#39;</span><span class="p">][</span><span class="s1">&#39;contract_id&#39;</span><span class="p">])</span>
                    <span class="n">clear_output</span><span class="p">(</span><span class="n">wait</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                    <span class="nb">print</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
                    <span class="n">display</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">contract_proposal</span><span class="p">())</span>
        <span class="k">return</span> <span class="n">temp_flag</span></div>

        
<div class="viewcode-block" id="Product.contract_proposal">
<a class="viewcode-back" href="../index.html#mvapi.Product.contract_proposal">[docs]</a>
    <span class="k">def</span> <span class="nf">contract_proposal</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">contract_id</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">subscribe</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Gets the contract proposal.</span>

<span class="sd">        This method retrieves the details of a contract using the provided `contract_id`. </span>
<span class="sd">        If no `contract_id` is provided, it uses the last saved contract ID. It sends a </span>
<span class="sd">        contract proposal message and optionally subscribes to updates based on the `subscribe` parameter. </span>
<span class="sd">        If `subscribe` is set to 1, it starts streaming the contract updates.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        contract_id : str, optional</span>
<span class="sd">            The ID of the contract to retrieve details for. If not provided, the last saved contract ID is used.</span>
<span class="sd">        subscribe : int, optional</span>
<span class="sd">            Whether to subscribe to updates for the contract. Defaults to 0 (no subscription). If set to 1, </span>
<span class="sd">            streaming of contract updates is initiated.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">contract_id</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">contract_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">contract_ids</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span> 
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;No Contract ID saved.&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">contract_id</span> <span class="o">=</span> <span class="n">contract_id</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">proposal_type</span> <span class="o">=</span> <span class="s1">&#39;contract_proposal&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">subscribe</span> <span class="o">=</span> <span class="n">subscribe</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">subscribe</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_send</span><span class="p">()</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">subscribe</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">stream</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">GUI_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">last_msg</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">last_msg</span></div>

            
<div class="viewcode-block" id="Product.get_all_poc">
<a class="viewcode-back" href="../index.html#mvapi.Product.get_all_poc">[docs]</a>
    <span class="k">def</span> <span class="nf">get_all_poc</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Retrieves all open contract proposals.</span>

<span class="sd">        This method iterates through all contract IDs stored in `self.contract_ids` and retrieves the details </span>
<span class="sd">        for each open contract by calling the `contract_proposal` method with each contract ID.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">temp_id</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">contract_ids</span><span class="p">:</span>
            <span class="n">clear_output</span><span class="p">(</span><span class="n">wait</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">contract_proposal</span><span class="p">(</span><span class="n">contract_id</span><span class="o">=</span><span class="n">temp_id</span><span class="p">)</span></div>

            
<div class="viewcode-block" id="Product.tick_history">
<a class="viewcode-back" href="../index.html#mvapi.Product.tick_history">[docs]</a>
    <span class="k">def</span> <span class="nf">tick_history</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">symbol</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">count</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s1">&#39;latest&#39;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Fetches historical tick data for the specified symbol.</span>

<span class="sd">        This method constructs a message to request historical tick data from the WebSocket API. It sends the </span>
<span class="sd">        request with parameters specifying the symbol, number of ticks to retrieve, and the end time.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        symbol : str, optional</span>
<span class="sd">            The symbol for which to retrieve tick history. If not provided, defaults to `self.symbol`.</span>
<span class="sd">        count : int, optional</span>
<span class="sd">            The number of ticks to retrieve. Defaults to 1.</span>
<span class="sd">        end : str, optional</span>
<span class="sd">            The end time for the tick data. Defaults to &#39;latest&#39;.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        dict</span>
<span class="sd">            The response from the WebSocket API containing the tick history data.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">temp_msg</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;ticks_history&quot;</span><span class="p">:</span> <span class="n">symbol</span> <span class="k">if</span> <span class="n">symbol</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">symbol</span><span class="p">,</span>
            <span class="s2">&quot;adjust_start_time&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
            <span class="s2">&quot;count&quot;</span><span class="p">:</span> <span class="n">count</span><span class="p">,</span>
            <span class="s2">&quot;end&quot;</span><span class="p">:</span> <span class="n">end</span><span class="p">,</span>
            <span class="s2">&quot;start&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
            <span class="s2">&quot;style&quot;</span><span class="p">:</span> <span class="s2">&quot;ticks&quot;</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">send_message</span><span class="p">(</span><span class="n">temp_msg</span><span class="p">)</span></div>

        
<div class="viewcode-block" id="Product._check_connection">
<a class="viewcode-back" href="../index.html#mvapi.Product._check_connection">[docs]</a>
    <span class="k">def</span> <span class="nf">_check_connection</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Checks the WebSocket connection by sending a ping message and waiting for a response. If an exception </span>
<span class="sd">        occurs (indicating the connection is closed), it attempts to reconnect by creating a new WebSocket </span>
<span class="sd">        connection.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># Send a ping message</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ws</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">({</span><span class="s2">&quot;ping&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">}))</span>
            <span class="c1"># Receive a response</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ws</span><span class="o">.</span><span class="n">recv</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Connection Closed, Reconnecting&#39;</span><span class="p">)</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.2</span><span class="p">)</span>
            <span class="n">clear_output</span><span class="p">(</span><span class="n">wait</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">create_ws</span><span class="p">()</span></div>

            
<div class="viewcode-block" id="Product._check_closed">
<a class="viewcode-back" href="../index.html#mvapi.Product._check_closed">[docs]</a>
    <span class="k">def</span> <span class="nf">_check_closed</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Checks if the contract has expired or been sold.</span>

<span class="sd">        This method inspects the latest message received from the WebSocket API to determine if the contract is </span>
<span class="sd">        expired or sold.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        int</span>
<span class="sd">            1 if the contract is expired or sold, otherwise 0.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">last_msg</span><span class="p">[</span><span class="s1">&#39;proposal_open_contract&#39;</span><span class="p">][</span><span class="s1">&#39;is_expired&#39;</span><span class="p">]</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">last_msg</span><span class="p">[</span><span class="s1">&#39;proposal_open_contract&#39;</span><span class="p">][</span><span class="s1">&#39;is_sold&#39;</span><span class="p">]:</span>
            <span class="k">return</span> <span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span> 
            <span class="k">return</span> <span class="mi">0</span></div>

            
<div class="viewcode-block" id="Product.sell_contract">
<a class="viewcode-back" href="../index.html#mvapi.Product.sell_contract">[docs]</a>
    <span class="k">def</span> <span class="nf">sell_contract</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">contract_id</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Attempts to sell a contract by its ID.</span>

<span class="sd">        This method sets the proposal type to &#39;sell_contract&#39; and sends the proposal to the WebSocket API. </span>
<span class="sd">        It handles the response and displays the result. If the proposal is unsuccessful, it retrieves the </span>
<span class="sd">        contract proposal details again.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        contract_id : str, optional</span>
<span class="sd">            The ID of the contract to sell. If not provided, the last saved contract ID is used.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        int</span>
<span class="sd">            Returns 1 upon successful sell else 0.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">contract_id</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">contract_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">contract_ids</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">contract_id</span> <span class="o">=</span> <span class="n">contract_id</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">proposal_type</span> <span class="o">=</span> <span class="s1">&#39;sell_contract&#39;</span>
        <span class="n">temp_flag</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_send</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">temp_flag</span><span class="p">:</span>
            <span class="n">display</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">last_msg</span><span class="p">)</span>
            <span class="c1"># self.GUI_data.append(self.last_msg)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">contract_proposal</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">contract_id</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">contract_proposal</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">contract_id</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">temp_flag</span></div>


<div class="viewcode-block" id="Product.sell_all_contracts">
<a class="viewcode-back" href="../index.html#mvapi.Product.sell_all_contracts">[docs]</a>
    <span class="k">def</span> <span class="nf">sell_all_contracts</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sells all contracts in the contract IDs list.</span>

<span class="sd">        This method iterates over the list of contract IDs, and attempts to sell each contract one by one</span>
<span class="sd">        by calling the `sell_contract` method</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>
<span class="sd">        &quot;&quot;&quot;</span> 
        <span class="k">for</span> <span class="n">temp_id</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">contract_ids</span><span class="p">:</span>
            <span class="n">clear_output</span><span class="p">(</span><span class="n">wait</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sell_contract</span><span class="p">(</span><span class="n">contract_id</span><span class="o">=</span><span class="n">temp_id</span><span class="p">)</span></div>

    
<div class="viewcode-block" id="Product.create_ws">
<a class="viewcode-back" href="../index.html#mvapi.Product.create_ws">[docs]</a>
    <span class="k">def</span> <span class="nf">create_ws</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Creates a WebSocket connection to the specified endpoint.</span>

<span class="sd">        This method initializes the WebSocket connection using the endpoint URL. It sets the `ws` attribute </span>
<span class="sd">        to the WebSocket connection object.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ws</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_set_attributes</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ws</span> <span class="o">=</span> <span class="n">websocket</span><span class="o">.</span><span class="n">create_connection</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">endpoint</span><span class="p">)</span></div>


<div class="viewcode-block" id="Product.authorise">
<a class="viewcode-back" href="../index.html#mvapi.Product.authorise">[docs]</a>
    <span class="k">def</span> <span class="nf">authorise</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Authorizes the WebSocket connection using the provided API token.</span>

<span class="sd">        This method sends an authorization request with the API token and checks the response to determine </span>
<span class="sd">        if the authorization was successful.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        int</span>
<span class="sd">            1 if authorization is successful, otherwise 0.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_check_connection</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_set_attributes</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ws</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">({</span><span class="s2">&quot;authorize&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">api_token</span><span class="p">}))</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_recv_msg_handler</span><span class="p">():</span>
            <span class="k">return</span> <span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="mi">0</span></div>

    
<div class="viewcode-block" id="Product._recv_msg_handler">
<a class="viewcode-back" href="../index.html#mvapi.Product._recv_msg_handler">[docs]</a>
    <span class="k">def</span> <span class="nf">_recv_msg_handler</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Handles the reception of messages from the WebSocket.</span>

<span class="sd">        This method attempts to receive and process messages from the WebSocket. It handles errors and retries </span>
<span class="sd">        sending the request if necessary. Specific errors are managed with different strategies, such as reauthorizing </span>
<span class="sd">        or adjusting contract parameters based on the error details.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        int</span>
<span class="sd">            1 if the message is received and processed successfully, otherwise 0.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">temp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ws</span><span class="o">.</span><span class="n">recv</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">last_msg</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">temp</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">retry</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_send</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">messages</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">last_msg</span><span class="p">)</span>
        <span class="n">error_handle_flag</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">if</span> <span class="s1">&#39;error&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">last_msg</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">retry</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">error</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">last_msg</span><span class="p">[</span><span class="s1">&#39;error&#39;</span><span class="p">]</span>
            <span class="k">match</span> <span class="n">error</span><span class="p">[</span><span class="s1">&#39;code&#39;</span><span class="p">]:</span>
                <span class="k">case</span> <span class="s1">&#39;RateLimit&#39;</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">create_ws</span><span class="p">()</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">retry</span> <span class="o">+=</span><span class="mi">1</span>
                <span class="k">case</span> <span class="s1">&#39;InvalidToken&#39;</span> <span class="o">|</span> <span class="s1">&#39;OpenPositionLimitExceeded&#39;</span> <span class="o">|</span> <span class="s1">&#39;InvalidSellContractProposal&#39;</span> <span class="o">|</span> <span class="s1">&#39;InvalidtoSell&#39;</span> <span class="o">|</span> <span class="s1">&#39;InvalidOfferings&#39;</span><span class="p">:</span>
                    <span class="n">display</span><span class="p">(</span><span class="n">error</span><span class="p">)</span>
                    <span class="n">error_handle_flag</span> <span class="o">=</span> <span class="mi">1</span> 
                <span class="k">case</span> <span class="s1">&#39;AuthorizationRequired&#39;</span><span class="p">:</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">authorise</span><span class="p">():</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">retry</span> <span class="o">+=</span><span class="mi">1</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">display</span><span class="p">(</span><span class="s1">&#39;Auth failed&#39;</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span>
                        <span class="n">error_handle_flag</span> <span class="o">=</span> <span class="mi">1</span> 
                <span class="k">case</span> <span class="s1">&#39;OfferingsValidationError&#39;</span><span class="p">:</span>
                    <span class="k">if</span> <span class="s1">&#39;Number of ticks must be between&#39;</span> <span class="ow">in</span> <span class="n">error</span><span class="p">[</span><span class="s1">&#39;message&#39;</span><span class="p">]:</span>
                        <span class="n">arr</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;\d+&#39;</span><span class="p">,</span> <span class="n">error</span><span class="p">[</span><span class="s1">&#39;message&#39;</span><span class="p">])))</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">duration</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="n">arr</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">arr</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                    <span class="k">elif</span> <span class="n">error</span><span class="p">[</span><span class="s1">&#39;message&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;Trading is not offered for this asset.&#39;</span><span class="p">:</span> 
                        <span class="bp">self</span><span class="o">.</span><span class="n">symbol</span> <span class="o">=</span> <span class="s1">&#39;R_100&#39;</span>        
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">display</span><span class="p">(</span><span class="n">error</span><span class="p">)</span>
                        <span class="n">error_handle_flag</span> <span class="o">=</span> <span class="mi">1</span> 
                <span class="k">case</span> <span class="s1">&#39;ContractBuyValidationError&#39;</span> <span class="o">|</span> <span class="s1">&#39;OfferingsValidationFailure&#39;</span><span class="p">:</span>
                    <span class="k">if</span> <span class="s1">&#39;message&#39;</span> <span class="ow">in</span> <span class="n">error</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="ow">and</span> <span class="n">error</span><span class="p">[</span><span class="s1">&#39;message&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;This trade is temporarily unavailable.&#39;</span><span class="p">:</span>
                        <span class="n">display</span><span class="p">(</span><span class="n">error</span><span class="p">)</span>
                        <span class="n">error_handle_flag</span> <span class="o">=</span> <span class="mi">1</span> 
                    <span class="k">elif</span> <span class="n">error</span><span class="p">[</span><span class="s1">&#39;details&#39;</span><span class="p">][</span><span class="s1">&#39;field&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;barrier&#39;</span><span class="p">:</span>
                        <span class="k">try</span><span class="p">:</span> 
                            <span class="bp">self</span><span class="o">.</span><span class="n">strike</span> <span class="o">=</span> <span class="n">error</span><span class="p">[</span><span class="s1">&#39;details&#39;</span><span class="p">][</span><span class="s1">&#39;barrier_choices&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
                            <span class="c1"># self.strike = random.choice(error[&#39;details&#39;][&#39;barrier_choices&#39;])</span>
                        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">strike</span> <span class="o">=</span> <span class="s1">&#39;1000&#39;</span>
                    <span class="k">elif</span> <span class="n">error</span><span class="p">[</span><span class="s1">&#39;details&#39;</span><span class="p">][</span><span class="s1">&#39;field&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;amount&#39;</span><span class="p">:</span>
                        <span class="c1"># display(self.last_msg)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">stake</span> <span class="o">=</span> <span class="n">error</span><span class="p">[</span><span class="s1">&#39;details&#39;</span><span class="p">][</span><span class="s1">&#39;min_stake&#39;</span><span class="p">]</span>
                    <span class="k">elif</span> <span class="n">error</span><span class="p">[</span><span class="s1">&#39;details&#39;</span><span class="p">][</span><span class="s1">&#39;field&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;duration&#39;</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">duration</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">200</span><span class="p">)</span>
                    <span class="k">elif</span> <span class="n">error</span><span class="p">[</span><span class="s1">&#39;details&#39;</span><span class="p">][</span><span class="s1">&#39;field&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;multiplier&#39;</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">multiplier</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;\d+&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">last_msg</span><span class="p">[</span><span class="s1">&#39;error&#39;</span><span class="p">][</span><span class="s1">&#39;message&#39;</span><span class="p">]))))</span>
                    <span class="k">elif</span> <span class="n">error</span><span class="p">[</span><span class="s1">&#39;details&#39;</span><span class="p">][</span><span class="s1">&#39;field&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;payout_per_point&#39;</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">payout_per_point</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">error</span><span class="p">[</span><span class="s1">&#39;details&#39;</span><span class="p">][</span><span class="s1">&#39;payout_per_point_choices&#39;</span><span class="p">])</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">display</span><span class="p">(</span><span class="n">error</span><span class="p">)</span>
                        <span class="n">error_handle_flag</span> <span class="o">=</span> <span class="mi">1</span> 
                <span class="k">case</span> <span class="s1">&#39;InvalidContractProposal&#39;</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">buy_contract</span><span class="p">()</span>
                <span class="k">case</span> <span class="s1">&#39;ContractCreationFailure&#39;</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">randomise_attributes</span><span class="p">()</span>
                <span class="k">case</span><span class="w"> </span><span class="k">_</span><span class="p">:</span> <span class="c1"># Default case</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Undefined Error&#39;</span><span class="p">)</span>
                    <span class="n">display</span><span class="p">(</span><span class="n">error</span><span class="p">)</span>
                    <span class="n">error_handle_flag</span> <span class="o">=</span> <span class="mi">1</span> 
            <span class="k">if</span> <span class="n">error_handle_flag</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">retry</span> <span class="o">&gt;</span> <span class="mi">8</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">retry</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="k">return</span> <span class="mi">0</span>                
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">retry</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span> 
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_send</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">retry</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="k">return</span> <span class="mi">0</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">retry</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">return</span> <span class="mi">1</span></div>
</div>


<div class="viewcode-block" id="accu_barriers">
<a class="viewcode-back" href="../index.html#mvapi.accu_barriers">[docs]</a>
<span class="k">def</span> <span class="nf">accu_barriers</span><span class="p">(</span><span class="n">prop</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Determines if the higher, lower, and barrier distance of the current spot are accurate for an accumulator contract.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    prop : dict</span>
<span class="sd">        The proposal dictionary containing contract details and spot information.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    tuple</span>
<span class="sd">        A tuple containing the calculated high barrier, low barrier, barrier distance, and a boolean indicating </span>
<span class="sd">        if the barriers and distance are accurate.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">contract_details</span> <span class="o">=</span> <span class="n">prop</span><span class="p">[</span><span class="s1">&#39;proposal&#39;</span><span class="p">][</span><span class="s1">&#39;contract_details&#39;</span><span class="p">]</span>
    <span class="n">spot</span> <span class="o">=</span> <span class="n">prop</span><span class="p">[</span><span class="s1">&#39;proposal&#39;</span><span class="p">][</span><span class="s1">&#39;spot&#39;</span><span class="p">]</span>
    <span class="n">symbol</span> <span class="o">=</span> <span class="n">prop</span><span class="p">[</span><span class="s1">&#39;echo_req&#39;</span><span class="p">][</span><span class="s1">&#39;symbol&#39;</span><span class="p">]</span>
    <span class="n">tick_size_barrier</span> <span class="o">=</span> <span class="n">symbols</span><span class="p">[</span><span class="n">symbol</span><span class="p">][</span><span class="s1">&#39;accu&#39;</span><span class="p">][</span><span class="s1">&#39;barrier&#39;</span><span class="p">][</span><span class="nb">str</span><span class="p">(</span><span class="n">prop</span><span class="p">[</span><span class="s1">&#39;echo_req&#39;</span><span class="p">][</span><span class="s1">&#39;growth_rate&#39;</span><span class="p">])]</span>

    <span class="n">high_bar</span><span class="p">,</span> <span class="n">low_bar</span><span class="p">,</span> <span class="n">bar_dist</span> <span class="o">=</span> \
        <span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">spot</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">tick_size_barrier</span><span class="p">),</span> <span class="n">symbols</span><span class="p">[</span><span class="n">symbol</span><span class="p">][</span><span class="s1">&#39;precision&#39;</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">)),</span> \
        <span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">spot</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">tick_size_barrier</span><span class="p">),</span> <span class="n">symbols</span><span class="p">[</span><span class="n">symbol</span><span class="p">][</span><span class="s1">&#39;precision&#39;</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">)),</span> \
        <span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">spot</span> <span class="o">*</span> <span class="p">(</span><span class="n">tick_size_barrier</span><span class="p">),</span> <span class="n">symbols</span><span class="p">[</span><span class="n">symbol</span><span class="p">][</span><span class="s1">&#39;precision&#39;</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span>
    <span class="n">pass_fail</span> <span class="o">=</span>\
    <span class="nb">abs</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">contract_details</span><span class="p">[</span><span class="s1">&#39;high_barrier&#39;</span><span class="p">])</span> <span class="o">-</span> <span class="n">high_bar</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="o">/</span><span class="mi">10</span><span class="o">**</span><span class="n">symbols</span><span class="p">[</span><span class="n">symbol</span><span class="p">][</span><span class="s1">&#39;precision&#39;</span><span class="p">]</span> <span class="ow">and</span> \
    <span class="nb">abs</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">contract_details</span><span class="p">[</span><span class="s1">&#39;low_barrier&#39;</span><span class="p">])</span> <span class="o">-</span> <span class="n">low_bar</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="o">/</span><span class="mi">10</span><span class="o">**</span><span class="n">symbols</span><span class="p">[</span><span class="n">symbol</span><span class="p">][</span><span class="s1">&#39;precision&#39;</span><span class="p">]</span> <span class="ow">and</span> \
    <span class="nb">abs</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">contract_details</span><span class="p">[</span><span class="s1">&#39;barrier_spot_distance&#39;</span><span class="p">])</span> <span class="o">-</span> <span class="n">bar_dist</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="o">/</span><span class="mi">10</span><span class="o">**</span><span class="n">symbols</span><span class="p">[</span><span class="n">symbol</span><span class="p">][</span><span class="s1">&#39;precision&#39;</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">high_bar</span><span class="p">,</span> <span class="n">low_bar</span><span class="p">,</span> <span class="n">bar_dist</span><span class="p">,</span> <span class="n">pass_fail</span></div>


<div class="viewcode-block" id="accu_payout">
<a class="viewcode-back" href="../index.html#mvapi.accu_payout">[docs]</a>
<span class="k">def</span> <span class="nf">accu_payout</span><span class="p">(</span><span class="n">prop</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculates the payout, match flag, and close flag for an accumulator contract.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    prop : dict</span>
<span class="sd">        The proposal open contract dictionary containing contract details, spot information, and other related data.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    tuple</span>
<span class="sd">        A tuple containing the calculated payout, a boolean indicating if the payout matches the bid price, </span>
<span class="sd">        and a string indicating the close flag status.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">symbol</span> <span class="o">=</span> <span class="n">prop</span><span class="p">[</span><span class="s1">&#39;proposal_open_contract&#39;</span><span class="p">][</span><span class="s1">&#39;underlying&#39;</span><span class="p">]</span>
    <span class="n">stake</span> <span class="o">=</span> <span class="n">get_stake</span><span class="p">(</span><span class="n">prop</span><span class="p">)</span>
    <span class="n">growth_rate</span> <span class="o">=</span> <span class="n">prop</span><span class="p">[</span><span class="s1">&#39;proposal_open_contract&#39;</span><span class="p">][</span><span class="s1">&#39;growth_rate&#39;</span><span class="p">]</span>
    <span class="n">barrier</span> <span class="o">=</span> <span class="n">symbols</span><span class="p">[</span><span class="n">symbol</span><span class="p">][</span><span class="s1">&#39;accu&#39;</span><span class="p">][</span><span class="s1">&#39;barrier&#39;</span><span class="p">][</span><span class="nb">str</span><span class="p">(</span><span class="n">growth_rate</span><span class="p">)]</span>
    <span class="n">currency</span> <span class="o">=</span> <span class="n">prop</span><span class="p">[</span><span class="s1">&#39;proposal_open_contract&#39;</span><span class="p">][</span><span class="s1">&#39;currency&#39;</span><span class="p">]</span>
    <span class="n">ticks</span> <span class="o">=</span> <span class="n">prop</span><span class="p">[</span><span class="s1">&#39;proposal_open_contract&#39;</span><span class="p">][</span><span class="s1">&#39;tick_passed&#39;</span><span class="p">]</span>
    <span class="n">ko_flag</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">close_flag</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">if</span> <span class="n">prop</span><span class="p">[</span><span class="s1">&#39;proposal_open_contract&#39;</span><span class="p">][</span><span class="s1">&#39;is_sold&#39;</span><span class="p">]:</span>
        <span class="k">if</span> <span class="n">prop</span><span class="p">[</span><span class="s1">&#39;proposal_open_contract&#39;</span><span class="p">][</span><span class="s1">&#39;profit&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">end_spots</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">prop</span><span class="p">[</span><span class="s1">&#39;proposal_open_contract&#39;</span><span class="p">][</span><span class="s1">&#39;audit_details&#39;</span><span class="p">][</span><span class="s1">&#39;all_ticks&#39;</span><span class="p">]:</span>
                <span class="k">if</span> <span class="s1">&#39;flag&#39;</span> <span class="ow">in</span> <span class="n">i</span> <span class="ow">and</span> <span class="s1">&#39;Exit&#39;</span> <span class="ow">in</span> <span class="n">i</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]:</span>
                    <span class="n">end_spots</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">[</span><span class="s1">&#39;tick&#39;</span><span class="p">])</span>
            <span class="n">ko_flag</span> <span class="o">=</span> <span class="mi">1</span> <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">end_spots</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">end_spots</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">&gt;</span> <span class="n">end_spots</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">barrier</span> <span class="k">else</span> <span class="mi">0</span>
        <span class="n">close_flag</span> <span class="o">=</span> <span class="s1">&#39;ko&#39;</span> <span class="k">if</span> <span class="n">ko_flag</span> <span class="k">else</span> <span class="s1">&#39;sold&#39;</span>
    <span class="k">else</span><span class="p">:</span> 
        <span class="n">close_flag</span> <span class="o">=</span> <span class="s1">&#39;bid&#39;</span>
    <span class="n">payout</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">stake</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">growth_rate</span><span class="p">)</span> <span class="o">**</span> <span class="n">ticks</span><span class="p">,</span> <span class="n">BO</span><span class="p">[</span><span class="s1">&#39;currency_precision&#39;</span><span class="p">][</span><span class="n">currency</span><span class="p">])</span>
    <span class="n">payout</span> <span class="o">=</span> <span class="mi">0</span> <span class="k">if</span> <span class="n">ko_flag</span> <span class="k">else</span> <span class="n">payout</span>
    <span class="n">match_flag</span> <span class="o">=</span> <span class="n">payout</span> <span class="o">==</span> <span class="n">prop</span><span class="p">[</span><span class="s1">&#39;proposal_open_contract&#39;</span><span class="p">][</span><span class="s1">&#39;bid_price&#39;</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">payout</span><span class="p">,</span> <span class="n">match_flag</span><span class="p">,</span> <span class="n">close_flag</span></div>


<div class="viewcode-block" id="Accumulator">
<a class="viewcode-back" href="../index.html#mvapi.Accumulator">[docs]</a>
<span class="k">class</span> <span class="nc">Accumulator</span><span class="p">(</span><span class="n">Product</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A class to represent an Accumulator product, inheriting from the Product class.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        species (str): The type of the product, &#39;Accumulator&#39;.</span>
<span class="sd">        contract_type (str): The type of contract, default is &#39;ACCU&#39;.</span>
<span class="sd">        growth_rate (float): The growth rate of the accumulator, default is 0.05.</span>

<span class="sd">    Methods:</span>
<span class="sd">        randomise_attributes(): Randomises the attributes of the Accumulator instance.</span>
<span class="sd">        _proposal(): Generates a proposal specific to the Accumulator product.</span>
<span class="sd">        check_barrier(runs=0, show=False): Checks barrier conditions for the given number of runs.</span>
<span class="sd">        check_payout(runs=0, show=False): Checks payout conditions for the given number of runs.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="n">species</span> <span class="o">=</span> <span class="s2">&quot;Accumulator&quot;</span>
    
<div class="viewcode-block" id="Accumulator.__init__">
<a class="viewcode-back" href="../index.html#mvapi.Accumulator.__init__">[docs]</a>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initializes an Accumulator instance.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        **kwargs : dict</span>
<span class="sd">            Keyword arguments to initialize the instance attributes. Includes &#39;growth_rate&#39;, which defaults to 0.05.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>
<span class="sd">        &quot;&quot;&quot;</span>        
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">contract_type</span> <span class="o">=</span> <span class="s1">&#39;ACCU&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">growth_rate</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;growth_rate&#39;</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">user_input_params</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;stake&#39;</span><span class="p">,</span><span class="s1">&#39;symbol&#39;</span><span class="p">,</span><span class="s1">&#39;growth_rate&#39;</span><span class="p">,</span><span class="s1">&#39;take_profit&#39;</span><span class="p">]</span></div>


<div class="viewcode-block" id="Accumulator.randomise_attributes">
<a class="viewcode-back" href="../index.html#mvapi.Accumulator.randomise_attributes">[docs]</a>
    <span class="k">def</span> <span class="nf">randomise_attributes</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Randomises the attributes of the Accumulator instance.</span>

<span class="sd">        Sets the symbol to a random choice from available symbols, </span>
<span class="sd">        the stake to a random value within the defined range, and</span>
<span class="sd">        the growth rate to a random value from a predefined list.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">symbol</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">symbols</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stake</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">BO</span><span class="p">[</span><span class="s1">&#39;accumulators&#39;</span><span class="p">][</span><span class="s1">&#39;max_stake&#39;</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">currency</span><span class="p">]),</span> <span class="n">BO</span><span class="p">[</span><span class="s1">&#39;currency_precision&#39;</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">currency</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">growth_rate</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">([</span><span class="mf">0.01</span><span class="p">,</span><span class="mf">0.02</span><span class="p">,</span><span class="mf">0.03</span><span class="p">,</span><span class="mf">0.04</span><span class="p">,</span><span class="mf">0.05</span><span class="p">])</span></div>


<div class="viewcode-block" id="Accumulator._proposal">
<a class="viewcode-back" href="../index.html#mvapi.Accumulator._proposal">[docs]</a>
    <span class="k">def</span> <span class="nf">_proposal</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Generates a proposal specific to the Accumulator product.</span>

<span class="sd">        Creates a proposal dictionary based on the current instance attributes.</span>
<span class="sd">        Includes &#39;take_profit&#39; and &#39;stop_loss&#39; if they are set. </span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        str</span>
<span class="sd">            The JSON-encoded proposal.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">proposal</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">proposal_type</span> <span class="o">==</span> <span class="s1">&#39;price_proposal&#39;</span><span class="p">:</span>
            <span class="n">proposal</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;proposal&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
                <span class="s2">&quot;amount&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">stake</span><span class="p">,</span>
                <span class="s2">&quot;basis&quot;</span><span class="p">:</span> <span class="s2">&quot;stake&quot;</span><span class="p">,</span>
                <span class="s2">&quot;contract_type&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">contract_type</span><span class="p">,</span>
                <span class="s2">&quot;currency&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">currency</span><span class="p">,</span>
                <span class="s2">&quot;symbol&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">symbol</span><span class="p">,</span>
                <span class="s1">&#39;growth_rate&#39;</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">growth_rate</span>
            <span class="p">}</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">take_profit</span><span class="p">:</span>
                <span class="n">insert_dict</span><span class="p">(</span><span class="n">proposal</span><span class="p">,</span> <span class="s1">&#39;limit_order&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;take_profit&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">take_profit</span><span class="p">})</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">stop_loss</span><span class="p">:</span>
                <span class="n">insert_dict</span><span class="p">(</span><span class="n">proposal</span><span class="p">,</span> <span class="s1">&#39;limit_order&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;stop_loss&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">stop_loss</span><span class="p">})</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">_proposal</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">proposal</span><span class="p">)</span></div>

    
<div class="viewcode-block" id="Accumulator.check_barrier">
<a class="viewcode-back" href="../index.html#mvapi.Accumulator.check_barrier">[docs]</a>
    <span class="k">def</span> <span class="nf">check_barrier</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">runs</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">show</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Checks barrier conditions for all saved proposals and the given number of runs.</span>

<span class="sd">        Randomises attributes and generates price proposals for the specified number of runs.</span>
<span class="sd">        Analyzes messages to check if barriers are accurate and displays the results.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        runs : int</span>
<span class="sd">            The number of times to run the check.</span>
<span class="sd">        show : bool</span>
<span class="sd">            If True, displays messages with failed barrier checks.</span>
<span class="sd">        **kwargs : dict</span>
<span class="sd">            Additional keyword arguments for setting attributes.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">runs</span><span class="p">):</span>
            <span class="n">clear_output</span><span class="p">(</span><span class="n">wait</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">randomise_attributes</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_set_attributes</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">price_proposal</span><span class="p">()</span>
        <span class="n">clear_output</span><span class="p">(</span><span class="n">wait</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stats</span><span class="p">[</span><span class="s1">&#39;barrier_check&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;cases&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;pass&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;fail&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">}</span>        
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">messages</span><span class="p">:</span>
            <span class="k">if</span> <span class="s1">&#39;msg_type&#39;</span> <span class="ow">in</span> <span class="n">item</span> <span class="ow">and</span> <span class="n">item</span><span class="p">[</span><span class="s1">&#39;msg_type&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;proposal&#39;</span> <span class="ow">and</span> <span class="s1">&#39;error&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">item</span> <span class="ow">and</span> <span class="s1">&#39;ACCU&#39;</span> <span class="ow">in</span> <span class="n">item</span><span class="p">[</span><span class="s1">&#39;echo_req&#39;</span><span class="p">][</span><span class="s1">&#39;contract_type&#39;</span><span class="p">]:</span>
                <span class="n">temp_dict</span> <span class="o">=</span> <span class="p">{}</span>
                <span class="n">temp_dict</span><span class="p">[</span><span class="s1">&#39;high_barrier&#39;</span><span class="p">],</span> <span class="n">temp_dict</span><span class="p">[</span><span class="s1">&#39;low_barrier&#39;</span><span class="p">],</span> <span class="n">temp_dict</span><span class="p">[</span><span class="s1">&#39;barrier_spot_distance&#39;</span><span class="p">],</span> <span class="n">temp_dict</span><span class="p">[</span><span class="s1">&#39;barrier_check&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">accu_barriers</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
                <span class="n">insert_dict</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="s1">&#39;mv&#39;</span><span class="p">,</span> <span class="n">temp_dict</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">stats</span><span class="p">[</span><span class="s1">&#39;barrier_check&#39;</span><span class="p">][</span><span class="s1">&#39;cases&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="k">if</span> <span class="n">item</span><span class="p">[</span><span class="s1">&#39;mv&#39;</span><span class="p">][</span><span class="s1">&#39;barrier_check&#39;</span><span class="p">]:</span> 
                    <span class="bp">self</span><span class="o">.</span><span class="n">stats</span><span class="p">[</span><span class="s1">&#39;barrier_check&#39;</span><span class="p">][</span><span class="s1">&#39;pass&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="k">else</span><span class="p">:</span> 
                    <span class="bp">self</span><span class="o">.</span><span class="n">stats</span><span class="p">[</span><span class="s1">&#39;barrier_check&#39;</span><span class="p">][</span><span class="s1">&#39;fail&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>                
                <span class="k">if</span> <span class="ow">not</span> <span class="n">item</span><span class="p">[</span><span class="s1">&#39;mv&#39;</span><span class="p">][</span><span class="s1">&#39;barrier_check&#39;</span><span class="p">]</span> <span class="ow">and</span> <span class="n">show</span><span class="p">:</span>
                    <span class="n">display</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stats_barrier</span> <span class="o">=</span> <span class="n">dict_to_df</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stats</span><span class="p">[</span><span class="s1">&#39;barrier_check&#39;</span><span class="p">],</span> <span class="s1">&#39;Payout&#39;</span><span class="p">)</span>   
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">stats_barrier</span></div>

        
<div class="viewcode-block" id="Accumulator.check_payout">
<a class="viewcode-back" href="../index.html#mvapi.Accumulator.check_payout">[docs]</a>
    <span class="k">def</span> <span class="nf">check_payout</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">runs</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">show</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Validates payout calculations for accumulator contracts over multiple runs.</span>

<span class="sd">        This method iterates through multiple payout checks by buying contracts, </span>
<span class="sd">        retrieving all open proposals, and comparing the actual payout with </span>
<span class="sd">        calculated values.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        runs : int, optional</span>
<span class="sd">            Number of iterations to perform payout checks. Defaults to 0.</span>
<span class="sd">        show : bool, optional</span>
<span class="sd">            Whether to display proposals with failed payout checks. Defaults to False.</span>
<span class="sd">        **kwargs : dict, optional</span>
<span class="sd">            Additional parameters for buying contracts (e.g., attributes to set).</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        pd.DataFrame</span>
<span class="sd">            A DataFrame summarizing the payout validation statistics.</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        - The method organizes the results into various outcome categories:</span>
<span class="sd">            - `total`: All cases processed.</span>
<span class="sd">            - `ko`: Knock-out contracts.</span>
<span class="sd">            - `sold`: Successfully sold contracts.</span>
<span class="sd">            - `bid`: Contracts still in bid state.</span>
<span class="sd">        - Failed payout checks are displayed if `show=True`.</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; obj = Accumulator()</span>
<span class="sd">        &gt;&gt;&gt; obj.check_payout(runs=10, show=True)</span>
<span class="sd">        Cases for Payout check:</span>
<span class="sd">        Category  cases  pass  fail</span>
<span class="sd">        0     total     10     9     1</span>
<span class="sd">        1        ko      2     2     0</span>
<span class="sd">        2      sold      6     5     1</span>
<span class="sd">        3       bid      2     2     0</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">runs</span><span class="p">):</span>
            <span class="n">clear_output</span><span class="p">(</span><span class="n">wait</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">buy_contract</span><span class="p">(</span><span class="n">random</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_all_poc</span><span class="p">()</span>
        <span class="n">clear_output</span><span class="p">(</span><span class="n">wait</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stats</span><span class="p">[</span><span class="s1">&#39;payout_check&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;total&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;cases&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;pass&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;fail&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">},</span>
            <span class="s1">&#39;ko&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;cases&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;pass&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;fail&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">},</span>
            <span class="s1">&#39;sold&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;cases&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;pass&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;fail&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">},</span>
            <span class="s1">&#39;bid&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;cases&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;pass&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;fail&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">}</span>
        <span class="p">}</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">messages</span><span class="p">:</span>
            <span class="k">if</span> <span class="s1">&#39;msg_type&#39;</span> <span class="ow">in</span> <span class="n">item</span> <span class="ow">and</span> <span class="n">item</span><span class="p">[</span><span class="s1">&#39;msg_type&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;proposal_open_contract&#39;</span> <span class="ow">and</span> <span class="s1">&#39;error&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">item</span> <span class="ow">and</span> <span class="s1">&#39;ACCU&#39;</span> <span class="ow">in</span> <span class="n">item</span><span class="p">[</span><span class="s1">&#39;proposal_open_contract&#39;</span><span class="p">][</span><span class="s1">&#39;contract_type&#39;</span><span class="p">]:</span>
                <span class="n">temp_dict</span> <span class="o">=</span> <span class="p">{}</span>
                <span class="n">temp_dict</span><span class="p">[</span><span class="s1">&#39;payout&#39;</span><span class="p">],</span> <span class="n">temp_dict</span><span class="p">[</span><span class="s1">&#39;payout_check&#39;</span><span class="p">],</span> <span class="n">temp_dict</span><span class="p">[</span><span class="s1">&#39;close_flag&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">accu_payout</span><span class="p">(</span><span class="n">item</span><span class="p">)</span> 
                <span class="n">insert_dict</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="s1">&#39;mv&#39;</span><span class="p">,</span> <span class="n">temp_dict</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">stats</span><span class="p">[</span><span class="s1">&#39;payout_check&#39;</span><span class="p">][</span><span class="n">temp_dict</span><span class="p">[</span><span class="s1">&#39;close_flag&#39;</span><span class="p">]][</span><span class="s1">&#39;cases&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">stats</span><span class="p">[</span><span class="s1">&#39;payout_check&#39;</span><span class="p">][</span><span class="s1">&#39;total&#39;</span><span class="p">][</span><span class="s1">&#39;cases&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="k">if</span> <span class="n">item</span><span class="p">[</span><span class="s1">&#39;mv&#39;</span><span class="p">][</span><span class="s1">&#39;payout_check&#39;</span><span class="p">]:</span> 
                    <span class="bp">self</span><span class="o">.</span><span class="n">stats</span><span class="p">[</span><span class="s1">&#39;payout_check&#39;</span><span class="p">][</span><span class="n">temp_dict</span><span class="p">[</span><span class="s1">&#39;close_flag&#39;</span><span class="p">]][</span><span class="s1">&#39;pass&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">stats</span><span class="p">[</span><span class="s1">&#39;payout_check&#39;</span><span class="p">][</span><span class="s1">&#39;total&#39;</span><span class="p">][</span><span class="s1">&#39;pass&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="k">else</span><span class="p">:</span> 
                    <span class="bp">self</span><span class="o">.</span><span class="n">stats</span><span class="p">[</span><span class="s1">&#39;payout_check&#39;</span><span class="p">][</span><span class="n">temp_dict</span><span class="p">[</span><span class="s1">&#39;close_flag&#39;</span><span class="p">]][</span><span class="s1">&#39;fail&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>  
                    <span class="bp">self</span><span class="o">.</span><span class="n">stats</span><span class="p">[</span><span class="s1">&#39;payout_check&#39;</span><span class="p">][</span><span class="s1">&#39;total&#39;</span><span class="p">][</span><span class="s1">&#39;fail&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">item</span><span class="p">[</span><span class="s1">&#39;mv&#39;</span><span class="p">][</span><span class="s1">&#39;payout_check&#39;</span><span class="p">]</span> <span class="ow">and</span> <span class="n">show</span><span class="p">:</span>
                    <span class="n">display</span><span class="p">(</span><span class="n">item</span><span class="p">)</span> 
        <span class="bp">self</span><span class="o">.</span><span class="n">stats_payout</span> <span class="o">=</span> <span class="n">dict_to_df</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stats</span><span class="p">[</span><span class="s1">&#39;payout_check&#39;</span><span class="p">],</span> <span class="s1">&#39;Payout&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">stats_payout</span></div>
</div>


<div class="viewcode-block" id="vanilla_barriers">
<a class="viewcode-back" href="../index.html#mvapi.vanilla_barriers">[docs]</a>
<span class="k">def</span> <span class="nf">vanilla_barriers</span><span class="p">(</span><span class="n">prop</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculate expected barrier choices for vanillas based on given JSON.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    prop : dict</span>
<span class="sd">        The JSON proposal containing necessary data for calculations.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    list</span>
<span class="sd">        A list of expected barrier choices.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">spot</span> <span class="o">=</span> <span class="n">prop</span><span class="p">[</span><span class="s1">&#39;proposal&#39;</span><span class="p">][</span><span class="s1">&#39;spot&#39;</span><span class="p">]</span>
    <span class="n">symbol</span> <span class="o">=</span> <span class="n">prop</span><span class="p">[</span><span class="s1">&#39;echo_req&#39;</span><span class="p">][</span><span class="s1">&#39;symbol&#39;</span><span class="p">]</span>
    <span class="n">duration</span> <span class="o">=</span> <span class="p">[</span><span class="n">prop</span><span class="p">[</span><span class="s1">&#39;proposal&#39;</span><span class="p">][</span><span class="s1">&#39;date_start&#39;</span><span class="p">],</span> <span class="n">prop</span><span class="p">[</span><span class="s1">&#39;proposal&#39;</span><span class="p">][</span><span class="s1">&#39;date_expiry&#39;</span><span class="p">]]</span>
    <span class="n">duration_unit</span> <span class="o">=</span> <span class="n">prop</span><span class="p">[</span><span class="s1">&#39;echo_req&#39;</span><span class="p">][</span><span class="s1">&#39;duration_unit&#39;</span><span class="p">]</span>
    <span class="n">digits</span> <span class="o">=</span> <span class="n">symbols</span><span class="p">[</span><span class="n">symbol</span><span class="p">][</span><span class="s1">&#39;digits&#39;</span><span class="p">]</span>
    <span class="n">sigma</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;(\d+)[^\d]*$&#39;</span><span class="p">,</span> <span class="n">symbol</span><span class="p">)</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span><span class="o">/</span><span class="mi">100</span>
    <span class="n">n_digits</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">spot</span> <span class="o">*</span> <span class="n">sigma</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">60</span> <span class="o">/</span> <span class="mi">365</span> <span class="o">/</span> <span class="mi">86400</span><span class="p">)),</span> <span class="mi">0</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
    <span class="n">spot</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">spot</span> <span class="o">/</span> <span class="mi">10</span> <span class="o">**</span> <span class="o">-</span><span class="n">n_digits</span><span class="p">)</span> <span class="o">*</span> <span class="mi">10</span> <span class="o">**</span> <span class="o">-</span><span class="n">n_digits</span>
    <span class="n">t</span> <span class="o">=</span> <span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">duration</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">-</span> <span class="nb">int</span><span class="p">(</span><span class="n">duration</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span> <span class="o">/</span> <span class="mi">365</span> <span class="o">/</span> <span class="mi">86400</span>    
    <span class="k">if</span> <span class="n">t</span> <span class="o">&lt;</span> <span class="mi">5</span> <span class="o">*</span> <span class="mi">60</span> <span class="o">/</span> <span class="mi">365</span> <span class="o">/</span> <span class="mi">86400</span> <span class="ow">and</span> <span class="s1">&#39;R&#39;</span> <span class="ow">in</span> <span class="n">symbol</span><span class="p">:</span>
        <span class="n">t</span> <span class="o">-=</span> <span class="mi">2</span> <span class="o">/</span> <span class="mi">365</span> <span class="o">/</span> <span class="mi">86400</span>        
    <span class="k">if</span> <span class="n">duration_unit</span> <span class="o">!=</span> <span class="s1">&#39;d&#39;</span><span class="p">:</span>
        <span class="n">deltas</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">BO</span><span class="p">[</span><span class="s1">&#39;vanillas&#39;</span><span class="p">][</span><span class="s1">&#39;delta_config&#39;</span><span class="p">])</span>
        <span class="n">real_strikes</span> <span class="o">=</span> <span class="n">spot</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">((</span><span class="n">sigma</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">t</span> <span class="o">-</span> <span class="p">(</span><span class="n">sigma</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">t</span><span class="p">)</span> <span class="o">*</span> <span class="n">norm</span><span class="o">.</span><span class="n">ppf</span><span class="p">(</span><span class="n">deltas</span><span class="p">)))</span>
        <span class="n">displayed_barriers</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">((</span><span class="n">real_strikes</span> <span class="o">-</span> <span class="n">spot</span><span class="p">)</span> <span class="o">*</span> <span class="mi">10</span> <span class="o">**</span> <span class="n">digits</span><span class="p">)</span> <span class="o">/</span> <span class="mi">10</span> <span class="o">**</span> <span class="n">digits</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">temp_barriers</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">displayed_barriers</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">central_strike</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">spot</span> <span class="o">/</span> <span class="p">(</span><span class="mi">10</span> <span class="o">**</span> <span class="o">-</span><span class="n">n_digits</span><span class="p">))</span> <span class="o">*</span> <span class="p">(</span><span class="mi">10</span> <span class="o">**</span> <span class="o">-</span><span class="n">n_digits</span><span class="p">)</span>
        <span class="n">max_strike</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">((</span><span class="n">spot</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">((</span><span class="n">sigma</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">t</span> <span class="o">-</span> <span class="p">(</span><span class="n">sigma</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">t</span><span class="p">)</span> <span class="o">*</span> <span class="n">norm</span><span class="o">.</span><span class="n">ppf</span><span class="p">(</span><span class="mf">0.1</span><span class="p">))))</span> <span class="o">/</span> <span class="p">(</span><span class="mi">10</span> <span class="o">**</span> <span class="o">-</span><span class="n">n_digits</span><span class="p">))</span> <span class="o">*</span> <span class="p">(</span><span class="mi">10</span> <span class="o">**</span> <span class="o">-</span><span class="n">n_digits</span><span class="p">)</span>
        <span class="n">min_strike</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">((</span><span class="n">spot</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">((</span><span class="n">sigma</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">t</span> <span class="o">-</span> <span class="p">(</span><span class="n">sigma</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">t</span><span class="p">)</span> <span class="o">*</span> <span class="n">norm</span><span class="o">.</span><span class="n">ppf</span><span class="p">(</span><span class="mf">0.9</span><span class="p">))))</span> <span class="o">/</span> <span class="p">(</span><span class="mi">10</span> <span class="o">**</span> <span class="o">-</span><span class="n">n_digits</span><span class="p">))</span> <span class="o">*</span> <span class="p">(</span><span class="mi">10</span> <span class="o">**</span> <span class="o">-</span><span class="n">n_digits</span><span class="p">)</span>
        <span class="n">strike_step_1</span> <span class="o">=</span> <span class="nb">round</span><span class="p">((</span><span class="n">central_strike</span> <span class="o">-</span> <span class="n">min_strike</span><span class="p">)</span> <span class="o">/</span> <span class="mi">5</span> <span class="o">/</span> <span class="mi">10</span><span class="p">)</span> <span class="o">*</span> <span class="mi">10</span>
        <span class="n">strike_step_2</span> <span class="o">=</span> <span class="nb">round</span><span class="p">((</span><span class="n">max_strike</span> <span class="o">-</span> <span class="n">central_strike</span><span class="p">)</span> <span class="o">/</span> <span class="mi">5</span> <span class="o">/</span> <span class="mi">10</span><span class="p">)</span> <span class="o">*</span> <span class="mi">10</span>         
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">):</span>
            <span class="n">temp_barriers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">min_strike</span> <span class="o">+</span> <span class="n">strike_step_1</span> <span class="o">*</span> <span class="n">i</span><span class="p">)</span>            
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">):</span>
            <span class="n">temp_barriers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">central_strike</span> <span class="o">+</span> <span class="n">strike_step_2</span> <span class="o">*</span> <span class="n">i</span><span class="p">)</span>            
        <span class="n">temp_barriers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">max_strike</span><span class="p">)</span>        
        <span class="k">for</span> <span class="n">strike</span> <span class="ow">in</span> <span class="n">temp_barriers</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">strike</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">displayed_barriers</span><span class="p">:</span>
                <span class="n">displayed_barriers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">strike</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">displayed_barriers</span></div>


<div class="viewcode-block" id="vanilla_ppp_ask">
<a class="viewcode-back" href="../index.html#mvapi.vanilla_ppp_ask">[docs]</a>
<span class="k">def</span> <span class="nf">vanilla_ppp_ask</span><span class="p">(</span><span class="n">prop</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculates the payout per point (PPP) ask price for a vanilla contract.</span>

<span class="sd">    This function computes the expected PPP ask price for a vanilla contract based on the </span>
<span class="sd">    Black-Scholes pricing model with adjustments for volatility charges, critical financial </span>
<span class="sd">    variables, and the contract&#39;s type (call or put). It also validates the computed PPP </span>
<span class="sd">    against the value provided in the proposal.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    prop : dict</span>
<span class="sd">        The contract proposal data, which contains information about contract details.</span>
<span class="sd">        It can be in either of the following formats:</span>
<span class="sd">        - If `prop[&#39;msg_type&#39;] == &#39;proposal_open_contract&#39;`, the open contract details.</span>
<span class="sd">        - Otherwise, the initial contract proposal.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    tuple</span>
<span class="sd">        A tuple containing:</span>
<span class="sd">        - ppp (float): The calculated payout per point ask price.</span>
<span class="sd">        - match_flag (bool): Whether the calculated price matches the provided API price.</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    - The method uses the Black-Scholes pricing model with adjustments for volatility </span>
<span class="sd">      charges, spot spread, and markup values.</span>
<span class="sd">    - It handles both long call and long put vanilla contracts.</span>
<span class="sd">    - If the contract duration is short and involves synthetic indices (&#39;R&#39;), the </span>
<span class="sd">      duration is reduced slightly to account for specific model adjustments.</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; prop = {</span>
<span class="sd">    ...     &#39;msg_type&#39;: &#39;proposal&#39;,</span>
<span class="sd">    ...     &#39;proposal&#39;: {</span>
<span class="sd">    ...         &#39;spot&#39;: 100,</span>
<span class="sd">    ...         &#39;contract_details&#39;: {&#39;barrier&#39;: &quot;105&quot;},</span>
<span class="sd">    ...         &#39;display_number_of_contracts&#39;: &quot;5&quot;,</span>
<span class="sd">    ...         &#39;date_start&#39;: 1650000000,</span>
<span class="sd">    ...         &#39;date_expiry&#39;: 1650003600</span>
<span class="sd">    ...     },</span>
<span class="sd">    ...     &#39;echo_req&#39;: {</span>
<span class="sd">    ...         &#39;symbol&#39;: &#39;R_100&#39;,</span>
<span class="sd">    ...         &#39;contract_type&#39;: &#39;VANILLALONGCALL&#39;</span>
<span class="sd">    ...     }</span>
<span class="sd">    ... }</span>
<span class="sd">    &gt;&gt;&gt; ppp, match_flag = vanilla_ppp_ask(prop)</span>
<span class="sd">    &gt;&gt;&gt; print(ppp, match_flag)</span>
<span class="sd">    1.234, True</span>
<span class="sd">    &quot;&quot;&quot;</span>    
    <span class="k">if</span> <span class="n">prop</span><span class="p">[</span><span class="s1">&#39;msg_type&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;proposal_open_contract&#39;</span><span class="p">:</span>
        <span class="n">spot</span> <span class="o">=</span> <span class="n">prop</span><span class="p">[</span><span class="s1">&#39;proposal_open_contract&#39;</span><span class="p">][</span><span class="s1">&#39;entry_spot&#39;</span><span class="p">]</span>
        <span class="n">strike</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">prop</span><span class="p">[</span><span class="s1">&#39;proposal_open_contract&#39;</span><span class="p">][</span><span class="s1">&#39;barrier&#39;</span><span class="p">])</span>      
        <span class="n">number_of_contracts</span> <span class="o">=</span> <span class="n">prop</span><span class="p">[</span><span class="s1">&#39;proposal_open_contract&#39;</span><span class="p">][</span><span class="s1">&#39;display_number_of_contracts&#39;</span><span class="p">]</span>
        <span class="n">api_ppp</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">prop</span><span class="p">[</span><span class="s1">&#39;proposal_open_contract&#39;</span><span class="p">][</span><span class="s1">&#39;display_number_of_contracts&#39;</span><span class="p">])</span>
        <span class="n">symbol</span> <span class="o">=</span> <span class="n">prop</span><span class="p">[</span><span class="s1">&#39;proposal_open_contract&#39;</span><span class="p">][</span><span class="s1">&#39;underlying&#39;</span><span class="p">]</span>
        <span class="n">r</span> <span class="o">=</span> <span class="mi">0</span> <span class="k">if</span> <span class="s1">&#39;pricing_args&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">prop</span><span class="p">[</span><span class="s1">&#39;proposal_open_contract&#39;</span><span class="p">]</span> <span class="k">else</span> <span class="n">prop</span><span class="p">[</span><span class="s1">&#39;proposal_open_contract&#39;</span><span class="p">][</span><span class="s1">&#39;pricing_args&#39;</span><span class="p">][</span><span class="s1">&#39;discount_rate&#39;</span><span class="p">]</span>
        <span class="n">contract_type</span> <span class="o">=</span> <span class="n">prop</span><span class="p">[</span><span class="s1">&#39;proposal_open_contract&#39;</span><span class="p">][</span><span class="s1">&#39;contract_type&#39;</span><span class="p">]</span>
        <span class="n">duration</span> <span class="o">=</span> <span class="p">[</span><span class="n">prop</span><span class="p">[</span><span class="s1">&#39;proposal_open_contract&#39;</span><span class="p">][</span><span class="s1">&#39;date_start&#39;</span><span class="p">],</span> <span class="n">prop</span><span class="p">[</span><span class="s1">&#39;proposal_open_contract&#39;</span><span class="p">][</span><span class="s1">&#39;date_expiry&#39;</span><span class="p">]]</span>
        <span class="n">stake</span> <span class="o">=</span> <span class="n">get_stake</span><span class="p">(</span><span class="n">prop</span><span class="p">)</span>
        <span class="n">currency</span> <span class="o">=</span> <span class="n">prop</span><span class="p">[</span><span class="s1">&#39;proposal_open_contract&#39;</span><span class="p">][</span><span class="s1">&#39;currency&#39;</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">spot</span> <span class="o">=</span> <span class="n">prop</span><span class="p">[</span><span class="s1">&#39;proposal&#39;</span><span class="p">][</span><span class="s1">&#39;spot&#39;</span><span class="p">]</span>
        <span class="n">strike</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">prop</span><span class="p">[</span><span class="s1">&#39;proposal&#39;</span><span class="p">][</span><span class="s1">&#39;contract_details&#39;</span><span class="p">][</span><span class="s1">&#39;barrier&#39;</span><span class="p">])</span>      
        <span class="n">number_of_contracts</span> <span class="o">=</span> <span class="n">prop</span><span class="p">[</span><span class="s1">&#39;proposal&#39;</span><span class="p">][</span><span class="s1">&#39;display_number_of_contracts&#39;</span><span class="p">]</span>
        <span class="n">api_ppp</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">prop</span><span class="p">[</span><span class="s1">&#39;proposal&#39;</span><span class="p">][</span><span class="s1">&#39;display_number_of_contracts&#39;</span><span class="p">])</span>
        <span class="n">symbol</span> <span class="o">=</span> <span class="n">prop</span><span class="p">[</span><span class="s1">&#39;echo_req&#39;</span><span class="p">][</span><span class="s1">&#39;symbol&#39;</span><span class="p">]</span>    
        <span class="n">r</span> <span class="o">=</span> <span class="mi">0</span> <span class="k">if</span> <span class="s1">&#39;pricing_args&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">prop</span><span class="p">[</span><span class="s1">&#39;proposal&#39;</span><span class="p">]</span> <span class="k">else</span> <span class="n">prop</span><span class="p">[</span><span class="s1">&#39;proposal&#39;</span><span class="p">][</span><span class="s1">&#39;pricing_args&#39;</span><span class="p">][</span><span class="s1">&#39;discount_rate&#39;</span><span class="p">]</span>
        <span class="n">contract_type</span> <span class="o">=</span> <span class="n">prop</span><span class="p">[</span><span class="s1">&#39;echo_req&#39;</span><span class="p">][</span><span class="s1">&#39;contract_type&#39;</span><span class="p">]</span>
        <span class="n">duration</span> <span class="o">=</span> <span class="p">[</span><span class="n">prop</span><span class="p">[</span><span class="s1">&#39;proposal&#39;</span><span class="p">][</span><span class="s1">&#39;date_start&#39;</span><span class="p">],</span> <span class="n">prop</span><span class="p">[</span><span class="s1">&#39;proposal&#39;</span><span class="p">][</span><span class="s1">&#39;date_expiry&#39;</span><span class="p">]]</span>
        <span class="n">stake</span> <span class="o">=</span> <span class="n">get_stake</span><span class="p">(</span><span class="n">prop</span><span class="p">)</span>
        <span class="n">currency</span> <span class="o">=</span> <span class="n">prop</span><span class="p">[</span><span class="s1">&#39;echo_req&#39;</span><span class="p">][</span><span class="s1">&#39;currency&#39;</span><span class="p">]</span>
    <span class="n">t</span> <span class="o">=</span> <span class="p">(</span> <span class="nb">int</span><span class="p">(</span><span class="n">duration</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">-</span> <span class="nb">int</span><span class="p">(</span><span class="n">duration</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="p">)</span> <span class="o">/</span> <span class="mi">365</span> <span class="o">/</span> <span class="mi">86400</span>  
    <span class="k">if</span> <span class="n">t</span> <span class="o">&lt;</span> <span class="mi">5</span> <span class="o">*</span> <span class="mi">60</span> <span class="o">/</span> <span class="mi">365</span> <span class="o">/</span> <span class="mi">86400</span> <span class="ow">and</span> <span class="s1">&#39;R&#39;</span> <span class="ow">in</span> <span class="n">symbol</span><span class="p">:</span>
        <span class="n">t</span> <span class="o">-=</span> <span class="mi">2</span> <span class="o">/</span> <span class="mi">365</span> <span class="o">/</span> <span class="mi">86400</span>
    <span class="n">vol_charge</span> <span class="o">=</span> <span class="n">BO</span><span class="p">[</span><span class="s1">&#39;vanillas&#39;</span><span class="p">][</span><span class="s1">&#39;vol_markup&#39;</span><span class="p">][</span><span class="s1">&#39;daily&#39;</span><span class="p">][</span><span class="n">symbol</span><span class="p">]</span> <span class="k">if</span> <span class="n">t</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="o">/</span><span class="mi">365</span> <span class="k">else</span> <span class="n">BO</span><span class="p">[</span><span class="s1">&#39;vanillas&#39;</span><span class="p">][</span><span class="s1">&#39;vol_markup&#39;</span><span class="p">][</span><span class="s1">&#39;intra&#39;</span><span class="p">][</span><span class="n">symbol</span><span class="p">]</span>
    <span class="n">vol_charge</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">+</span> <span class="n">vol_charge</span>
    <span class="n">sigma</span> <span class="o">=</span> <span class="n">get_sigma</span><span class="p">(</span><span class="n">symbol</span><span class="p">)</span>
    <span class="n">spot_spread</span> <span class="o">=</span> <span class="n">BO</span><span class="p">[</span><span class="s1">&#39;vanillas&#39;</span><span class="p">][</span><span class="s1">&#39;spread_spot&#39;</span><span class="p">][</span><span class="n">symbol</span><span class="p">]</span>
    <span class="n">bs_markup</span> <span class="o">=</span> <span class="n">BO</span><span class="p">[</span><span class="s1">&#39;vanillas&#39;</span><span class="p">][</span><span class="s1">&#39;bs_markup&#39;</span><span class="p">]</span>        
    <span class="n">vol</span> <span class="o">=</span> <span class="n">sigma</span> <span class="o">*</span> <span class="n">vol_charge</span>
    <span class="n">d1</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">spot</span><span class="o">/</span><span class="n">strike</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">vol</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="n">t</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">vol</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">t</span><span class="p">))</span>
    <span class="n">d2</span> <span class="o">=</span> <span class="p">(</span><span class="n">d1</span> <span class="o">-</span> <span class="n">vol</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">t</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">contract_type</span> <span class="o">==</span> <span class="s2">&quot;VANILLALONGCALL&quot;</span><span class="p">:</span>
        <span class="n">phi</span> <span class="o">=</span> <span class="mi">1</span>        
        <span class="n">delta_charge</span> <span class="o">=</span>  <span class="p">(</span><span class="n">norm</span><span class="o">.</span><span class="n">cdf</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">spot</span><span class="o">/</span><span class="n">strike</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">sigma</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="n">t</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">sigma</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">t</span><span class="p">))))</span> <span class="o">*</span> <span class="n">spot_spread</span> <span class="o">/</span> <span class="mi">2</span>        
    <span class="k">elif</span>  <span class="n">contract_type</span> <span class="o">==</span> <span class="s2">&quot;VANILLALONGPUT&quot;</span><span class="p">:</span>        
        <span class="n">phi</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>        
        <span class="n">delta_charge</span> <span class="o">=</span>  <span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">norm</span><span class="o">.</span><span class="n">cdf</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">spot</span><span class="o">/</span><span class="n">strike</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">sigma</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="n">t</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">sigma</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">t</span><span class="p">)))</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span> <span class="o">*</span> <span class="n">spot_spread</span> <span class="o">/</span> <span class="mi">2</span>      
    <span class="n">bs_price</span> <span class="o">=</span> <span class="p">(</span><span class="n">phi</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">r</span><span class="o">*</span><span class="n">t</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">spot</span><span class="o">*</span><span class="n">norm</span><span class="o">.</span><span class="n">cdf</span><span class="p">(</span><span class="n">phi</span><span class="o">*</span><span class="n">d1</span><span class="p">)</span> <span class="o">-</span> <span class="n">strike</span><span class="o">*</span><span class="n">norm</span><span class="o">.</span><span class="n">cdf</span><span class="p">(</span><span class="n">phi</span><span class="o">*</span><span class="n">d2</span><span class="p">)))</span>    
    <span class="n">ppp</span> <span class="o">=</span> <span class="n">rounddown</span><span class="p">(</span><span class="n">stake</span> <span class="o">/</span> <span class="p">(</span> <span class="n">bs_price</span> <span class="o">+</span> <span class="n">delta_charge</span> <span class="o">+</span> <span class="n">bs_markup</span> <span class="p">),</span> <span class="n">BO</span><span class="p">[</span><span class="s1">&#39;currency_precision&#39;</span><span class="p">][</span><span class="n">currency</span><span class="p">]</span><span class="o">+</span><span class="mi">4</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">ppp</span><span class="p">,</span> <span class="p">(</span><span class="n">ppp</span> <span class="o">==</span> <span class="n">api_ppp</span><span class="p">)</span> </div>


<div class="viewcode-block" id="vanilla_payout">
<a class="viewcode-back" href="../index.html#mvapi.vanilla_payout">[docs]</a>
<span class="k">def</span> <span class="nf">vanilla_payout</span><span class="p">(</span><span class="n">prop</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculate payout for a vanilla contract and determine if it matches the expected value.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    prop : dict</span>
<span class="sd">        The JSON proposal containing necessary data for calculations.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    tuple</span>
<span class="sd">        A tuple containing the calculated payout, a match flag indicating if the calculated</span>
<span class="sd">        payout matches the proposal value, and a close flag indicating the status of the contract.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">symbol</span> <span class="o">=</span> <span class="n">prop</span><span class="p">[</span><span class="s1">&#39;proposal_open_contract&#39;</span><span class="p">][</span><span class="s1">&#39;underlying&#39;</span><span class="p">]</span>
    <span class="n">ctype</span> <span class="o">=</span> <span class="n">prop</span><span class="p">[</span><span class="s1">&#39;proposal_open_contract&#39;</span><span class="p">][</span><span class="s1">&#39;contract_type&#39;</span><span class="p">]</span>
    <span class="n">phi</span> <span class="o">=</span> <span class="mi">1</span> <span class="k">if</span> <span class="n">ctype</span> <span class="o">==</span> <span class="s2">&quot;VANILLALONGCALL&quot;</span> <span class="k">else</span> <span class="o">-</span><span class="mi">1</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">spot</span> <span class="o">=</span> <span class="n">prop</span><span class="p">[</span><span class="s1">&#39;proposal_open_contract&#39;</span><span class="p">][</span><span class="s1">&#39;exit_tick&#39;</span><span class="p">]</span> 
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">spot</span> <span class="o">=</span> <span class="n">prop</span><span class="p">[</span><span class="s1">&#39;proposal_open_contract&#39;</span><span class="p">][</span><span class="s1">&#39;current_spot&#39;</span><span class="p">]</span>
    <span class="n">strike</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">prop</span><span class="p">[</span><span class="s1">&#39;proposal_open_contract&#39;</span><span class="p">][</span><span class="s1">&#39;barrier&#39;</span><span class="p">])</span>
    <span class="n">ppp</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">prop</span><span class="p">[</span><span class="s1">&#39;proposal_open_contract&#39;</span><span class="p">][</span><span class="s1">&#39;display_number_of_contracts&#39;</span><span class="p">])</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">tick_now</span> <span class="o">=</span> <span class="n">prop</span><span class="p">[</span><span class="s1">&#39;proposal_open_contract&#39;</span><span class="p">][</span><span class="s1">&#39;exit_tick_time&#39;</span><span class="p">]</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>                
        <span class="n">tick_now</span> <span class="o">=</span> <span class="n">prop</span><span class="p">[</span><span class="s1">&#39;proposal_open_contract&#39;</span><span class="p">][</span><span class="s1">&#39;current_spot_time&#39;</span><span class="p">]</span>
    <span class="n">R_expire_flag</span> <span class="o">=</span> <span class="kc">True</span> <span class="k">if</span> <span class="s1">&#39;R&#39;</span> <span class="ow">in</span> <span class="n">symbol</span> <span class="ow">and</span> <span class="n">prop</span><span class="p">[</span><span class="s1">&#39;proposal_open_contract&#39;</span><span class="p">][</span><span class="s1">&#39;expiry_time&#39;</span><span class="p">]</span><span class="o">%</span><span class="mi">2</span> <span class="ow">and</span> <span class="n">prop</span><span class="p">[</span><span class="s1">&#39;proposal_open_contract&#39;</span><span class="p">][</span><span class="s1">&#39;expiry_time&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">tick_now</span> <span class="o">==</span> <span class="mi">1</span> <span class="k">else</span> <span class="kc">False</span>
    <span class="k">if</span> <span class="n">tick_now</span> <span class="o">&gt;=</span> <span class="n">prop</span><span class="p">[</span><span class="s1">&#39;proposal_open_contract&#39;</span><span class="p">][</span><span class="s1">&#39;expiry_time&#39;</span><span class="p">]</span> <span class="ow">or</span> <span class="n">R_expire_flag</span><span class="p">:</span>
        <span class="n">payout</span><span class="p">,</span> <span class="n">close_flag</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="nb">max</span><span class="p">((</span><span class="n">phi</span> <span class="o">*</span> <span class="n">ppp</span> <span class="o">*</span> <span class="p">(</span><span class="n">spot</span> <span class="o">-</span> <span class="n">strike</span><span class="p">)),</span> <span class="mi">0</span><span class="p">),</span> <span class="n">BO</span><span class="p">[</span><span class="s1">&#39;currency_precision&#39;</span><span class="p">][</span><span class="n">prop</span><span class="p">[</span><span class="s1">&#39;proposal_open_contract&#39;</span><span class="p">][</span><span class="s1">&#39;currency&#39;</span><span class="p">]]),</span> <span class="s1">&#39;expired&#39;</span>
        <span class="n">match_flag</span> <span class="o">=</span> <span class="n">payout</span> <span class="o">==</span> <span class="n">prop</span><span class="p">[</span><span class="s1">&#39;proposal_open_contract&#39;</span><span class="p">][</span><span class="s1">&#39;sell_price&#39;</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">t</span> <span class="o">=</span> <span class="p">(</span><span class="n">prop</span><span class="p">[</span><span class="s1">&#39;proposal_open_contract&#39;</span><span class="p">][</span><span class="s1">&#39;date_expiry&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">tick_now</span><span class="p">)</span> <span class="o">/</span> <span class="mi">365</span> <span class="o">/</span> <span class="mi">86400</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>                
            <span class="n">t</span> <span class="o">=</span> <span class="p">(</span><span class="n">prop</span><span class="p">[</span><span class="s1">&#39;proposal_open_contract&#39;</span><span class="p">][</span><span class="s1">&#39;date_expiry&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">tick_now</span><span class="p">)</span> <span class="o">/</span> <span class="mi">365</span> <span class="o">/</span> <span class="mi">86400</span>
        <span class="k">if</span> <span class="n">t</span> <span class="o">&lt;</span> <span class="mi">5</span> <span class="o">*</span> <span class="mi">60</span> <span class="o">/</span> <span class="mi">365</span> <span class="o">/</span> <span class="mi">86400</span> <span class="ow">and</span> <span class="s1">&#39;R&#39;</span> <span class="ow">in</span> <span class="n">symbol</span><span class="p">:</span>
            <span class="n">t</span> <span class="o">-=</span> <span class="mi">2</span> <span class="o">/</span> <span class="mi">365</span> <span class="o">/</span> <span class="mi">86400</span>   
        <span class="n">r</span> <span class="o">=</span> <span class="mi">0</span> <span class="k">if</span> <span class="s1">&#39;pricing_args&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">prop</span><span class="p">[</span><span class="s1">&#39;proposal_open_contract&#39;</span><span class="p">]</span> <span class="k">else</span> <span class="n">prop</span><span class="p">[</span><span class="s1">&#39;proposal_open_contract&#39;</span><span class="p">][</span><span class="s1">&#39;pricing_args&#39;</span><span class="p">][</span><span class="s1">&#39;discount_rate&#39;</span><span class="p">]</span>
        <span class="n">sigma</span> <span class="o">=</span> <span class="n">get_sigma</span><span class="p">(</span><span class="n">symbol</span><span class="p">)</span>
        <span class="n">vol</span> <span class="o">=</span> <span class="n">sigma</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="p">(</span><span class="n">BO</span><span class="p">[</span><span class="s1">&#39;vanillas&#39;</span><span class="p">][</span><span class="s1">&#39;vol_markup&#39;</span><span class="p">][</span><span class="s1">&#39;daily&#39;</span><span class="p">][</span><span class="n">symbol</span><span class="p">]</span> <span class="k">if</span> <span class="n">t</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="o">/</span><span class="mi">365</span> <span class="k">else</span> <span class="n">BO</span><span class="p">[</span><span class="s1">&#39;vanillas&#39;</span><span class="p">][</span><span class="s1">&#39;vol_markup&#39;</span><span class="p">][</span><span class="s1">&#39;intra&#39;</span><span class="p">][</span><span class="n">symbol</span><span class="p">]))</span>
        <span class="n">spot_spread</span> <span class="o">=</span> <span class="n">BO</span><span class="p">[</span><span class="s1">&#39;vanillas&#39;</span><span class="p">][</span><span class="s1">&#39;spread_spot&#39;</span><span class="p">][</span><span class="n">symbol</span><span class="p">]</span>
        <span class="n">bs_markup</span> <span class="o">=</span> <span class="n">BO</span><span class="p">[</span><span class="s1">&#39;vanillas&#39;</span><span class="p">][</span><span class="s1">&#39;bs_markup&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">phi</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">delta_charge</span> <span class="o">=</span> <span class="p">(</span><span class="n">norm</span><span class="o">.</span><span class="n">cdf</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">spot</span><span class="o">/</span><span class="n">strike</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">sigma</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="n">t</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">sigma</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">t</span><span class="p">))))</span> <span class="o">*</span> <span class="n">spot_spread</span> <span class="o">/</span> <span class="mi">2</span>        
        <span class="k">else</span><span class="p">:</span>
            <span class="n">delta_charge</span> <span class="o">=</span> <span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">norm</span><span class="o">.</span><span class="n">cdf</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">spot</span><span class="o">/</span><span class="n">strike</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">sigma</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="n">t</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">sigma</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">t</span><span class="p">)))</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span> <span class="o">*</span> <span class="n">spot_spread</span> <span class="o">/</span> <span class="mi">2</span>   
        <span class="n">d1</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">spot</span><span class="o">/</span><span class="n">strike</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">vol</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="n">t</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">vol</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">t</span><span class="p">))</span>
        <span class="n">d2</span> <span class="o">=</span> <span class="p">(</span><span class="n">d1</span> <span class="o">-</span> <span class="n">vol</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">t</span><span class="p">))</span>    
        <span class="n">payout</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="nb">max</span><span class="p">(((</span><span class="n">phi</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">r</span><span class="o">*</span><span class="n">t</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">spot</span><span class="o">*</span><span class="n">norm</span><span class="o">.</span><span class="n">cdf</span><span class="p">(</span><span class="n">phi</span><span class="o">*</span><span class="n">d1</span><span class="p">)</span> <span class="o">-</span> <span class="n">strike</span><span class="o">*</span><span class="n">norm</span><span class="o">.</span><span class="n">cdf</span><span class="p">(</span><span class="n">phi</span><span class="o">*</span><span class="n">d2</span><span class="p">)))</span> <span class="o">-</span> <span class="n">delta_charge</span> <span class="o">-</span> <span class="n">bs_markup</span><span class="p">)</span> <span class="o">*</span> <span class="n">ppp</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">BO</span><span class="p">[</span><span class="s1">&#39;currency_precision&#39;</span><span class="p">][</span><span class="n">prop</span><span class="p">[</span><span class="s1">&#39;proposal_open_contract&#39;</span><span class="p">][</span><span class="s1">&#39;currency&#39;</span><span class="p">]])</span>
        <span class="n">match_flag</span> <span class="o">=</span> <span class="p">(</span><span class="n">payout</span> <span class="o">==</span> <span class="n">prop</span><span class="p">[</span><span class="s1">&#39;proposal_open_contract&#39;</span><span class="p">][</span><span class="s1">&#39;bid_price&#39;</span><span class="p">])</span> <span class="k">if</span> <span class="n">t</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="o">/</span><span class="mi">365</span> <span class="k">else</span> <span class="kc">True</span>
        <span class="n">close_flag</span> <span class="o">=</span> <span class="s1">&#39;sold&#39;</span> <span class="k">if</span> <span class="n">prop</span><span class="p">[</span><span class="s1">&#39;proposal_open_contract&#39;</span><span class="p">][</span><span class="s1">&#39;is_sold&#39;</span><span class="p">]</span> <span class="k">else</span> <span class="s1">&#39;bid&#39;</span>
    <span class="k">return</span> <span class="n">payout</span><span class="p">,</span> <span class="n">match_flag</span><span class="p">,</span> <span class="n">close_flag</span></div>


<div class="viewcode-block" id="Vanilla">
<a class="viewcode-back" href="../index.html#mvapi.Vanilla">[docs]</a>
<span class="k">class</span> <span class="nc">Vanilla</span><span class="p">(</span><span class="n">Product</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A class to represent a Vanilla product, inheriting from the Product class.</span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">    contract_type : str</span>
<span class="sd">        The type of contract, either &#39;VANILLALONGCALL&#39; or &#39;VANILLALONGPUT&#39;.</span>
<span class="sd">    strike : str</span>
<span class="sd">        The strike price for the contract.</span>
<span class="sd">    duration : int</span>
<span class="sd">        The duration of the contract.</span>
<span class="sd">    duration_unit : str</span>
<span class="sd">        The unit of the duration (&#39;m&#39; for minutes, &#39;h&#39; for hours, &#39;d&#39; for days).</span>

<span class="sd">    Methods</span>
<span class="sd">    -------</span>
<span class="sd">    randomise_attributes():</span>
<span class="sd">        Randomises the attributes of the Vanilla instance.</span>
<span class="sd">    _proposal():</span>
<span class="sd">        Generates a proposal specific to the Vanilla product.</span>
<span class="sd">    check_barrier(runs=0, show=False):</span>
<span class="sd">        Validates the offered barriers in all proposals and for the given number of runs if defined.</span>
<span class="sd">    check_ask(runs=0, show=False):</span>
<span class="sd">        Validates the payout per point (ask price) in all proposals and for the given number of runs if defined.</span>
<span class="sd">    check_payout(runs=0, show=False):</span>
<span class="sd">        Validates the payout (expired/bid price) in all proposals and for the given number of runs if defined.</span>
<span class="sd">    &quot;&quot;&quot;</span>
        
    <span class="n">species</span> <span class="o">=</span> <span class="s2">&quot;Vanilla&quot;</span>
    
<div class="viewcode-block" id="Vanilla.__init__">
<a class="viewcode-back" href="../index.html#mvapi.Vanilla.__init__">[docs]</a>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initializes a Vanilla instance with given keyword arguments.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        **kwargs : dict</span>
<span class="sd">            Keyword arguments for initializing the Vanilla instance, including:</span>
<span class="sd">            - strike (str): The strike price for the contract (default is &#39;+0.00&#39;).</span>
<span class="sd">            - contract_type (str): The type of contract, either &#39;call&#39; or &#39;put&#39; (default is &#39;call&#39;).</span>
<span class="sd">            - duration (int): The duration of the contract (default is 1).</span>
<span class="sd">            - duration_unit (str): The unit of the duration (&#39;m&#39; for minutes, &#39;h&#39; for hours, &#39;d&#39; for days, default is &#39;m&#39;).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">strike</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;strike&#39;</span><span class="p">,</span> <span class="s1">&#39;+0.00&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">contract_type</span> <span class="o">=</span> <span class="s1">&#39;VANILLALONGCALL&#39;</span> <span class="k">if</span> <span class="s1">&#39;c&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;contract_type&#39;</span><span class="p">,</span> <span class="s1">&#39;call&#39;</span><span class="p">)</span> <span class="k">else</span> <span class="s1">&#39;VANILLALONGPUT&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">duration</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;duration&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">duration_unit</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;duration_unit&#39;</span><span class="p">,</span> <span class="s1">&#39;m&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">user_input_params</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;stake&#39;</span><span class="p">,</span><span class="s1">&#39;symbol&#39;</span><span class="p">,</span><span class="s1">&#39;duration_unit&#39;</span><span class="p">,</span><span class="s1">&#39;duration&#39;</span><span class="p">]</span></div>

            
<div class="viewcode-block" id="Vanilla.randomise_attributes">
<a class="viewcode-back" href="../index.html#mvapi.Vanilla.randomise_attributes">[docs]</a>
    <span class="k">def</span> <span class="nf">randomise_attributes</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Randomize the attributes of the Vanilla instance.</span>
<span class="sd">        Randomizes the symbol, duration unit, strike price, contract type, and duration.</span>
<span class="sd">       </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">symbol</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">symbols</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">duration_unit</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">([</span><span class="s1">&#39;m&#39;</span><span class="p">,</span><span class="s1">&#39;h&#39;</span><span class="p">,</span><span class="s1">&#39;d&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">strike</span> <span class="o">=</span> <span class="s1">&#39;+0.00&#39;</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">duration_unit</span> <span class="o">!=</span> <span class="s1">&#39;d&#39;</span> <span class="k">else</span> <span class="s1">&#39;1000&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">contract_type</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">([</span><span class="s1">&#39;VANILLALONGCALL&#39;</span><span class="p">,</span><span class="s1">&#39;VANILLALONGPUT&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">duration</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">61</span><span class="p">)</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">duration_unit</span> <span class="o">==</span> <span class="s1">&#39;m&#39;</span> <span class="k">else</span>\
                        <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">25</span><span class="p">)</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">duration_unit</span> <span class="o">==</span> <span class="s1">&#39;h&#39;</span> <span class="k">else</span>\
                        <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="p">(</span><span class="mi">14</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">symbol</span> <span class="o">==</span> <span class="s1">&#39;1HZ250V&#39;</span> <span class="k">else</span> <span class="mi">40</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">symbol</span> <span class="o">==</span> <span class="s1">&#39;1HZ150V&#39;</span> <span class="k">else</span> <span class="mi">365</span><span class="p">))</span> </div>

        
<div class="viewcode-block" id="Vanilla._proposal">
<a class="viewcode-back" href="../index.html#mvapi.Vanilla._proposal">[docs]</a>
    <span class="k">def</span> <span class="nf">_proposal</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Generate a proposal specific to the Vanilla product.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        str</span>
<span class="sd">            The proposal in JSON format.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">proposal</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">proposal_type</span> <span class="o">==</span> <span class="s1">&#39;price_proposal&#39;</span><span class="p">:</span>
            <span class="n">proposal</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;proposal&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
                <span class="s2">&quot;amount&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">stake</span><span class="p">,</span>
                <span class="s2">&quot;basis&quot;</span><span class="p">:</span> <span class="s2">&quot;stake&quot;</span><span class="p">,</span>
                <span class="s2">&quot;contract_type&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">contract_type</span><span class="p">,</span>
                <span class="s2">&quot;currency&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">currency</span><span class="p">,</span>
                <span class="s2">&quot;symbol&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">symbol</span><span class="p">,</span>
                <span class="s1">&#39;barrier&#39;</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">strike</span><span class="p">,</span>
                <span class="s1">&#39;duration&#39;</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">duration</span><span class="p">,</span>
                <span class="s1">&#39;duration_unit&#39;</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">duration_unit</span>
            <span class="p">}</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">_proposal</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">proposal</span><span class="p">)</span></div>


<div class="viewcode-block" id="Vanilla.check_barrier">
<a class="viewcode-back" href="../index.html#mvapi.Vanilla.check_barrier">[docs]</a>
    <span class="k">def</span> <span class="nf">check_barrier</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">runs</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">show</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Checks offered barrier choices for all saved proposals and the given number of runs.</span>

<span class="sd">        Randomises attributes and generates price proposals for the specified number of runs.</span>
<span class="sd">        Analyzes messages to check if barriers are accurate and displays the results.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        runs : int</span>
<span class="sd">            The number of times to run the check.</span>
<span class="sd">        show : bool</span>
<span class="sd">            If True, displays messages with failed barrier checks.</span>
<span class="sd">        **kwargs : dict</span>
<span class="sd">            Additional keyword arguments for setting attributes.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        Updates the `stats[&#39;barrier_stats&#39;]` attribute with the validation results.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">runs</span><span class="p">):</span>
            <span class="n">clear_output</span><span class="p">(</span><span class="n">wait</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">randomise_attributes</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_set_attributes</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">price_proposal</span><span class="p">()</span>
        <span class="n">clear_output</span><span class="p">(</span><span class="n">wait</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stats</span><span class="p">[</span><span class="s1">&#39;barrier_stats&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;cases&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;pass&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;fail&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">}</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">messages</span><span class="p">:</span>
            <span class="k">if</span> <span class="s1">&#39;msg_type&#39;</span> <span class="ow">in</span> <span class="n">item</span> <span class="ow">and</span> <span class="n">item</span><span class="p">[</span><span class="s1">&#39;msg_type&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;proposal&#39;</span> <span class="ow">and</span> <span class="s1">&#39;error&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">item</span> <span class="ow">and</span> <span class="s1">&#39;VANILLA&#39;</span> <span class="ow">in</span> <span class="n">item</span><span class="p">[</span><span class="s1">&#39;echo_req&#39;</span><span class="p">][</span><span class="s1">&#39;contract_type&#39;</span><span class="p">]:</span>
                <span class="n">temp_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;barrier_choices&#39;</span><span class="p">:</span> <span class="n">vanilla_barriers</span><span class="p">(</span><span class="n">item</span><span class="p">)}</span>
                <span class="n">insert_dict</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="s1">&#39;mv&#39;</span><span class="p">,</span> <span class="n">temp_dict</span><span class="p">)</span>    
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">barrier_pass_fail</span> <span class="o">=</span>  <span class="nb">all</span><span class="p">([</span><span class="nb">float</span><span class="p">(</span><span class="n">bar</span><span class="p">)</span> <span class="k">for</span> <span class="n">bar</span> <span class="ow">in</span> <span class="n">item</span><span class="p">[</span><span class="s1">&#39;proposal&#39;</span><span class="p">][</span><span class="s1">&#39;barrier_choices&#39;</span><span class="p">]]</span> <span class="o">==</span> <span class="n">item</span><span class="p">[</span><span class="s1">&#39;mv&#39;</span><span class="p">][</span><span class="s1">&#39;barrier_choices&#39;</span><span class="p">])</span>
                <span class="k">except</span><span class="p">:</span>
                    <span class="n">item</span><span class="p">[</span><span class="s1">&#39;mv&#39;</span><span class="p">][</span><span class="s1">&#39;barrier_choices&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">item</span><span class="p">[</span><span class="s1">&#39;mv&#39;</span><span class="p">][</span><span class="s1">&#39;barrier_choices&#39;</span><span class="p">])</span>
                    <span class="n">barrier_pass_fail</span> <span class="o">=</span> <span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="n">bar</span><span class="p">)</span> <span class="k">for</span> <span class="n">bar</span> <span class="ow">in</span> <span class="n">item</span><span class="p">[</span><span class="s1">&#39;proposal&#39;</span><span class="p">][</span><span class="s1">&#39;barrier_choices&#39;</span><span class="p">]]</span> <span class="o">==</span> <span class="n">item</span><span class="p">[</span><span class="s1">&#39;mv&#39;</span><span class="p">][</span><span class="s1">&#39;barrier_choices&#39;</span><span class="p">]</span>
                <span class="n">item</span><span class="p">[</span><span class="s1">&#39;mv&#39;</span><span class="p">][</span><span class="s1">&#39;barrier_check&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">barrier_pass_fail</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">stats</span><span class="p">[</span><span class="s1">&#39;barrier_stats&#39;</span><span class="p">][</span><span class="s1">&#39;cases&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="k">if</span> <span class="n">barrier_pass_fail</span><span class="p">:</span> 
                    <span class="bp">self</span><span class="o">.</span><span class="n">stats</span><span class="p">[</span><span class="s1">&#39;barrier_stats&#39;</span><span class="p">][</span><span class="s1">&#39;pass&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="k">else</span><span class="p">:</span> 
                    <span class="bp">self</span><span class="o">.</span><span class="n">stats</span><span class="p">[</span><span class="s1">&#39;barrier_stats&#39;</span><span class="p">][</span><span class="s1">&#39;fail&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>               
                <span class="k">if</span> <span class="ow">not</span> <span class="n">barrier_pass_fail</span> <span class="ow">and</span> <span class="n">show</span><span class="p">:</span>
                    <span class="n">display</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stats_barrier</span> <span class="o">=</span> <span class="n">dict_to_df</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stats</span><span class="p">[</span><span class="s1">&#39;barrier_stats&#39;</span><span class="p">],</span> <span class="s1">&#39;Barrier&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">stats_barrier</span></div>


<div class="viewcode-block" id="Vanilla.check_ask">
<a class="viewcode-back" href="../index.html#mvapi.Vanilla.check_ask">[docs]</a>
    <span class="k">def</span> <span class="nf">check_ask</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">runs</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">show</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Validate the payout per point (ask price) in all proposals and for the given number of runs if specified.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        runs : int, optional</span>
<span class="sd">            The number of additional random contracts to validate (default is 0).</span>
<span class="sd">        show : bool, optional</span>
<span class="sd">            Whether to display failed validations (default is False).</span>
<span class="sd">        **kwargs : dict</span>
<span class="sd">            Additional attributes to set for the Vanilla instance.</span>
<span class="sd">        </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        Updates the `stats[&#39;ask_stats&#39;]` attribute with the validation results.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">runs</span><span class="p">):</span>
            <span class="n">clear_output</span><span class="p">(</span><span class="n">wait</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">randomise_attributes</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_set_attributes</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">price_proposal</span><span class="p">()</span>
            <span class="c1"># self.buy_contract()</span>
        <span class="n">clear_output</span><span class="p">(</span><span class="n">wait</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stats</span><span class="p">[</span><span class="s1">&#39;ask_stats&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;cases&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;pass&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;fail&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">}</span>        
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">messages</span><span class="p">:</span>
            <span class="k">if</span> <span class="s1">&#39;msg_type&#39;</span> <span class="ow">in</span> <span class="n">item</span> <span class="ow">and</span> <span class="n">item</span><span class="p">[</span><span class="s1">&#39;msg_type&#39;</span><span class="p">]</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;proposal&#39;</span><span class="p">]</span> <span class="ow">and</span> <span class="s1">&#39;error&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">item</span> <span class="ow">and</span> <span class="s1">&#39;VANILLA&#39;</span> <span class="ow">in</span> <span class="n">item</span><span class="p">[</span><span class="s1">&#39;echo_req&#39;</span><span class="p">][</span><span class="s1">&#39;contract_type&#39;</span><span class="p">]:</span>
            <span class="c1"># and item[&#39;proposal_open_contract&#39;][&#39;date_start&#39;] == item[&#39;proposal_open_contract&#39;][&#39;current_spot_time&#39;]:</span>
                <span class="n">temp_dict</span> <span class="o">=</span> <span class="p">{}</span>
                <span class="n">temp_dict</span><span class="p">[</span><span class="s1">&#39;ask_ppp&#39;</span><span class="p">],</span> <span class="n">temp_dict</span><span class="p">[</span><span class="s1">&#39;ask_ppp_check&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">vanilla_ppp_ask</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>                
                <span class="n">insert_dict</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="s1">&#39;mv&#39;</span><span class="p">,</span> <span class="n">temp_dict</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">stats</span><span class="p">[</span><span class="s1">&#39;ask_stats&#39;</span><span class="p">][</span><span class="s1">&#39;cases&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="k">if</span> <span class="n">item</span><span class="p">[</span><span class="s1">&#39;mv&#39;</span><span class="p">][</span><span class="s1">&#39;ask_ppp_check&#39;</span><span class="p">]:</span> 
                    <span class="bp">self</span><span class="o">.</span><span class="n">stats</span><span class="p">[</span><span class="s1">&#39;ask_stats&#39;</span><span class="p">][</span><span class="s1">&#39;pass&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="k">else</span><span class="p">:</span> 
                    <span class="bp">self</span><span class="o">.</span><span class="n">stats</span><span class="p">[</span><span class="s1">&#39;ask_stats&#39;</span><span class="p">][</span><span class="s1">&#39;fail&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>                    
                <span class="k">if</span> <span class="ow">not</span> <span class="n">item</span><span class="p">[</span><span class="s1">&#39;mv&#39;</span><span class="p">][</span><span class="s1">&#39;ask_ppp_check&#39;</span><span class="p">]</span> <span class="ow">and</span> <span class="n">show</span><span class="p">:</span>
                    <span class="n">display</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stats_ask</span> <span class="o">=</span> <span class="n">dict_to_df</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stats</span><span class="p">[</span><span class="s1">&#39;ask_stats&#39;</span><span class="p">],</span> <span class="s1">&#39;Ask Price&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">stats_ask</span></div>


<div class="viewcode-block" id="Vanilla.check_payout">
<a class="viewcode-back" href="../index.html#mvapi.Vanilla.check_payout">[docs]</a>
    <span class="k">def</span> <span class="nf">check_payout</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">runs</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">show</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Validates the payout (bid price) in all saved proposals and for additional runs if specified.</span>

<span class="sd">        This method evaluates the correctness of payouts by calculating the bid price </span>
<span class="sd">        for each proposal using the financial model and comparing it with the actual </span>
<span class="sd">        value provided by the contract. The results are categorized by contract states.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        runs : int, optional</span>
<span class="sd">            The number of additional random contracts to test (default is 0).</span>
<span class="sd">        show : bool, optional</span>
<span class="sd">            Whether to display proposals with failed payout validations (default is False).</span>
<span class="sd">        **kwargs : dict, optional</span>
<span class="sd">            Additional attributes or parameters for contract creation during testing.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        - Results are stored in the `self.stats[&#39;payout_check&#39;]` dictionary, which tracks </span>
<span class="sd">        the total cases and their outcomes (`pass` or `fail`) for contracts in the </span>
<span class="sd">        following states:</span>
<span class="sd">            - `total`: All contracts evaluated during the method execution.</span>
<span class="sd">            - `expired`: Contracts that have expired.</span>
<span class="sd">            - `sold`: Contracts that are sold.</span>
<span class="sd">            - `bid`: Contracts in &quot;bid&quot; (active) state.</span>
<span class="sd">        - Failed payout checks are displayed if `show=True`.</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; vanilla_product = Vanilla()</span>
<span class="sd">        &gt;&gt;&gt; vanilla_product.check_payout(runs=10, show=True)</span>
<span class="sd">        Cases for Payout check:</span>
<span class="sd">        Category  cases  pass  fail</span>
<span class="sd">        0     total     10     9     1</span>
<span class="sd">        1   expired      2     2     0</span>
<span class="sd">        2      sold      6     5     1</span>
<span class="sd">        3       bid      2     2     0</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">runs</span><span class="p">):</span>
            <span class="n">clear_output</span><span class="p">(</span><span class="n">wait</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">buy_contract</span><span class="p">(</span><span class="n">random</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_all_poc</span><span class="p">()</span>
        <span class="n">clear_output</span><span class="p">(</span><span class="n">wait</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stats</span><span class="p">[</span><span class="s1">&#39;payout_check&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;total&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;cases&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;pass&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;fail&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">},</span>
            <span class="s1">&#39;expired&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;cases&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;pass&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;fail&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">},</span>
            <span class="s1">&#39;sold&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;cases&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;pass&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;fail&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">},</span>
            <span class="s1">&#39;bid&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;cases&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;pass&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;fail&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">}</span>
        <span class="p">}</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">messages</span><span class="p">:</span>
            <span class="k">if</span> <span class="s1">&#39;msg_type&#39;</span> <span class="ow">in</span> <span class="n">item</span> <span class="ow">and</span> <span class="n">item</span><span class="p">[</span><span class="s1">&#39;msg_type&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;proposal_open_contract&#39;</span> <span class="ow">and</span> <span class="s1">&#39;error&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">item</span> <span class="ow">and</span> <span class="s1">&#39;VANILLA&#39;</span> <span class="ow">in</span> <span class="n">item</span><span class="p">[</span><span class="s1">&#39;proposal_open_contract&#39;</span><span class="p">][</span><span class="s1">&#39;contract_type&#39;</span><span class="p">]:</span>
                <span class="n">temp_dict</span> <span class="o">=</span> <span class="p">{}</span>
                <span class="n">temp_dict</span><span class="p">[</span><span class="s1">&#39;payout&#39;</span><span class="p">],</span> <span class="n">temp_dict</span><span class="p">[</span><span class="s1">&#39;payout_check&#39;</span><span class="p">],</span> <span class="n">temp_dict</span><span class="p">[</span><span class="s1">&#39;close_flag&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">vanilla_payout</span><span class="p">(</span><span class="n">item</span><span class="p">)</span> 
                <span class="n">insert_dict</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="s1">&#39;mv&#39;</span><span class="p">,</span> <span class="n">temp_dict</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">stats</span><span class="p">[</span><span class="s1">&#39;payout_check&#39;</span><span class="p">][</span><span class="n">temp_dict</span><span class="p">[</span><span class="s1">&#39;close_flag&#39;</span><span class="p">]][</span><span class="s1">&#39;cases&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">stats</span><span class="p">[</span><span class="s1">&#39;payout_check&#39;</span><span class="p">][</span><span class="s1">&#39;total&#39;</span><span class="p">][</span><span class="s1">&#39;cases&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="k">if</span> <span class="n">item</span><span class="p">[</span><span class="s1">&#39;mv&#39;</span><span class="p">][</span><span class="s1">&#39;payout_check&#39;</span><span class="p">]:</span> 
                    <span class="bp">self</span><span class="o">.</span><span class="n">stats</span><span class="p">[</span><span class="s1">&#39;payout_check&#39;</span><span class="p">][</span><span class="n">temp_dict</span><span class="p">[</span><span class="s1">&#39;close_flag&#39;</span><span class="p">]][</span><span class="s1">&#39;pass&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">stats</span><span class="p">[</span><span class="s1">&#39;payout_check&#39;</span><span class="p">][</span><span class="s1">&#39;total&#39;</span><span class="p">][</span><span class="s1">&#39;pass&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="k">else</span><span class="p">:</span> 
                    <span class="bp">self</span><span class="o">.</span><span class="n">stats</span><span class="p">[</span><span class="s1">&#39;payout_check&#39;</span><span class="p">][</span><span class="n">temp_dict</span><span class="p">[</span><span class="s1">&#39;close_flag&#39;</span><span class="p">]][</span><span class="s1">&#39;fail&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>  
                    <span class="bp">self</span><span class="o">.</span><span class="n">stats</span><span class="p">[</span><span class="s1">&#39;payout_check&#39;</span><span class="p">][</span><span class="s1">&#39;total&#39;</span><span class="p">][</span><span class="s1">&#39;fail&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">item</span><span class="p">[</span><span class="s1">&#39;mv&#39;</span><span class="p">][</span><span class="s1">&#39;payout_check&#39;</span><span class="p">]</span> <span class="ow">and</span> <span class="n">show</span><span class="p">:</span>
                    <span class="n">display</span><span class="p">(</span><span class="n">item</span><span class="p">)</span> 
        <span class="bp">self</span><span class="o">.</span><span class="n">stats_payout</span> <span class="o">=</span> <span class="n">dict_to_df</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stats</span><span class="p">[</span><span class="s1">&#39;payout_check&#39;</span><span class="p">],</span> <span class="s1">&#39;Payout&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">stats_payout</span></div>
</div>


<div class="viewcode-block" id="turbo_ask">
<a class="viewcode-back" href="../index.html#mvapi.turbo_ask">[docs]</a>
<span class="k">def</span> <span class="nf">turbo_ask</span> <span class="p">(</span><span class="n">symbol</span><span class="p">,</span> <span class="n">spot</span><span class="p">,</span> <span class="n">barrier</span><span class="p">,</span> <span class="n">duration_unit</span><span class="p">,</span> <span class="n">phi</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculates the ask price for a turbo contract.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    symbol : str</span>
<span class="sd">        The underlying symbol for contract.</span>
<span class="sd">    spot : float</span>
<span class="sd">        The current spot price of the instrument.</span>
<span class="sd">    barrier : float</span>
<span class="sd">        The barrier level for the contract.</span>
<span class="sd">    duration_unit : str</span>
<span class="sd">        The unit of duration, e.g., &#39;t&#39; for ticks, &#39;d&#39; for days, etc.</span>
<span class="sd">    phi : int</span>
<span class="sd">        The direction of the contract, 1 for long, -1 for short.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    float</span>
<span class="sd">        The calculated ask price for the turbo contract.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">tick_comm</span> <span class="o">=</span> <span class="s1">&#39;tick_comm_&#39;</span> <span class="o">+</span> <span class="p">(</span><span class="s1">&#39;up&#39;</span> <span class="k">if</span> <span class="n">phi</span> <span class="o">==</span> <span class="mi">1</span> <span class="k">else</span> <span class="s1">&#39;down&#39;</span><span class="p">)</span>
    <span class="n">tick_comm</span> <span class="o">+=</span> <span class="s1">&#39;_t&#39;</span> <span class="k">if</span>  <span class="n">duration_unit</span> <span class="o">==</span> <span class="s1">&#39;t&#39;</span> <span class="k">else</span>  <span class="s1">&#39;_d&#39;</span> <span class="k">if</span> <span class="n">duration_unit</span> <span class="o">==</span> <span class="s1">&#39;d&#39;</span> <span class="k">else</span> <span class="s1">&#39;_i&#39;</span>
    <span class="n">sigma</span> <span class="o">=</span> <span class="n">get_sigma</span><span class="p">(</span><span class="n">symbol</span><span class="p">)</span>
    <span class="n">is_r</span> <span class="o">=</span> <span class="mi">2</span> <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;R&#39;</span><span class="p">),</span> <span class="n">symbol</span><span class="p">)</span> <span class="k">else</span> <span class="mi">1</span>
    <span class="k">if</span> <span class="n">phi</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">commup</span> <span class="o">=</span> <span class="n">BO</span><span class="p">[</span><span class="s1">&#39;turbos&#39;</span><span class="p">][</span><span class="n">tick_comm</span><span class="p">][</span><span class="n">symbol</span><span class="p">]</span> <span class="o">*</span> <span class="n">sigma</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">is_r</span><span class="o">/</span><span class="mi">365</span><span class="o">/</span><span class="mi">86400</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">spot</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">commup</span><span class="p">)</span> <span class="o">-</span> <span class="n">barrier</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">commdown</span> <span class="o">=</span> <span class="n">BO</span><span class="p">[</span><span class="s1">&#39;turbos&#39;</span><span class="p">][</span><span class="n">tick_comm</span><span class="p">][</span><span class="n">symbol</span><span class="p">]</span> <span class="o">*</span> <span class="n">sigma</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">is_r</span><span class="o">/</span><span class="mi">365</span><span class="o">/</span><span class="mi">86400</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">barrier</span> <span class="o">-</span> <span class="n">spot</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">commdown</span><span class="p">)</span> </div>


<div class="viewcode-block" id="turbo_barrier">
<a class="viewcode-back" href="../index.html#mvapi.turbo_barrier">[docs]</a>
<span class="k">def</span> <span class="nf">turbo_barrier</span><span class="p">(</span><span class="n">prop</span><span class="p">,</span> <span class="n">start_of_min_spot</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculate the expected barrier from the proposal.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    prop : dict</span>
<span class="sd">        The proposal data as a dictionary.</span>
<span class="sd">    start_of_min_spot : float</span>
<span class="sd">        The spot price at the start of the minute of the contract.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    float</span>
<span class="sd">        The calculated barrier level.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">phi</span> <span class="o">=</span> <span class="mi">1</span> <span class="k">if</span> <span class="n">prop</span><span class="p">[</span><span class="s1">&#39;echo_req&#39;</span><span class="p">][</span><span class="s1">&#39;contract_type&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;TURBOSLONG&#39;</span> <span class="k">else</span> <span class="o">-</span><span class="mi">1</span>
    <span class="n">symbol</span> <span class="o">=</span> <span class="n">prop</span><span class="p">[</span><span class="s1">&#39;echo_req&#39;</span><span class="p">][</span><span class="s1">&#39;symbol&#39;</span><span class="p">]</span>
    <span class="n">spot</span> <span class="o">=</span> <span class="n">start_of_min_spot</span>
    <span class="n">ppp</span> <span class="o">=</span> <span class="n">prop</span><span class="p">[</span><span class="s1">&#39;echo_req&#39;</span><span class="p">][</span><span class="s1">&#39;payout_per_point&#39;</span><span class="p">]</span>
    <span class="n">stake</span> <span class="o">=</span> <span class="n">get_stake</span><span class="p">(</span><span class="n">prop</span><span class="p">)</span>
    <span class="n">tick_comm</span> <span class="o">=</span> <span class="s1">&#39;tick_comm_&#39;</span> <span class="o">+</span> <span class="p">(</span><span class="s1">&#39;up&#39;</span> <span class="k">if</span> <span class="n">phi</span> <span class="o">==</span> <span class="mi">1</span> <span class="k">else</span> <span class="s1">&#39;down&#39;</span><span class="p">)</span>
    <span class="n">tick_comm</span> <span class="o">+=</span> <span class="s1">&#39;_t&#39;</span> <span class="k">if</span>  <span class="n">prop</span><span class="p">[</span><span class="s1">&#39;echo_req&#39;</span><span class="p">][</span><span class="s1">&#39;duration_unit&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;t&#39;</span> <span class="k">else</span>  <span class="s1">&#39;_d&#39;</span> <span class="k">if</span> <span class="n">prop</span><span class="p">[</span><span class="s1">&#39;echo_req&#39;</span><span class="p">][</span><span class="s1">&#39;duration_unit&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;d&#39;</span> <span class="k">else</span> <span class="s1">&#39;_i&#39;</span>
    <span class="n">sigma</span> <span class="o">=</span> <span class="n">get_sigma</span><span class="p">(</span><span class="n">symbol</span><span class="p">)</span>
    <span class="n">is_r</span> <span class="o">=</span> <span class="mi">2</span> <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;R&#39;</span><span class="p">),</span> <span class="n">symbol</span><span class="p">)</span> <span class="k">else</span> <span class="mi">1</span>
    <span class="n">comm</span> <span class="o">=</span> <span class="n">BO</span><span class="p">[</span><span class="s1">&#39;turbos&#39;</span><span class="p">][</span><span class="n">tick_comm</span><span class="p">][</span><span class="n">symbol</span><span class="p">]</span> <span class="o">*</span> <span class="n">sigma</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">is_r</span><span class="o">/</span><span class="mi">365</span><span class="o">/</span><span class="mi">86400</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">phi</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">barrier</span> <span class="o">=</span> <span class="n">roundup</span><span class="p">(</span><span class="n">spot</span> <span class="o">*</span> <span class="n">comm</span> <span class="o">-</span> <span class="n">stake</span><span class="o">/</span><span class="n">ppp</span><span class="p">,</span> <span class="n">symbols</span><span class="p">[</span><span class="n">symbol</span><span class="p">][</span><span class="s1">&#39;precision&#39;</span><span class="p">])</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">barrier</span> <span class="o">=</span> <span class="n">rounddown</span><span class="p">(</span><span class="n">stake</span><span class="o">/</span><span class="n">ppp</span> <span class="o">-</span> <span class="n">spot</span> <span class="o">*</span> <span class="n">comm</span><span class="p">,</span> <span class="n">symbols</span><span class="p">[</span><span class="n">symbol</span><span class="p">][</span><span class="s1">&#39;precision&#39;</span><span class="p">])</span>
    <span class="k">return</span> <span class="nb">round</span><span class="p">(</span><span class="n">prop</span><span class="p">[</span><span class="s1">&#39;proposal&#39;</span><span class="p">][</span><span class="s1">&#39;spot&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">barrier</span><span class="p">,</span> <span class="n">symbols</span><span class="p">[</span><span class="n">symbol</span><span class="p">][</span><span class="s1">&#39;precision&#39;</span><span class="p">])</span> </div>

    
<div class="viewcode-block" id="turbo_ppps">
<a class="viewcode-back" href="../index.html#mvapi.turbo_ppps">[docs]</a>
<span class="k">def</span> <span class="nf">turbo_ppps</span><span class="p">(</span><span class="n">prop</span><span class="p">,</span> <span class="n">start_of_min_spot</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">list</span><span class="p">,</span> <span class="nb">bool</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculates the expected offered payout_per_point choices from the given json.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    prop : dict</span>
<span class="sd">        The proposal data as a dictionary.</span>
<span class="sd">    start_of_min_spot : float</span>
<span class="sd">        The spot price at the start of the minute of the contract.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    tuple</span>
<span class="sd">        A tuple containing the list of offered payout per point choices,</span>
<span class="sd">        a boolean indicating if the offered choices match the expected choices,</span>
<span class="sd">        and if the barrier matches the expected barrier.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">stake</span> <span class="o">=</span> <span class="n">get_stake</span><span class="p">(</span><span class="n">prop</span><span class="p">)</span>
    <span class="n">phi</span> <span class="o">=</span> <span class="mi">1</span> <span class="k">if</span> <span class="s1">&#39;LONG&#39;</span> <span class="ow">in</span> <span class="n">prop</span><span class="p">[</span><span class="s1">&#39;echo_req&#39;</span><span class="p">][</span><span class="s1">&#39;contract_type&#39;</span><span class="p">]</span> <span class="k">else</span> <span class="o">-</span><span class="mi">1</span>
    <span class="n">symbol</span> <span class="o">=</span> <span class="n">prop</span><span class="p">[</span><span class="s1">&#39;echo_req&#39;</span><span class="p">][</span><span class="s1">&#39;symbol&#39;</span><span class="p">]</span>
    <span class="n">spot</span> <span class="o">=</span> <span class="n">start_of_min_spot</span>
    <span class="n">duration_unit</span> <span class="o">=</span> <span class="n">prop</span><span class="p">[</span><span class="s1">&#39;echo_req&#39;</span><span class="p">][</span><span class="s1">&#39;duration_unit&#39;</span><span class="p">]</span>
    <span class="n">sigma</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;(\d+)[^\d]*$&#39;</span><span class="p">,</span> <span class="n">symbol</span><span class="p">)</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span><span class="o">/</span><span class="mi">100</span>
    <span class="n">barrier_far</span> <span class="o">=</span> <span class="n">spot</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">phi</span> <span class="o">*</span> <span class="n">sigma</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">BO</span><span class="p">[</span><span class="s1">&#39;turbos&#39;</span><span class="p">][</span><span class="s1">&#39;T_max&#39;</span><span class="p">][</span><span class="n">symbol</span><span class="p">]</span><span class="o">/</span><span class="mi">365</span><span class="o">/</span><span class="mi">86400</span><span class="p">))</span>
    <span class="n">barrier_close</span> <span class="o">=</span> <span class="n">spot</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">phi</span> <span class="o">*</span> <span class="n">sigma</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">BO</span><span class="p">[</span><span class="s1">&#39;turbos&#39;</span><span class="p">][</span><span class="s1">&#39;T_min&#39;</span><span class="p">][</span><span class="n">symbol</span><span class="p">]</span><span class="o">/</span><span class="mi">365</span><span class="o">/</span><span class="mi">86400</span><span class="p">))</span>
    <span class="n">n_far</span> <span class="o">=</span> <span class="n">stake</span> <span class="o">/</span> <span class="n">turbo_ask</span><span class="p">(</span><span class="n">symbol</span><span class="p">,</span> <span class="n">spot</span><span class="p">,</span> <span class="n">barrier_far</span><span class="p">,</span> <span class="n">duration_unit</span><span class="p">,</span> <span class="n">phi</span><span class="p">)</span>
    <span class="n">n_close</span> <span class="o">=</span> <span class="n">stake</span> <span class="o">/</span> <span class="n">turbo_ask</span><span class="p">(</span><span class="n">symbol</span><span class="p">,</span> <span class="n">spot</span><span class="p">,</span> <span class="n">barrier_close</span><span class="p">,</span> <span class="n">duration_unit</span><span class="p">,</span> <span class="n">phi</span><span class="p">)</span>
    <span class="n">increment</span> <span class="o">=</span>  <span class="n">roundsf</span><span class="p">((</span><span class="n">n_close</span> <span class="o">-</span> <span class="n">n_far</span><span class="p">)</span> <span class="o">*</span> <span class="n">BO</span><span class="p">[</span><span class="s1">&#39;turbos&#39;</span><span class="p">][</span><span class="s1">&#39;ip&#39;</span><span class="p">][</span><span class="n">symbol</span><span class="p">])</span>
    <span class="n">tn</span> <span class="o">=</span> <span class="n">roundup</span><span class="p">(</span><span class="n">n_far</span><span class="o">/</span><span class="n">increment</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span> <span class="c1">#tn is the smallests ppp</span>
    <span class="n">t0</span> <span class="o">=</span> <span class="n">rounddown</span><span class="p">(</span><span class="n">n_close</span><span class="o">/</span><span class="n">increment</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span> <span class="c1">#t0 is the largest</span>
    <span class="n">ppp</span> <span class="o">=</span> <span class="p">[</span><span class="n">tn</span><span class="o">*</span><span class="n">increment</span><span class="p">]</span>
    <span class="k">while</span> <span class="n">ppp</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">t0</span><span class="o">*</span><span class="n">increment</span><span class="p">:</span>
        <span class="n">ppp</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">ppp</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="n">increment</span><span class="p">,</span><span class="mi">12</span><span class="p">))</span>
    <span class="n">ppp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">ppp</span><span class="p">)</span>
    <span class="n">offered_pps</span> <span class="o">=</span> <span class="n">ppp</span><span class="p">[</span><span class="n">ppp</span> <span class="o">&lt;=</span> <span class="nb">round</span><span class="p">(</span><span class="n">t0</span><span class="o">*</span><span class="n">increment</span><span class="p">,</span><span class="mi">12</span><span class="p">)]</span>
    <span class="n">barrier</span> <span class="o">=</span> <span class="n">turbo_barrier</span><span class="p">(</span><span class="n">prop</span><span class="p">,</span> <span class="n">spot</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">offered_pps</span><span class="p">)</span> <span class="o">==</span> <span class="nb">sorted</span><span class="p">([</span><span class="nb">float</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">prop</span><span class="p">[</span><span class="s1">&#39;proposal&#39;</span><span class="p">][</span><span class="s1">&#39;payout_choices&#39;</span><span class="p">]]))</span>
    <span class="k">return</span> <span class="n">offered_pps</span><span class="p">,</span> <span class="n">barrier</span><span class="p">,</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">offered_pps</span><span class="p">)</span> <span class="o">==</span> <span class="nb">sorted</span><span class="p">([</span><span class="nb">float</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">prop</span><span class="p">[</span><span class="s1">&#39;proposal&#39;</span><span class="p">][</span><span class="s1">&#39;payout_choices&#39;</span><span class="p">]])</span> <span class="ow">and</span> <span class="n">barrier</span> <span class="o">==</span> <span class="nb">float</span><span class="p">(</span><span class="n">prop</span><span class="p">[</span><span class="s1">&#39;proposal&#39;</span><span class="p">][</span><span class="s1">&#39;contract_details&#39;</span><span class="p">][</span><span class="s1">&#39;barrier&#39;</span><span class="p">])</span></div>


<div class="viewcode-block" id="turbo_payout">
<a class="viewcode-back" href="../index.html#mvapi.turbo_payout">[docs]</a>
<span class="k">def</span> <span class="nf">turbo_payout</span> <span class="p">(</span><span class="n">prop</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculates the payout for a turbo contract.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    prop : dict</span>
<span class="sd">        The proposal data as a dictionary.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    tuple</span>
<span class="sd">        A tuple containing the payout, a boolean indicating if the offered payout </span>
<span class="sd">        matches the expected payout, and the close flag.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">symbol</span> <span class="o">=</span> <span class="n">prop</span><span class="p">[</span><span class="s1">&#39;proposal_open_contract&#39;</span><span class="p">][</span><span class="s1">&#39;underlying&#39;</span><span class="p">]</span>
    <span class="n">is_r</span> <span class="o">=</span> <span class="mi">2</span> <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;R&#39;</span><span class="p">),</span> <span class="n">symbol</span><span class="p">)</span> <span class="k">else</span> <span class="mi">1</span>
    <span class="n">ctype</span> <span class="o">=</span> <span class="n">prop</span><span class="p">[</span><span class="s1">&#39;proposal_open_contract&#39;</span><span class="p">][</span><span class="s1">&#39;contract_type&#39;</span><span class="p">]</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">spot</span> <span class="o">=</span> <span class="n">prop</span><span class="p">[</span><span class="s1">&#39;proposal_open_contract&#39;</span><span class="p">][</span><span class="s1">&#39;exit_tick&#39;</span><span class="p">]</span> 
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">spot</span> <span class="o">=</span> <span class="n">prop</span><span class="p">[</span><span class="s1">&#39;proposal_open_contract&#39;</span><span class="p">][</span><span class="s1">&#39;current_spot&#39;</span><span class="p">]</span>
    <span class="n">barrier</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">prop</span><span class="p">[</span><span class="s1">&#39;proposal_open_contract&#39;</span><span class="p">][</span><span class="s1">&#39;barrier&#39;</span><span class="p">])</span>
    <span class="n">bid_price</span> <span class="o">=</span> <span class="n">prop</span><span class="p">[</span><span class="s1">&#39;proposal_open_contract&#39;</span><span class="p">][</span><span class="s1">&#39;bid_price&#39;</span><span class="p">]</span>
    <span class="n">ppp</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">prop</span><span class="p">[</span><span class="s1">&#39;proposal_open_contract&#39;</span><span class="p">][</span><span class="s1">&#39;display_number_of_contracts&#39;</span><span class="p">])</span>
    <span class="n">shortcode</span> <span class="o">=</span> <span class="n">prop</span><span class="p">[</span><span class="s1">&#39;proposal_open_contract&#39;</span><span class="p">][</span><span class="s1">&#39;shortcode&#39;</span><span class="p">]</span>
    <span class="n">sigma</span> <span class="o">=</span> <span class="n">get_sigma</span><span class="p">(</span><span class="n">symbol</span><span class="p">)</span>
    <span class="k">if</span> <span class="s1">&#39;exit_tick_time&#39;</span> <span class="ow">in</span> <span class="n">prop</span><span class="p">[</span><span class="s1">&#39;proposal_open_contract&#39;</span><span class="p">]</span> <span class="ow">and</span> <span class="n">prop</span><span class="p">[</span><span class="s1">&#39;proposal_open_contract&#39;</span><span class="p">][</span><span class="s1">&#39;exit_tick_time&#39;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">prop</span><span class="p">[</span><span class="s1">&#39;proposal_open_contract&#39;</span><span class="p">][</span><span class="s1">&#39;expiry_time&#39;</span><span class="p">]:</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">ctype</span> <span class="o">==</span> <span class="s1">&#39;TURBOSLONG&#39;</span> <span class="ow">and</span> <span class="n">spot</span> <span class="o">&lt;=</span> <span class="n">barrier</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">ctype</span> <span class="o">==</span> <span class="s1">&#39;TURBOSSHORT&#39;</span> <span class="ow">and</span> <span class="n">spot</span> <span class="o">&gt;=</span> <span class="n">barrier</span><span class="p">):</span>
            <span class="n">payout</span><span class="p">,</span> <span class="n">close_flag</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;ko&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">payout</span><span class="p">,</span> <span class="n">close_flag</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">spot</span> <span class="o">-</span> <span class="n">barrier</span><span class="p">)</span> <span class="o">*</span> <span class="n">ppp</span><span class="p">,</span> <span class="s1">&#39;expired&#39;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">comm</span> <span class="o">=</span> <span class="s1">&#39;down_&#39;</span><span class="k">if</span> <span class="n">ctype</span> <span class="o">==</span> <span class="s1">&#39;TURBOSLONG&#39;</span> <span class="k">else</span> <span class="s1">&#39;up_&#39;</span>
        <span class="n">comm</span> <span class="o">+=</span> <span class="s1">&#39;t&#39;</span> <span class="k">if</span> <span class="s1">&#39;T&#39;</span> <span class="ow">in</span> <span class="n">shortcode</span><span class="p">[</span><span class="mi">11</span><span class="p">:]</span> <span class="k">else</span> <span class="s1">&#39;i&#39;</span> <span class="k">if</span> <span class="n">prop</span><span class="p">[</span><span class="s1">&#39;proposal_open_contract&#39;</span><span class="p">][</span><span class="s1">&#39;is_intraday&#39;</span><span class="p">]</span> <span class="k">else</span> <span class="s1">&#39;d&#39;</span>
        <span class="n">comm</span> <span class="o">=</span> <span class="s1">&#39;tick_comm_&#39;</span> <span class="o">+</span> <span class="n">comm</span>
        <span class="n">comm</span> <span class="o">=</span> <span class="n">BO</span><span class="p">[</span><span class="s1">&#39;turbos&#39;</span><span class="p">][</span><span class="n">comm</span><span class="p">][</span><span class="n">symbol</span><span class="p">]</span> <span class="o">*</span> <span class="n">sigma</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">is_r</span><span class="o">/</span><span class="mi">365</span><span class="o">/</span><span class="mi">86400</span><span class="p">)</span>
        <span class="c1"># print(comm)</span>
        <span class="n">payout</span><span class="p">,</span> <span class="n">close_flag</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span> <span class="p">(</span><span class="n">spot</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">comm</span><span class="p">)</span> <span class="o">-</span> <span class="n">barrier</span><span class="p">)</span> <span class="o">*</span> <span class="n">ppp</span> <span class="k">if</span> <span class="n">ctype</span> <span class="o">==</span> <span class="s1">&#39;TURBOSLONG&#39;</span> <span class="k">else</span> <span class="p">(</span><span class="n">barrier</span> <span class="o">-</span> <span class="n">spot</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">comm</span><span class="p">))</span> <span class="o">*</span> <span class="n">ppp</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="s1">&#39;sold&#39;</span> <span class="k">if</span> <span class="n">prop</span><span class="p">[</span><span class="s1">&#39;proposal_open_contract&#39;</span><span class="p">][</span><span class="s1">&#39;is_sold&#39;</span><span class="p">]</span> <span class="k">else</span> <span class="s1">&#39;bid&#39;</span>
    <span class="n">match_flag</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">payout</span><span class="p">,</span><span class="n">BO</span><span class="p">[</span><span class="s1">&#39;currency_precision&#39;</span><span class="p">][</span><span class="n">prop</span><span class="p">[</span><span class="s1">&#39;proposal_open_contract&#39;</span><span class="p">][</span><span class="s1">&#39;currency&#39;</span><span class="p">]])</span> <span class="o">==</span> <span class="n">bid_price</span>
    <span class="k">return</span> <span class="n">payout</span><span class="p">,</span> <span class="n">match_flag</span><span class="p">,</span> <span class="n">close_flag</span></div>


<div class="viewcode-block" id="Turbo">
<a class="viewcode-back" href="../index.html#mvapi.Turbo">[docs]</a>
<span class="k">class</span> <span class="nc">Turbo</span><span class="p">(</span><span class="n">Product</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A class to represent a Turbo product, inheriting from the Product class.</span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">    species : str</span>
<span class="sd">        The type of the product, &#39;turbo&#39;.</span>
<span class="sd">    strike : str</span>
<span class="sd">        The strike price for the contract, default is &#39;+10.00&#39;.</span>
<span class="sd">    payout_per_point : float</span>
<span class="sd">        The payout per point, default is 2.</span>
<span class="sd">    contract_type : str</span>
<span class="sd">        The type of contract, either &#39;TURBOSLONG&#39; or &#39;TURBOSSHORT&#39;.</span>
<span class="sd">    duration : int</span>
<span class="sd">        The duration of the contract, default is 5.</span>
<span class="sd">    duration_unit : str</span>
<span class="sd">        The unit of the duration (&#39;t&#39; for ticks, &#39;s&#39; for seconds, &#39;m&#39; for minutes, &#39;h&#39; for hours, &#39;d&#39; for days).</span>

<span class="sd">    Methods</span>
<span class="sd">    -------</span>
<span class="sd">    randomise_attributes()</span>
<span class="sd">        Randomises the attributes of the Turbo instance.</span>
<span class="sd">    _proposal()</span>
<span class="sd">        Generates a proposal specific to the Turbo product.</span>
<span class="sd">    get_start_of_min_tick(prop)</span>
<span class="sd">        Gets the start of the minimum tick price.</span>
<span class="sd">    check_ppps(runs=0, show=False, **kwargs)</span>
<span class="sd">        Checks the payout per point choices.</span>
<span class="sd">    check_payout(runs=0, show=False, **kwargs)</span>
<span class="sd">        Checks the payout for the Turbo product.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">species</span> <span class="o">=</span> <span class="s2">&quot;Turbo&quot;</span>
    
<div class="viewcode-block" id="Turbo.__init__">
<a class="viewcode-back" href="../index.html#mvapi.Turbo.__init__">[docs]</a>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initializes a new instance of the Turbo class.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        **kwargs : dict, optional</span>
<span class="sd">            Additional keyword arguments for setting attributes.</span>
<span class="sd">            - strike (str): The strike price for the contract, default is &#39;+10.00&#39;.</span>
<span class="sd">            - payout_per_point (float): The payout per point, default is 2.</span>
<span class="sd">            - contract_type (str): The type of contract, either &#39;TURBOSLONG&#39; or &#39;TURBOSSHORT&#39;. Defaults to &#39;TURBOSLONG&#39; if &#39;long&#39; is in the contract type, otherwise &#39;TURBOSSHORT&#39;.</span>
<span class="sd">            - duration (int): The duration of the contract, default is 5.</span>
<span class="sd">            - duration_unit (str): The unit of the duration, default is &#39;m&#39;.</span>
<span class="sd">            - ver (str): The version of the Turbo, default is &#39;revamp&#39;.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">strike</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;strike&#39;</span><span class="p">,</span> <span class="s1">&#39;+10.00&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">payout_per_point</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;payout_per_point&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">contract_type</span> <span class="o">=</span> <span class="s1">&#39;TURBOSLONG&#39;</span> <span class="k">if</span> <span class="s1">&#39;long&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;contract_type&#39;</span><span class="p">,</span> <span class="s1">&#39;TURBOSLONG&#39;</span><span class="p">)</span> <span class="k">else</span> <span class="s1">&#39;TURBOSSHORT&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">duration</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;duration&#39;</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">duration_unit</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;duration_unit&#39;</span><span class="p">,</span> <span class="s1">&#39;m&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">version</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ver&#39;</span><span class="p">,</span> <span class="s1">&#39;revamp&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">user_input_params</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;stake&#39;</span><span class="p">,</span><span class="s1">&#39;symbol&#39;</span><span class="p">,</span><span class="s1">&#39;duration_unit&#39;</span><span class="p">,</span><span class="s1">&#39;duration&#39;</span><span class="p">]</span></div>

            
<div class="viewcode-block" id="Turbo.randomise_attributes">
<a class="viewcode-back" href="../index.html#mvapi.Turbo.randomise_attributes">[docs]</a>
    <span class="k">def</span> <span class="nf">randomise_attributes</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Randomises the attributes of the Turbo instance.</span>
<span class="sd">        </span>
<span class="sd">        The method randomly selects values for the symbol, duration unit, strike price,</span>
<span class="sd">        payout per point, contract type, and duration based on predefined ranges.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">symbol</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">symbols</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stake</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mf">0.1</span><span class="p">,</span> <span class="mi">2000</span><span class="p">),</span> <span class="n">BO</span><span class="p">[</span><span class="s1">&#39;currency_precision&#39;</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">currency</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">duration_unit</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">([</span><span class="s1">&#39;t&#39;</span><span class="p">,</span><span class="s1">&#39;s&#39;</span><span class="p">,</span><span class="s1">&#39;m&#39;</span><span class="p">,</span><span class="s1">&#39;h&#39;</span><span class="p">,</span><span class="s1">&#39;d&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">strike</span> <span class="o">=</span> <span class="s1">&#39;+10.00&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">payout_per_point</span> <span class="o">=</span> <span class="mf">2.00001</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">contract_type</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">([</span><span class="s1">&#39;TURBOSLONG&#39;</span><span class="p">,</span><span class="s1">&#39;TURBOSSHORT&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">duration</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">11</span><span class="p">)</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">duration_unit</span> <span class="o">==</span> <span class="s1">&#39;t&#39;</span> <span class="k">else</span>\
                        <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">86401</span><span class="p">)</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">duration_unit</span> <span class="o">==</span> <span class="s1">&#39;s&#39;</span> <span class="k">else</span>\
                        <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1441</span><span class="p">)</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">duration_unit</span> <span class="o">==</span> <span class="s1">&#39;m&#39;</span> <span class="k">else</span>\
                        <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">25</span><span class="p">)</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">duration_unit</span> <span class="o">==</span> <span class="s1">&#39;h&#39;</span> <span class="k">else</span>\
                        <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">365</span><span class="p">)</span> </div>

        
<div class="viewcode-block" id="Turbo._proposal">
<a class="viewcode-back" href="../index.html#mvapi.Turbo._proposal">[docs]</a>
    <span class="k">def</span> <span class="nf">_proposal</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Generates a proposal specific to the Turbo product.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        str</span>
<span class="sd">            A JSON string representing the proposal.</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        If the proposal type is &#39;price_proposal&#39;, the method constructs a proposal </span>
<span class="sd">        dictionary with the following keys:</span>
<span class="sd">        - proposal: int, set to 1.</span>
<span class="sd">        - amount: float, the stake amount.</span>
<span class="sd">        - basis: str, set to &#39;stake&#39;.</span>
<span class="sd">        - contract_type: str, the contract type, either &#39;TURBOSLONG&#39; or &#39;TURBOSSHORT&#39;.</span>
<span class="sd">        - currency: str, the currency of the contract.</span>
<span class="sd">        - symbol: str, the underlying symbol symbol.</span>
<span class="sd">        - duration: int, the contract duration.</span>
<span class="sd">        - duration_unit: str, the unit of the duration.</span>

<span class="sd">        Depending on the version attribute:</span>
<span class="sd">        - If &#39;revamp&#39;, adds &#39;payout_per_point&#39; to the proposal.</span>
<span class="sd">        - Otherwise, adds &#39;barrier&#39; to the proposal.</span>

<span class="sd">        If the proposal type is not &#39;price_proposal&#39;, it calls the parent class&#39;s `_proposal` method.</span>
<span class="sd">        &quot;&quot;&quot;</span>        
        <span class="n">proposal</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">proposal_type</span> <span class="o">==</span> <span class="s1">&#39;price_proposal&#39;</span><span class="p">:</span>
            <span class="n">proposal</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;proposal&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
                <span class="s2">&quot;amount&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">stake</span><span class="p">,</span>
                <span class="s2">&quot;basis&quot;</span><span class="p">:</span> <span class="s2">&quot;stake&quot;</span><span class="p">,</span>
                <span class="s2">&quot;contract_type&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">contract_type</span><span class="p">,</span>
                <span class="s2">&quot;currency&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">currency</span><span class="p">,</span>
                <span class="s2">&quot;symbol&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">symbol</span><span class="p">,</span>
                <span class="s1">&#39;duration&#39;</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">duration</span><span class="p">,</span>
                <span class="s1">&#39;duration_unit&#39;</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">duration_unit</span>
            <span class="p">}</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">version</span> <span class="o">==</span> <span class="s1">&#39;revamp&#39;</span><span class="p">:</span>
                <span class="n">proposal</span><span class="p">[</span><span class="s1">&#39;payout_per_point&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">payout_per_point</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">proposal</span><span class="p">[</span><span class="s1">&#39;barrier&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">strike</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">take_profit</span><span class="p">:</span>
                <span class="n">insert_dict</span><span class="p">(</span><span class="n">proposal</span><span class="p">,</span> <span class="s1">&#39;limit_order&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;take_profit&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">take_profit</span><span class="p">})</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">stop_loss</span><span class="p">:</span>
                <span class="n">insert_dict</span><span class="p">(</span><span class="n">proposal</span><span class="p">,</span> <span class="s1">&#39;limit_order&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;stop_loss&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">stop_loss</span><span class="p">})</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">_proposal</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">proposal</span><span class="p">)</span></div>


<div class="viewcode-block" id="Turbo.get_start_of_min_tick">
<a class="viewcode-back" href="../index.html#mvapi.Turbo.get_start_of_min_tick">[docs]</a>
    <span class="k">def</span> <span class="nf">get_start_of_min_tick</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">prop</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Retrieves the spot price at the start of the the minute </span>
<span class="sd">        based on the entry tick for the given proposal.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        prop : dict</span>
<span class="sd">            A dictionary representing the proposal. It must contain the following keys:</span>
<span class="sd">            - &#39;proposal&#39;: dict, containing &#39;date_start&#39;.</span>
<span class="sd">            - &#39;echo_req&#39;: dict, containing &#39;symbol&#39;.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        float</span>
<span class="sd">            The spot price at the start of the the minute.</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        The method calculates the start of the minute based on the &#39;date_start&#39; timestamp</span>
<span class="sd">        from the proposal. It then retrieves the tick history up to the start of the minute</span>
<span class="sd">        and returns the last price in the history.</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; turbo = Turbo()</span>
<span class="sd">        &gt;&gt;&gt; prop = {</span>
<span class="sd">        ...     &#39;proposal&#39;: {&#39;date_start&#39;: 1625140800},</span>
<span class="sd">        ...     &#39;echo_req&#39;: {&#39;symbol&#39;: &#39;R_100&#39;}</span>
<span class="sd">        ... }</span>
<span class="sd">        &gt;&gt;&gt; turbo.get_start_of_min_tick(prop)</span>
<span class="sd">        123.45</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">cur_time</span> <span class="o">=</span> <span class="n">prop</span><span class="p">[</span><span class="s1">&#39;proposal&#39;</span><span class="p">][</span><span class="s1">&#39;date_start&#39;</span><span class="p">]</span>
        <span class="n">start_of_min</span> <span class="o">=</span> <span class="n">cur_time</span> <span class="o">-</span> <span class="n">cur_time</span><span class="o">%</span><span class="mi">60</span>
        <span class="c1"># time.sleep(0.5)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">tick_history</span><span class="p">(</span><span class="n">symbol</span><span class="o">=</span><span class="n">prop</span><span class="p">[</span><span class="s1">&#39;echo_req&#39;</span><span class="p">][</span><span class="s1">&#39;symbol&#39;</span><span class="p">],</span> <span class="n">end</span><span class="o">=</span><span class="n">start_of_min</span><span class="p">)[</span><span class="s1">&#39;history&#39;</span><span class="p">][</span><span class="s1">&#39;prices&#39;</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span></div>

            
<div class="viewcode-block" id="Turbo.check_ppps">
<a class="viewcode-back" href="../index.html#mvapi.Turbo.check_ppps">[docs]</a>
    <span class="k">def</span> <span class="nf">check_ppps</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">runs</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">show</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Checks the offered payout per point (PPP) choices for all proposals and additional runs for the Turbo product.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        runs : int, optional</span>
<span class="sd">            The number of runs to perform for checking PPP choices (default is 0).</span>
<span class="sd">        show : bool, optional</span>
<span class="sd">            Whether to display the proposals with failed PPP checks (default is False).</span>
<span class="sd">        **kwargs : dict, optional</span>
<span class="sd">            Additional keyword arguments to set attributes for the Turbo product.</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        This method performs the following steps:</span>
<span class="sd">        1. Randomizes the attributes and sets them.</span>
<span class="sd">        2. Generates price proposals and collects messages.</span>
<span class="sd">        3. Checks the PPP choices for each proposal.</span>
<span class="sd">        4. Updates the statistics for PPP choices.</span>

<span class="sd">        If `show` is True, it displays the proposals with failed PPP checks.</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; turbo = mv.Turbo()</span>
<span class="sd">        &gt;&gt;&gt; turbo.check_ppps(runs=5, show=True)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">runs</span><span class="p">):</span>
            <span class="c1"># time.sleep(0.71)</span>
            <span class="n">clear_output</span><span class="p">(</span><span class="n">wait</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">randomise_attributes</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_set_attributes</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">price_proposal</span><span class="p">()</span>
        <span class="n">clear_output</span><span class="p">(</span><span class="n">wait</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stats</span><span class="p">[</span><span class="s1">&#39;ppp_choices_stats&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;cases&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;pass&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;fail&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">}</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">messages</span><span class="p">:</span>
            <span class="k">if</span> <span class="s1">&#39;msg_type&#39;</span> <span class="ow">in</span> <span class="n">item</span> <span class="ow">and</span> <span class="n">item</span><span class="p">[</span><span class="s1">&#39;msg_type&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;proposal&#39;</span> <span class="ow">and</span> <span class="s1">&#39;error&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">item</span> <span class="ow">and</span> <span class="s1">&#39;TURBO&#39;</span> <span class="ow">in</span> <span class="n">item</span><span class="p">[</span><span class="s1">&#39;echo_req&#39;</span><span class="p">][</span><span class="s1">&#39;contract_type&#39;</span><span class="p">]:</span>
                <span class="c1"># if &#39;mv&#39; not in item or (&#39;mv&#39; in item and &#39;ppp_choices_stats&#39; not in item[&#39;mv&#39;]): # some fixing needs to be done here to prevent lost of results.</span>
                <span class="n">display</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
                <span class="n">temp_dict</span> <span class="o">=</span> <span class="p">{}</span>
                <span class="n">start_of_min_spot</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_start_of_min_tick</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
                <span class="n">temp_dict</span><span class="p">[</span><span class="s1">&#39;payout_choices&#39;</span><span class="p">],</span> <span class="n">temp_dict</span><span class="p">[</span><span class="s1">&#39;barrier&#39;</span><span class="p">],</span> <span class="n">temp_dict</span><span class="p">[</span><span class="s1">&#39;ppp_choices_stats&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">turbo_ppps</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">start_of_min_spot</span><span class="p">)</span>
                <span class="n">insert_dict</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="s1">&#39;mv&#39;</span><span class="p">,</span> <span class="n">temp_dict</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">stats</span><span class="p">[</span><span class="s1">&#39;ppp_choices_stats&#39;</span><span class="p">][</span><span class="s1">&#39;cases&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="k">if</span> <span class="n">item</span><span class="p">[</span><span class="s1">&#39;mv&#39;</span><span class="p">][</span><span class="s1">&#39;ppp_choices_stats&#39;</span><span class="p">]:</span> 
                    <span class="bp">self</span><span class="o">.</span><span class="n">stats</span><span class="p">[</span><span class="s1">&#39;ppp_choices_stats&#39;</span><span class="p">][</span><span class="s1">&#39;pass&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="k">else</span><span class="p">:</span> 
                    <span class="bp">self</span><span class="o">.</span><span class="n">stats</span><span class="p">[</span><span class="s1">&#39;ppp_choices_stats&#39;</span><span class="p">][</span><span class="s1">&#39;fail&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="n">clear_output</span><span class="p">(</span><span class="n">wait</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">show</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">messages</span><span class="p">:</span>
                <span class="k">if</span> <span class="s1">&#39;msg_type&#39;</span> <span class="ow">in</span> <span class="n">item</span> <span class="ow">and</span> <span class="n">item</span><span class="p">[</span><span class="s1">&#39;msg_type&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;proposal&#39;</span> <span class="ow">and</span> <span class="s1">&#39;error&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">item</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">item</span><span class="p">[</span><span class="s1">&#39;mv&#39;</span><span class="p">][</span><span class="s1">&#39;ppp_choices_stats&#39;</span><span class="p">]:</span>
                    <span class="n">display</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>                     
        <span class="bp">self</span><span class="o">.</span><span class="n">stats_ppp_choices</span> <span class="o">=</span> <span class="n">dict_to_df</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stats</span><span class="p">[</span><span class="s1">&#39;ppp_choices_stats&#39;</span><span class="p">],</span> <span class="s1">&#39;PPP Choices&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">stats_ppp_choices</span></div>


<div class="viewcode-block" id="Turbo.check_payout">
<a class="viewcode-back" href="../index.html#mvapi.Turbo.check_payout">[docs]</a>
    <span class="k">def</span> <span class="nf">check_payout</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">runs</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">show</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Checks the payout for all POCs and additional runs for the Turbo product.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        runs : int, optional</span>
<span class="sd">            The number of runs to perform for checking payouts (default is 0).</span>
<span class="sd">        show : bool, optional</span>
<span class="sd">            Whether to display the POCs with failed payouts (default is False).</span>
<span class="sd">        **kwargs : dict, optional</span>
<span class="sd">            Additional keyword arguments to buy contracts.</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        This method performs the following steps:</span>
<span class="sd">        1. Buys contracts and collects messages.</span>
<span class="sd">        2. Retrieves all proposal open contracts (POCs).</span>
<span class="sd">        3. Checks the payout for each POC.</span>
<span class="sd">        4. Updates the statistics for payout checks.</span>

<span class="sd">        If `show` is True, it displays the proposals with failed payouts.</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; turbo = mv.Turbo()</span>
<span class="sd">        &gt;&gt;&gt; turbo.check_payout(runs=5, show=True)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">runs</span><span class="p">):</span>
            <span class="n">clear_output</span><span class="p">(</span><span class="n">wait</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">buy_contract</span><span class="p">(</span><span class="n">random</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_all_poc</span><span class="p">()</span>
        <span class="n">clear_output</span><span class="p">(</span><span class="n">wait</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stats</span><span class="p">[</span><span class="s1">&#39;payout_check&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;total&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;cases&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;pass&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;fail&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">},</span>
            <span class="s1">&#39;ko&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;cases&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;pass&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;fail&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">},</span>
            <span class="s1">&#39;expired&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;cases&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;pass&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;fail&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">},</span>
            <span class="s1">&#39;sold&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;cases&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;pass&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;fail&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">},</span>
            <span class="s1">&#39;bid&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;cases&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;pass&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;fail&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">}</span>
        <span class="p">}</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">messages</span><span class="p">:</span>
            <span class="k">if</span> <span class="s1">&#39;msg_type&#39;</span> <span class="ow">in</span> <span class="n">item</span> <span class="ow">and</span> <span class="n">item</span><span class="p">[</span><span class="s1">&#39;msg_type&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;proposal_open_contract&#39;</span> <span class="ow">and</span> <span class="s1">&#39;error&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">item</span> <span class="ow">and</span> <span class="s1">&#39;TURBO&#39;</span> <span class="ow">in</span> <span class="n">item</span><span class="p">[</span><span class="s1">&#39;proposal_open_contract&#39;</span><span class="p">][</span><span class="s1">&#39;contract_type&#39;</span><span class="p">]:</span>
                <span class="n">temp_dict</span> <span class="o">=</span> <span class="p">{}</span>
                <span class="n">temp_dict</span><span class="p">[</span><span class="s1">&#39;payout&#39;</span><span class="p">],</span> <span class="n">temp_dict</span><span class="p">[</span><span class="s1">&#39;payout_check&#39;</span><span class="p">],</span> <span class="n">temp_dict</span><span class="p">[</span><span class="s1">&#39;close_flag&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">turbo_payout</span><span class="p">(</span><span class="n">item</span><span class="p">)</span> 
                <span class="n">insert_dict</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="s1">&#39;mv&#39;</span><span class="p">,</span> <span class="n">temp_dict</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">stats</span><span class="p">[</span><span class="s1">&#39;payout_check&#39;</span><span class="p">][</span><span class="n">temp_dict</span><span class="p">[</span><span class="s1">&#39;close_flag&#39;</span><span class="p">]][</span><span class="s1">&#39;cases&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">stats</span><span class="p">[</span><span class="s1">&#39;payout_check&#39;</span><span class="p">][</span><span class="s1">&#39;total&#39;</span><span class="p">][</span><span class="s1">&#39;cases&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="k">if</span> <span class="n">item</span><span class="p">[</span><span class="s1">&#39;mv&#39;</span><span class="p">][</span><span class="s1">&#39;payout_check&#39;</span><span class="p">]:</span> 
                    <span class="bp">self</span><span class="o">.</span><span class="n">stats</span><span class="p">[</span><span class="s1">&#39;payout_check&#39;</span><span class="p">][</span><span class="n">temp_dict</span><span class="p">[</span><span class="s1">&#39;close_flag&#39;</span><span class="p">]][</span><span class="s1">&#39;pass&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">stats</span><span class="p">[</span><span class="s1">&#39;payout_check&#39;</span><span class="p">][</span><span class="s1">&#39;total&#39;</span><span class="p">][</span><span class="s1">&#39;pass&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="k">else</span><span class="p">:</span> 
                    <span class="bp">self</span><span class="o">.</span><span class="n">stats</span><span class="p">[</span><span class="s1">&#39;payout_check&#39;</span><span class="p">][</span><span class="n">temp_dict</span><span class="p">[</span><span class="s1">&#39;close_flag&#39;</span><span class="p">]][</span><span class="s1">&#39;fail&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>  
                    <span class="bp">self</span><span class="o">.</span><span class="n">stats</span><span class="p">[</span><span class="s1">&#39;payout_check&#39;</span><span class="p">][</span><span class="s1">&#39;total&#39;</span><span class="p">][</span><span class="s1">&#39;fail&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">item</span><span class="p">[</span><span class="s1">&#39;mv&#39;</span><span class="p">][</span><span class="s1">&#39;payout_check&#39;</span><span class="p">]</span> <span class="ow">and</span> <span class="n">show</span><span class="p">:</span>
                    <span class="n">display</span><span class="p">(</span><span class="n">item</span><span class="p">)</span> 
        <span class="bp">self</span><span class="o">.</span><span class="n">stats_payout</span> <span class="o">=</span> <span class="n">dict_to_df</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stats</span><span class="p">[</span><span class="s1">&#39;payout_check&#39;</span><span class="p">],</span> <span class="s1">&#39;Payout&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">stats_payout</span></div>
</div>


<div class="viewcode-block" id="risefall_bid">
<a class="viewcode-back" href="../index.html#mvapi.risefall_bid">[docs]</a>
<span class="k">def</span> <span class="nf">risefall_bid</span><span class="p">(</span><span class="n">prop</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculates the bid price for a Rise/Fall contract.</span>

<span class="sd">    This function computes the expected bid price for a Rise/Fall contract </span>
<span class="sd">    using step-index logic for binary outcomes or the Black-Scholes pricing model for continuous outcomes.</span>
<span class="sd">    It compares the calculated bid price with the API-provided value and categorizes the contract&#39;s status.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    prop : dict</span>
<span class="sd">        The contract data containing information such as the barrier, underlying spot price, contract type,</span>
<span class="sd">        duration, and payout.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    tuple</span>
<span class="sd">        A tuple containing:</span>
<span class="sd">        - bid (float): The computed bid price.</span>
<span class="sd">        - match_flag (bool): True if the computed bid matches the API-provided bid price, otherwise False.</span>
<span class="sd">        - close_flag (str): Indicates the closure state of the contract (&#39;expired&#39;, &#39;sold&#39;, or &#39;bid&#39;).</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    - For step-index contracts (`stp` in the symbol), a probabilistic calculation </span>
<span class="sd">      involving Beta distribution is applied.</span>
<span class="sd">    - For non-step contracts, the bid price is calculated using a modified </span>
<span class="sd">      Black-Scholes formula adjusted for commission.</span>
<span class="sd">    - Bid adjustments are applied based on contract status (e.g., `expired`).</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; prop = {</span>
<span class="sd">    ...     &#39;proposal_open_contract&#39;: {</span>
<span class="sd">    ...         &#39;current_spot_time&#39;: 1657000000,</span>
<span class="sd">    ...         &#39;date_expiry&#39;: 1657000100,</span>
<span class="sd">    ...         &#39;barrier&#39;: 105.0,</span>
<span class="sd">    ...         &#39;underlying&#39;: &#39;R_100&#39;,</span>
<span class="sd">    ...         &#39;contract_type&#39;: &#39;CALL&#39;,</span>
<span class="sd">    ...         &#39;bid_price&#39;: 12.5,</span>
<span class="sd">    ...         &#39;payout&#39;: 100,</span>
<span class="sd">    ...         &#39;current_spot&#39;: 104.0</span>
<span class="sd">    ...     }</span>
<span class="sd">    ... }</span>
<span class="sd">    &gt;&gt;&gt; bid, match_flag, close_flag = risefall_bid(prop)</span>
<span class="sd">    &gt;&gt;&gt; print(bid, match_flag, close_flag)</span>
<span class="sd">    12.34 True &#39;bid&#39;</span>
<span class="sd">    &quot;&quot;&quot;</span>    
    <span class="n">duration</span> <span class="o">=</span> <span class="p">[</span><span class="n">prop</span><span class="p">[</span><span class="s1">&#39;proposal_open_contract&#39;</span><span class="p">][</span><span class="s1">&#39;current_spot_time&#39;</span><span class="p">],</span> <span class="n">prop</span><span class="p">[</span><span class="s1">&#39;proposal_open_contract&#39;</span><span class="p">][</span><span class="s1">&#39;date_expiry&#39;</span><span class="p">]]</span>
    <span class="n">n</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">duration</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">-</span> <span class="nb">int</span><span class="p">(</span><span class="n">duration</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="k">if</span> <span class="s1">&#39;tick&#39;</span> <span class="ow">in</span> <span class="n">prop</span><span class="p">[</span><span class="s1">&#39;proposal_open_contract&#39;</span><span class="p">][</span><span class="s1">&#39;longcode&#39;</span><span class="p">]:</span>
        <span class="n">n</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;\d+&#39;</span><span class="p">,</span> <span class="n">prop</span><span class="p">[</span><span class="s1">&#39;proposal_open_contract&#39;</span><span class="p">][</span><span class="s1">&#39;longcode&#39;</span><span class="p">])))[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="p">(</span><span class="n">prop</span><span class="p">[</span><span class="s1">&#39;proposal_open_contract&#39;</span><span class="p">][</span><span class="s1">&#39;current_spot_time&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">prop</span><span class="p">[</span><span class="s1">&#39;proposal_open_contract&#39;</span><span class="p">][</span><span class="s1">&#39;entry_tick_time&#39;</span><span class="p">])</span>
    <span class="n">t</span> <span class="o">=</span> <span class="n">n</span><span class="o">/</span><span class="mi">365</span><span class="o">/</span><span class="mi">86400</span>   
    <span class="n">allow_equal</span> <span class="o">=</span> <span class="mi">1</span> <span class="k">if</span> <span class="s1">&#39;E&#39;</span> <span class="ow">in</span> <span class="n">prop</span><span class="p">[</span><span class="s1">&#39;proposal_open_contract&#39;</span><span class="p">][</span><span class="s1">&#39;contract_type&#39;</span><span class="p">]</span> <span class="k">else</span> <span class="mi">0</span>
    
    <span class="c1"># here is adjustment for be sus bid</span>
    <span class="n">n</span><span class="o">-=</span><span class="mi">1</span>
    <span class="n">allow_equal</span> <span class="o">=</span> <span class="mi">0</span> <span class="k">if</span> <span class="n">allow_equal</span> <span class="k">else</span> <span class="mi">1</span>

    <span class="n">symbol</span> <span class="o">=</span> <span class="n">prop</span><span class="p">[</span><span class="s1">&#39;proposal_open_contract&#39;</span><span class="p">][</span><span class="s1">&#39;underlying&#39;</span><span class="p">]</span>
    <span class="n">contract_type</span> <span class="o">=</span> <span class="n">prop</span><span class="p">[</span><span class="s1">&#39;proposal_open_contract&#39;</span><span class="p">][</span><span class="s1">&#39;contract_type&#39;</span><span class="p">]</span>
    <span class="n">phi</span> <span class="o">=</span> <span class="mi">1</span> <span class="k">if</span> <span class="s1">&#39;C&#39;</span> <span class="ow">in</span> <span class="n">contract_type</span> <span class="k">else</span> <span class="o">-</span><span class="mi">1</span>
    <span class="n">is_step</span> <span class="o">=</span> <span class="mi">1</span> <span class="k">if</span> <span class="s1">&#39;stp&#39;</span> <span class="ow">in</span> <span class="n">symbol</span> <span class="k">else</span> <span class="mi">0</span> 
    <span class="n">is_sold</span> <span class="o">=</span> <span class="n">prop</span><span class="p">[</span><span class="s1">&#39;proposal_open_contract&#39;</span><span class="p">][</span><span class="s1">&#39;is_sold&#39;</span><span class="p">]</span>
    <span class="k">if</span> <span class="s1">&#39;exit_tick&#39;</span> <span class="ow">in</span> <span class="n">prop</span><span class="p">[</span><span class="s1">&#39;proposal_open_contract&#39;</span><span class="p">]</span> <span class="ow">and</span> <span class="n">prop</span><span class="p">[</span><span class="s1">&#39;proposal_open_contract&#39;</span><span class="p">][</span><span class="s1">&#39;exit_tick_time&#39;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">prop</span><span class="p">[</span><span class="s1">&#39;proposal_open_contract&#39;</span><span class="p">][</span><span class="s1">&#39;date_expiry&#39;</span><span class="p">]:</span>
        <span class="n">expired</span> <span class="o">=</span> <span class="mi">1</span> 
    <span class="k">else</span><span class="p">:</span> <span class="n">expired</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">spot</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">prop</span><span class="p">[</span><span class="s1">&#39;proposal_open_contract&#39;</span><span class="p">][</span><span class="s1">&#39;exit_tick&#39;</span><span class="p">])</span>     
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">spot</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">prop</span><span class="p">[</span><span class="s1">&#39;proposal_open_contract&#39;</span><span class="p">][</span><span class="s1">&#39;current_spot&#39;</span><span class="p">])</span>      
    <span class="n">barrier</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">prop</span><span class="p">[</span><span class="s1">&#39;proposal_open_contract&#39;</span><span class="p">][</span><span class="s1">&#39;barrier&#39;</span><span class="p">])</span>
    <span class="n">stake</span> <span class="o">=</span> <span class="n">get_stake</span><span class="p">(</span><span class="n">prop</span><span class="p">)</span>
    <span class="n">bid_api</span> <span class="o">=</span> <span class="n">prop</span><span class="p">[</span><span class="s1">&#39;proposal_open_contract&#39;</span><span class="p">][</span><span class="s1">&#39;bid_price&#39;</span><span class="p">]</span>
    <span class="n">payout_api</span> <span class="o">=</span> <span class="n">prop</span><span class="p">[</span><span class="s1">&#39;proposal_open_contract&#39;</span><span class="p">][</span><span class="s1">&#39;payout&#39;</span><span class="p">]</span>
    <span class="n">commission</span> <span class="o">=</span> <span class="n">BO</span><span class="p">[</span><span class="s1">&#39;risefall&#39;</span><span class="p">][</span><span class="s1">&#39;commission&#39;</span><span class="p">][</span><span class="n">symbol</span><span class="p">][</span><span class="s1">&#39;tick&#39;</span> <span class="k">if</span> <span class="s1">&#39;T&#39;</span> <span class="ow">in</span> <span class="n">prop</span><span class="p">[</span><span class="s1">&#39;proposal_open_contract&#39;</span><span class="p">][</span><span class="s1">&#39;shortcode&#39;</span><span class="p">][</span><span class="mi">4</span><span class="p">:]</span> <span class="k">else</span> <span class="s1">&#39;second&#39;</span><span class="p">]</span>
    <span class="n">commission</span> <span class="o">/=</span> <span class="mi">100</span>
    <span class="k">if</span> <span class="n">is_step</span><span class="p">:</span>
        <span class="n">phi</span> <span class="o">=</span> <span class="mi">1</span> <span class="k">if</span> <span class="s2">&quot;CALL&quot;</span> <span class="ow">in</span> <span class="n">contract_type</span> <span class="k">else</span> <span class="o">-</span><span class="mi">1</span>
        <span class="n">strike_dist</span> <span class="o">=</span> <span class="p">(</span><span class="n">barrier</span><span class="o">-</span><span class="n">spot</span><span class="p">)</span><span class="o">/</span><span class="n">symbols</span><span class="p">[</span><span class="n">symbol</span><span class="p">][</span><span class="s1">&#39;step_size&#39;</span><span class="p">]</span>
        <span class="n">strike_dist</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">strike_dist</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">strike_dist</span><span class="p">,</span> <span class="n">barrier</span><span class="p">,</span> <span class="n">spot</span><span class="p">,</span> <span class="n">symbols</span><span class="p">[</span><span class="n">symbol</span><span class="p">][</span><span class="s1">&#39;step_size&#39;</span><span class="p">])</span>
        <span class="c1"># print(strike_dist)</span>
        <span class="n">k</span> <span class="o">=</span> <span class="mi">0</span> 
        <span class="n">p</span> <span class="o">=</span> <span class="mf">0.5</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">n</span><span class="o">+</span><span class="n">strike_dist</span><span class="p">)</span> <span class="o">%</span> <span class="mi">2</span><span class="p">:</span> <span class="c1">#odd</span>
            <span class="n">k</span> <span class="o">=</span> <span class="p">(</span><span class="n">n</span><span class="o">+</span><span class="n">strike_dist</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span> <span class="c1"># k greater</span>
            <span class="n">greater</span> <span class="o">=</span> <span class="n">betainc</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">n</span> <span class="o">-</span> <span class="n">k</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span>
            <span class="n">greater_equal</span> <span class="o">=</span> <span class="n">greater</span>
            <span class="n">equal</span> <span class="o">=</span> <span class="mi">0</span> 
        <span class="k">else</span><span class="p">:</span> <span class="c1">#even</span>
            <span class="n">k</span> <span class="o">=</span> <span class="p">(</span><span class="n">n</span><span class="o">+</span><span class="n">strike_dist</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span>
            <span class="n">greater</span> <span class="o">=</span> <span class="n">betainc</span><span class="p">(</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">n</span> <span class="o">-</span> <span class="p">(</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span>
            <span class="n">greater_equal</span> <span class="o">=</span> <span class="n">betainc</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">n</span> <span class="o">-</span> <span class="p">(</span><span class="n">k</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span>
            <span class="n">equal</span> <span class="o">=</span> <span class="n">greater_equal</span> <span class="o">-</span> <span class="n">greater</span>
        <span class="n">smaller</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">greater_equal</span>
        <span class="k">if</span> <span class="n">allow_equal</span><span class="p">:</span> 
            <span class="n">unit_price_bid</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">greater_equal</span><span class="p">,</span><span class="mi">4</span><span class="p">)</span> <span class="k">if</span> <span class="n">phi</span><span class="o">==</span><span class="mi">1</span> <span class="k">else</span> <span class="nb">round</span><span class="p">(</span><span class="n">smaller</span> <span class="o">+</span> <span class="n">equal</span><span class="p">,</span><span class="mi">4</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">unit_price_bid</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">greater</span><span class="p">,</span><span class="mi">4</span><span class="p">)</span> <span class="k">if</span> <span class="n">phi</span><span class="o">==</span><span class="mi">1</span> <span class="k">else</span> <span class="nb">round</span><span class="p">(</span><span class="n">smaller</span><span class="p">,</span><span class="mi">4</span><span class="p">)</span>
        <span class="n">unit_price_bid</span> <span class="o">-=</span> <span class="n">commission</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">sigma</span> <span class="o">=</span> <span class="n">get_sigma</span><span class="p">(</span><span class="n">symbol</span><span class="p">)</span>
        <span class="n">d1</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">spot</span><span class="o">/</span><span class="n">barrier</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">sigma</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="n">t</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">sigma</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">t</span><span class="p">))</span>
        <span class="n">d2</span> <span class="o">=</span> <span class="p">(</span><span class="n">d1</span> <span class="o">-</span> <span class="n">sigma</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">t</span><span class="p">))</span>
        <span class="n">unit_price_bid</span> <span class="o">=</span> <span class="n">norm</span><span class="o">.</span><span class="n">cdf</span><span class="p">(</span><span class="n">phi</span> <span class="o">*</span><span class="n">d2</span><span class="p">)</span> <span class="o">-</span> <span class="n">commission</span>
    <span class="n">bid</span> <span class="o">=</span> <span class="n">payout_api</span> <span class="o">*</span> <span class="n">unit_price_bid</span>
    <span class="k">if</span> <span class="n">expired</span><span class="p">:</span> 
        <span class="k">match</span> <span class="n">contract_type</span><span class="p">:</span>
            <span class="k">case</span> <span class="s1">&#39;CALL&#39;</span><span class="p">:</span>
                <span class="n">bid</span> <span class="o">=</span> <span class="n">payout_api</span> <span class="k">if</span> <span class="n">spot</span> <span class="o">&gt;</span> <span class="n">barrier</span> <span class="k">else</span> <span class="mi">0</span>
            <span class="k">case</span> <span class="s1">&#39;CALLE&#39;</span><span class="p">:</span>
                <span class="n">bid</span> <span class="o">=</span> <span class="n">payout_api</span> <span class="k">if</span> <span class="n">spot</span> <span class="o">&gt;=</span> <span class="n">barrier</span> <span class="k">else</span> <span class="mi">0</span>
            <span class="k">case</span> <span class="s1">&#39;PUT&#39;</span><span class="p">:</span>
                <span class="n">bid</span> <span class="o">=</span> <span class="n">payout_api</span> <span class="k">if</span> <span class="n">spot</span> <span class="o">&lt;</span> <span class="n">barrier</span> <span class="k">else</span> <span class="mi">0</span>
            <span class="k">case</span> <span class="s1">&#39;PUTE&#39;</span><span class="p">:</span>
                <span class="n">bid</span> <span class="o">=</span> <span class="n">payout_api</span> <span class="k">if</span> <span class="n">spot</span> <span class="o">&lt;=</span> <span class="n">barrier</span> <span class="k">else</span> <span class="mi">0</span>            
    <span class="c1"># print(unit_price_bid)</span>
    <span class="c1"># print(norm.cdf(phi *d2),unit_price_bid, phi, contract_type, commission)</span>
    <span class="n">close_flag</span> <span class="o">=</span> <span class="s1">&#39;expired&#39;</span> <span class="k">if</span> <span class="n">expired</span> <span class="k">else</span> <span class="s1">&#39;sold&#39;</span> <span class="k">if</span> <span class="n">is_sold</span> <span class="k">else</span> <span class="s1">&#39;bid&#39;</span>
    <span class="n">match_flag</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">bid</span><span class="p">,</span> <span class="n">get_currency_precision</span><span class="p">(</span><span class="n">prop</span><span class="p">)</span> <span class="p">)</span> <span class="o">==</span> <span class="n">bid_api</span>                
    <span class="k">return</span> <span class="n">bid</span><span class="p">,</span> <span class="n">match_flag</span><span class="p">,</span> <span class="n">close_flag</span></div>


<div class="viewcode-block" id="risefall_payout">
<a class="viewcode-back" href="../index.html#mvapi.risefall_payout">[docs]</a>
<span class="k">def</span> <span class="nf">risefall_payout</span> <span class="p">(</span><span class="n">prop</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculates the payout for a Rise/Fall contract and validates it.</span>

<span class="sd">    This function computes the expected payout for a Rise/Fall contract based on </span>
<span class="sd">    its attributes, such as the barrier, entry spot, and duration. It determines </span>
<span class="sd">    whether the computed payout matches the API-provided value and identifies the </span>
<span class="sd">    contract&#39;s status.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    prop : dict</span>
<span class="sd">        The Rise/Fall contract data containing details such as:</span>
<span class="sd">        - Barrier and spot prices.</span>
<span class="sd">        - Contract type (e.g., &quot;CALL&quot;, &quot;PUT&quot;).</span>
<span class="sd">        - Duration and time-related attributes.</span>
<span class="sd">        - Commission and payout information.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    tuple</span>
<span class="sd">        A tuple containing:</span>
<span class="sd">        - payout (float): The computed payout amount.</span>
<span class="sd">        - match_flag (bool): True if the computed payout matches the API-provided </span>
<span class="sd">          payout, otherwise False.</span>
<span class="sd">        - close_flag (str or bool): Indicates the status of the contract as `sold` </span>
<span class="sd">          or a payout comparison result.</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    - For step-index contracts, a probabilistic calculation based on Beta distribution </span>
<span class="sd">      is used to compute the payout.</span>
<span class="sd">    - For non-step contracts, the payout is calculated using a modified Black-Scholes </span>
<span class="sd">      pricing formula with adjustments for commission.</span>
<span class="sd">    - If the computed payout is less than the API-provided payout, a `True` flag is returned </span>
<span class="sd">      in place of the `close_flag`.</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; prop = {</span>
<span class="sd">    ...     &#39;proposal_open_contract&#39;: {</span>
<span class="sd">    ...         &#39;entry_tick_time&#39;: 1657000000,</span>
<span class="sd">    ...         &#39;date_expiry&#39;: 1657000100,</span>
<span class="sd">    ...         &#39;barrier&#39;: 105.0,</span>
<span class="sd">    ...         &#39;underlying&#39;: &#39;R_100&#39;,</span>
<span class="sd">    ...         &#39;contract_type&#39;: &#39;CALL&#39;,</span>
<span class="sd">    ...         &#39;shortcode&#39;: &#39;FR_tick&#39;,</span>
<span class="sd">    ...         &#39;entry_spot&#39;: 104.0,</span>
<span class="sd">    ...         &#39;payout&#39;: 100.0</span>
<span class="sd">    ...     }</span>
<span class="sd">    ... }</span>
<span class="sd">    &gt;&gt;&gt; payout, match_flag, close_flag = risefall_payout(prop)</span>
<span class="sd">    &gt;&gt;&gt; print(payout, match_flag, close_flag)</span>
<span class="sd">    95.2 True &#39;sold&#39;</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">duration</span> <span class="o">=</span> <span class="p">[</span><span class="n">prop</span><span class="p">[</span><span class="s1">&#39;proposal_open_contract&#39;</span><span class="p">][</span><span class="s1">&#39;entry_tick_time&#39;</span><span class="p">],</span> <span class="n">prop</span><span class="p">[</span><span class="s1">&#39;proposal_open_contract&#39;</span><span class="p">][</span><span class="s1">&#39;date_expiry&#39;</span><span class="p">]]</span>
    <span class="n">n</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">duration</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">-</span> <span class="nb">int</span><span class="p">(</span><span class="n">duration</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="c1"># - 1</span>
    <span class="c1"># print(&#39;t&#39;)</span>
    <span class="n">n</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;\d+&#39;</span><span class="p">,</span> <span class="n">prop</span><span class="p">[</span><span class="s1">&#39;proposal_open_contract&#39;</span><span class="p">][</span><span class="s1">&#39;longcode&#39;</span><span class="p">])))[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="k">if</span> <span class="s1">&#39;tick&#39;</span> <span class="ow">in</span> <span class="n">prop</span><span class="p">[</span><span class="s1">&#39;proposal_open_contract&#39;</span><span class="p">][</span><span class="s1">&#39;longcode&#39;</span><span class="p">]</span> <span class="k">else</span> <span class="n">n</span>
    <span class="n">t</span> <span class="o">=</span> <span class="n">n</span><span class="o">/</span><span class="mi">365</span><span class="o">/</span><span class="mi">86400</span>   
    <span class="n">allow_equal</span> <span class="o">=</span> <span class="mi">1</span> <span class="k">if</span> <span class="s1">&#39;E&#39;</span> <span class="ow">in</span> <span class="n">prop</span><span class="p">[</span><span class="s1">&#39;proposal_open_contract&#39;</span><span class="p">][</span><span class="s1">&#39;contract_type&#39;</span><span class="p">]</span> <span class="k">else</span> <span class="mi">0</span>
    <span class="n">symbol</span> <span class="o">=</span> <span class="n">prop</span><span class="p">[</span><span class="s1">&#39;proposal_open_contract&#39;</span><span class="p">][</span><span class="s1">&#39;underlying&#39;</span><span class="p">]</span>
    <span class="n">contract_type</span> <span class="o">=</span> <span class="n">prop</span><span class="p">[</span><span class="s1">&#39;proposal_open_contract&#39;</span><span class="p">][</span><span class="s1">&#39;contract_type&#39;</span><span class="p">]</span>
    <span class="n">phi</span> <span class="o">=</span> <span class="mi">1</span> <span class="k">if</span> <span class="s1">&#39;C&#39;</span> <span class="ow">in</span> <span class="n">contract_type</span> <span class="k">else</span> <span class="o">-</span><span class="mi">1</span>
    <span class="n">is_step</span> <span class="o">=</span> <span class="mi">1</span> <span class="k">if</span> <span class="s1">&#39;stp&#39;</span> <span class="ow">in</span> <span class="n">symbol</span> <span class="k">else</span> <span class="mi">0</span> 
    <span class="k">try</span><span class="p">:</span>
        <span class="n">spot</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">prop</span><span class="p">[</span><span class="s1">&#39;proposal_open_contract&#39;</span><span class="p">][</span><span class="s1">&#39;entry_spot&#39;</span><span class="p">])</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">spot</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">prop</span><span class="p">[</span><span class="s1">&#39;proposal_open_contract&#39;</span><span class="p">][</span><span class="s1">&#39;current_spot&#39;</span><span class="p">])</span>      
    <span class="k">try</span><span class="p">:</span>
        <span class="n">barrier</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">prop</span><span class="p">[</span><span class="s1">&#39;proposal_open_contract&#39;</span><span class="p">][</span><span class="s1">&#39;barrier&#39;</span><span class="p">])</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">barrier</span> <span class="o">=</span> <span class="n">spot</span>
    <span class="n">stake</span> <span class="o">=</span> <span class="n">get_stake</span><span class="p">(</span><span class="n">prop</span><span class="p">)</span>
    <span class="n">payout_api</span> <span class="o">=</span> <span class="n">prop</span><span class="p">[</span><span class="s1">&#39;proposal_open_contract&#39;</span><span class="p">][</span><span class="s1">&#39;payout&#39;</span><span class="p">]</span>
    <span class="n">commission</span> <span class="o">=</span> <span class="n">BO</span><span class="p">[</span><span class="s1">&#39;risefall&#39;</span><span class="p">][</span><span class="s1">&#39;commission&#39;</span><span class="p">][</span><span class="n">symbol</span><span class="p">][</span><span class="s1">&#39;tick&#39;</span> <span class="k">if</span> <span class="s1">&#39;T&#39;</span> <span class="ow">in</span> <span class="n">prop</span><span class="p">[</span><span class="s1">&#39;proposal_open_contract&#39;</span><span class="p">][</span><span class="s1">&#39;shortcode&#39;</span><span class="p">][</span><span class="mi">4</span><span class="p">:]</span> <span class="k">else</span> <span class="s1">&#39;second&#39;</span><span class="p">]</span>
    <span class="n">commission</span> <span class="o">/=</span> <span class="mi">100</span>
    <span class="k">if</span> <span class="n">is_step</span><span class="p">:</span>
        <span class="n">phi</span> <span class="o">=</span> <span class="mi">1</span> <span class="k">if</span> <span class="s2">&quot;CALL&quot;</span> <span class="ow">in</span> <span class="n">contract_type</span> <span class="k">else</span> <span class="o">-</span><span class="mi">1</span>
        <span class="n">strike_dist</span> <span class="o">=</span> <span class="nb">round</span><span class="p">((</span><span class="n">barrier</span><span class="o">-</span><span class="n">spot</span><span class="p">)</span><span class="o">/</span><span class="n">symbols</span><span class="p">[</span><span class="n">symbol</span><span class="p">][</span><span class="s1">&#39;step_size&#39;</span><span class="p">])</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">barrier</span><span class="p">,</span> <span class="n">spot</span><span class="p">,</span> <span class="n">symbols</span><span class="p">[</span><span class="n">symbol</span><span class="p">][</span><span class="s1">&#39;step_size&#39;</span><span class="p">],</span> <span class="n">strike_dist</span><span class="p">,</span><span class="n">n</span><span class="p">)</span>
        <span class="c1"># print(strike_dist)</span>
        <span class="n">k</span> <span class="o">=</span> <span class="mi">0</span> 
        <span class="n">p</span> <span class="o">=</span> <span class="mf">0.5</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">n</span><span class="o">+</span><span class="n">strike_dist</span><span class="p">)</span> <span class="o">%</span> <span class="mi">2</span><span class="p">:</span> <span class="c1">#odd</span>
            <span class="n">k</span> <span class="o">=</span> <span class="p">(</span><span class="n">n</span><span class="o">+</span><span class="n">strike_dist</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span> <span class="c1"># k greater</span>
            <span class="c1"># print(k)</span>
            <span class="n">greater</span> <span class="o">=</span> <span class="n">betainc</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">n</span> <span class="o">-</span> <span class="n">k</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span>
            <span class="n">greater_equal</span> <span class="o">=</span> <span class="n">greater</span>
            <span class="n">equal</span> <span class="o">=</span> <span class="mi">0</span> 
        <span class="k">else</span><span class="p">:</span> <span class="c1">#even</span>
            <span class="n">k</span> <span class="o">=</span> <span class="p">(</span><span class="n">n</span><span class="o">+</span><span class="n">strike_dist</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
            <span class="n">greater</span> <span class="o">=</span> <span class="n">betainc</span><span class="p">(</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">n</span> <span class="o">-</span> <span class="p">(</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span>
            <span class="n">greater_equal</span> <span class="o">=</span> <span class="n">betainc</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">n</span> <span class="o">-</span> <span class="p">(</span><span class="n">k</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span>
            <span class="n">equal</span> <span class="o">=</span> <span class="n">greater_equal</span> <span class="o">-</span> <span class="n">greater</span>
        <span class="n">smaller</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">greater_equal</span>
        <span class="k">if</span> <span class="n">allow_equal</span><span class="p">:</span> 
            <span class="n">unit_price_ask</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">greater_equal</span><span class="p">,</span><span class="mi">4</span><span class="p">)</span> <span class="k">if</span> <span class="n">phi</span><span class="o">==</span><span class="mi">1</span> <span class="k">else</span> <span class="nb">round</span><span class="p">(</span><span class="n">smaller</span> <span class="o">+</span> <span class="n">equal</span><span class="p">,</span><span class="mi">4</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">unit_price_ask</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">greater</span><span class="p">,</span><span class="mi">4</span><span class="p">)</span> <span class="k">if</span> <span class="n">phi</span><span class="o">==</span><span class="mi">1</span> <span class="k">else</span> <span class="nb">round</span><span class="p">(</span><span class="n">smaller</span><span class="p">,</span><span class="mi">4</span><span class="p">)</span>
        <span class="n">unit_price_ask</span> <span class="o">+=</span> <span class="n">commission</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">sigma</span> <span class="o">=</span> <span class="n">get_sigma</span><span class="p">(</span><span class="n">symbol</span><span class="p">)</span>
        <span class="n">d1</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">spot</span><span class="o">/</span><span class="n">barrier</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">sigma</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="n">t</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">sigma</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">t</span><span class="p">))</span>
        <span class="n">d2</span> <span class="o">=</span> <span class="p">(</span><span class="n">d1</span> <span class="o">-</span> <span class="n">sigma</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">t</span><span class="p">))</span>
        <span class="n">unit_price_ask</span> <span class="o">=</span> <span class="n">norm</span><span class="o">.</span><span class="n">cdf</span><span class="p">(</span><span class="n">phi</span> <span class="o">*</span><span class="n">d2</span><span class="p">)</span> <span class="o">+</span> <span class="n">commission</span>
    <span class="n">payout</span> <span class="o">=</span> <span class="n">stake</span><span class="o">/</span><span class="n">unit_price_ask</span>
    <span class="c1"># print(unit_price_ask)</span>
    <span class="c1"># print(allow_equal,unit_price_ask, phi, contract_type, commission)</span>
    <span class="n">match_flag</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">payout</span><span class="p">,</span> <span class="n">BO</span><span class="p">[</span><span class="s1">&#39;currency_precision&#39;</span><span class="p">][</span><span class="n">prop</span><span class="p">[</span><span class="s1">&#39;proposal_open_contract&#39;</span><span class="p">][</span><span class="s1">&#39;currency&#39;</span><span class="p">]]</span> <span class="p">)</span> <span class="o">==</span> <span class="n">payout_api</span>
    <span class="n">close_flag</span> <span class="o">=</span> <span class="s1">&#39;sold&#39;</span>
    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">payout</span><span class="p">,</span> <span class="n">BO</span><span class="p">[</span><span class="s1">&#39;currency_precision&#39;</span><span class="p">][</span><span class="n">prop</span><span class="p">[</span><span class="s1">&#39;proposal_open_contract&#39;</span><span class="p">][</span><span class="s1">&#39;currency&#39;</span><span class="p">]]</span> <span class="p">)</span> <span class="o">&lt;</span> <span class="n">payout_api</span><span class="p">:</span>
        <span class="n">close_flag</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="k">return</span> <span class="n">payout</span><span class="p">,</span> <span class="n">match_flag</span><span class="p">,</span> <span class="n">close_flag</span></div>


<div class="viewcode-block" id="RiseFall">
<a class="viewcode-back" href="../index.html#mvapi.RiseFall">[docs]</a>
<span class="k">class</span> <span class="nc">RiseFall</span><span class="p">(</span><span class="n">Product</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A class to represent a Rise/Fall contract, inheriting from the Product class.</span>

<span class="sd">    This class handles Rise/Fall contract-specific attributes, generating proposals, </span>
<span class="sd">    and validating metrics such as bid prices and payout accuracy.</span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">    species : str</span>
<span class="sd">        The type of the product, always &#39;RiseFall&#39;.</span>
<span class="sd">    contract_type : str</span>
<span class="sd">        The type of Rise/Fall contract (e.g., &#39;CALL&#39;, &#39;PUT&#39;), default is &#39;CALL&#39;.</span>
<span class="sd">    stake_type : str</span>
<span class="sd">        Determines whether calculation basis is &#39;stake&#39; or &#39;payout&#39;. Default is &#39;stake&#39;.</span>
<span class="sd">    payout : float</span>
<span class="sd">        Default payout value if calculations depend on it.</span>
<span class="sd">    duration : int</span>
<span class="sd">        Duration of the contract in time units (default is 5).</span>
<span class="sd">    duration_unit : str</span>
<span class="sd">        The time unit for the duration (e.g., &#39;t&#39; for ticks, &#39;s&#39; for seconds, etc.). Default is &#39;m&#39;.</span>
<span class="sd">    user_input_params : list</span>
<span class="sd">        List of customizable parameters for the Rise/Fall contract.</span>
<span class="sd">    is_step : bool</span>
<span class="sd">        Specifies whether the symbol is &#39;step-index&#39;. Default is False.</span>

<span class="sd">    Methods</span>
<span class="sd">    -------</span>
<span class="sd">    randomise_attributes()</span>
<span class="sd">        Randomizes key contract attributes such as duration, symbol, stake, etc.</span>
<span class="sd">    _proposal()</span>
<span class="sd">        Generates a JSON-encoded proposal based on the instance&#39;s attributes.</span>
<span class="sd">    check_bid(runs=0, show=False, **kwargs)</span>
<span class="sd">        Validates bid price accuracy by calculating expected values for all proposals.</span>
<span class="sd">    check_payout(runs=0, show=False, **kwargs)</span>
<span class="sd">        Validates payout correctness for all previously saved proposals.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="n">species</span> <span class="o">=</span> <span class="s2">&quot;RiseFall&quot;</span>
    
<div class="viewcode-block" id="RiseFall.__init__">
<a class="viewcode-back" href="../index.html#mvapi.RiseFall.__init__">[docs]</a>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initializes a Rise/Fall instance.</span>

<span class="sd">        This constructor allows custom attributes for Rise/Fall-specific contracts </span>
<span class="sd">        and sets default values if attributes are not specified.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        **kwargs : dict</span>
<span class="sd">            Customizable attributes such as `stake_type`, `contract_type`, `payout`, `duration`, etc.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">contract_type</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;contract_type&#39;</span><span class="p">,</span> <span class="s1">&#39;CALL&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stake_type</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;stake_type&#39;</span><span class="p">,</span> <span class="s1">&#39;stake&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">payout</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;payout&#39;</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">duration</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;duration&#39;</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">duration_unit</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;duration_unit&#39;</span><span class="p">,</span> <span class="s1">&#39;m&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">user_input_params</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;stake&#39;</span><span class="p">,</span> <span class="s1">&#39;symbol&#39;</span><span class="p">,</span> <span class="s1">&#39;duration&#39;</span><span class="p">,</span> <span class="s1">&#39;duration_unit&#39;</span><span class="p">,</span> <span class="s1">&#39;contract_type&#39;</span><span class="p">,</span> <span class="s1">&#39;stake_type&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">is_step</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;is_step&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span></div>


<div class="viewcode-block" id="RiseFall.randomise_attributes">
<a class="viewcode-back" href="../index.html#mvapi.RiseFall.randomise_attributes">[docs]</a>
    <span class="k">def</span> <span class="nf">randomise_attributes</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Randomizes the attributes of the Rise/Fall contract instance.</span>

<span class="sd">        Adjusts attributes such as duration, contract type, stake, and symbol based on preset </span>
<span class="sd">        conditions and ranges.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">symbol</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">symbols</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_step</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">symbol</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">([</span><span class="s1">&#39;stpRNG&#39;</span><span class="p">,</span> <span class="s1">&#39;stpRNG2&#39;</span><span class="p">,</span> <span class="s1">&#39;stpRNG3&#39;</span><span class="p">,</span> <span class="s1">&#39;stpRNG4&#39;</span><span class="p">,</span> <span class="s1">&#39;stpRNG5&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">duration_unit</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">([</span><span class="s1">&#39;t&#39;</span><span class="p">,</span> <span class="s1">&#39;s&#39;</span><span class="p">,</span> <span class="s1">&#39;m&#39;</span><span class="p">,</span> <span class="s1">&#39;h&#39;</span><span class="p">,</span> <span class="s1">&#39;d&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">contract_type</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">([</span><span class="s1">&#39;CALL&#39;</span><span class="p">,</span> <span class="s1">&#39;CALLE&#39;</span><span class="p">,</span> <span class="s1">&#39;PUT&#39;</span><span class="p">,</span> <span class="s1">&#39;PUTE&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">duration</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">11</span><span class="p">)</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">duration_unit</span> <span class="o">==</span> <span class="s1">&#39;t&#39;</span> <span class="k">else</span> \
                        <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">86401</span><span class="p">)</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">duration_unit</span> <span class="o">==</span> <span class="s1">&#39;s&#39;</span> <span class="k">else</span> \
                        <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1441</span><span class="p">)</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">duration_unit</span> <span class="o">==</span> <span class="s1">&#39;m&#39;</span> <span class="k">else</span> \
                        <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">25</span><span class="p">)</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">duration_unit</span> <span class="o">==</span> <span class="s1">&#39;h&#39;</span> <span class="k">else</span> \
                        <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">366</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stake</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2000</span><span class="p">),</span> <span class="n">BO</span><span class="p">[</span><span class="s1">&#39;currency_precision&#39;</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">currency</span><span class="p">])</span></div>


<div class="viewcode-block" id="RiseFall._proposal">
<a class="viewcode-back" href="../index.html#mvapi.RiseFall._proposal">[docs]</a>
    <span class="k">def</span> <span class="nf">_proposal</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Generates a JSON-encoded proposal for the Rise/Fall contract.</span>

<span class="sd">        Creates a proposal dictionary using instance attributes. Adds `take_profit` </span>
<span class="sd">        and `stop_loss` limits if set.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        str</span>
<span class="sd">            A JSON-encoded string representing a proposal.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">proposal</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">proposal_type</span> <span class="o">==</span> <span class="s1">&#39;price_proposal&#39;</span><span class="p">:</span>
            <span class="n">proposal</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;proposal&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
                <span class="s2">&quot;amount&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">stake</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">stake_type</span> <span class="o">==</span> <span class="s1">&#39;stake&#39;</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">payout</span><span class="p">,</span>
                <span class="s2">&quot;basis&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">stake_type</span><span class="p">,</span>
                <span class="s2">&quot;contract_type&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">contract_type</span><span class="p">,</span>
                <span class="s2">&quot;currency&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">currency</span><span class="p">,</span>
                <span class="s2">&quot;symbol&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">symbol</span><span class="p">,</span>
                <span class="s2">&quot;duration&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">duration</span><span class="p">,</span>
                <span class="s2">&quot;duration_unit&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">duration_unit</span>
            <span class="p">}</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">take_profit</span><span class="p">:</span>
                <span class="n">insert_dict</span><span class="p">(</span><span class="n">proposal</span><span class="p">,</span> <span class="s1">&#39;limit_order&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;take_profit&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">take_profit</span><span class="p">})</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">stop_loss</span><span class="p">:</span>
                <span class="n">insert_dict</span><span class="p">(</span><span class="n">proposal</span><span class="p">,</span> <span class="s1">&#39;limit_order&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;stop_loss&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">stop_loss</span><span class="p">})</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">_proposal</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">proposal</span><span class="p">)</span></div>


<div class="viewcode-block" id="RiseFall.check_bid">
<a class="viewcode-back" href="../index.html#mvapi.RiseFall.check_bid">[docs]</a>
    <span class="k">def</span> <span class="nf">check_bid</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">runs</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">show</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Validates bid price calculations for all proposals over multiple runs.</span>

<span class="sd">        The method calculates the correct bid prices based on internal financial </span>
<span class="sd">        models and compares them to the stored or API-provided values.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        runs : int, optional</span>
<span class="sd">            Number of additional random contracts to validate. Default is 0.</span>
<span class="sd">        show : bool, optional</span>
<span class="sd">            If True, displays proposals with bid checks that failed. Default is False.</span>
<span class="sd">        **kwargs : dict, optional</span>
<span class="sd">            Custom parameters to override when generating random contracts.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        - The results are stored in `self.stats[&#39;bid_check&#39;]` categorized into:</span>
<span class="sd">          `total`, `expired`, `sold`, and `bid`.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">runs</span><span class="p">):</span>
            <span class="n">clear_output</span><span class="p">(</span><span class="n">wait</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">buy_contract</span><span class="p">(</span><span class="n">random</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_all_poc</span><span class="p">()</span>
        <span class="n">clear_output</span><span class="p">(</span><span class="n">wait</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stats</span><span class="p">[</span><span class="s1">&#39;bid_check&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;total&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;cases&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;pass&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;fail&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">},</span>
            <span class="s1">&#39;expired&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;cases&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;pass&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;fail&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">},</span>
            <span class="s1">&#39;sold&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;cases&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;pass&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;fail&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">},</span>
            <span class="s1">&#39;bid&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;cases&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;pass&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;fail&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">}</span>
        <span class="p">}</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">messages</span><span class="p">:</span>
            <span class="k">if</span> <span class="s1">&#39;msg_type&#39;</span> <span class="ow">in</span> <span class="n">item</span> <span class="ow">and</span> <span class="n">item</span><span class="p">[</span><span class="s1">&#39;msg_type&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;proposal_open_contract&#39;</span> <span class="ow">and</span> <span class="s1">&#39;error&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">item</span> <span class="ow">and</span> \
                    <span class="n">item</span><span class="p">[</span><span class="s1">&#39;proposal_open_contract&#39;</span><span class="p">][</span><span class="s1">&#39;contract_type&#39;</span><span class="p">]</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;CALL&#39;</span><span class="p">,</span> <span class="s1">&#39;CALLE&#39;</span><span class="p">,</span> <span class="s1">&#39;PUT&#39;</span><span class="p">,</span> <span class="s1">&#39;PUTE&#39;</span><span class="p">]</span> <span class="ow">and</span> <span class="s1">&#39;entry_tick&#39;</span> <span class="ow">in</span> <span class="n">item</span><span class="p">[</span><span class="s1">&#39;proposal_open_contract&#39;</span><span class="p">]:</span>
                <span class="n">temp_dict</span> <span class="o">=</span> <span class="p">{}</span>
                <span class="n">temp_dict</span><span class="p">[</span><span class="s1">&#39;bid&#39;</span><span class="p">],</span> <span class="n">temp_dict</span><span class="p">[</span><span class="s1">&#39;bid_check&#39;</span><span class="p">],</span> <span class="n">temp_dict</span><span class="p">[</span><span class="s1">&#39;close_flag&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">risefall_bid</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
                <span class="n">insert_dict</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="s1">&#39;mv&#39;</span><span class="p">,</span> <span class="n">temp_dict</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">stats</span><span class="p">[</span><span class="s1">&#39;bid_check&#39;</span><span class="p">][</span><span class="n">temp_dict</span><span class="p">[</span><span class="s1">&#39;close_flag&#39;</span><span class="p">]][</span><span class="s1">&#39;cases&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">stats</span><span class="p">[</span><span class="s1">&#39;bid_check&#39;</span><span class="p">][</span><span class="s1">&#39;total&#39;</span><span class="p">][</span><span class="s1">&#39;cases&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="k">if</span> <span class="n">item</span><span class="p">[</span><span class="s1">&#39;mv&#39;</span><span class="p">][</span><span class="s1">&#39;bid_check&#39;</span><span class="p">]:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">stats</span><span class="p">[</span><span class="s1">&#39;bid_check&#39;</span><span class="p">][</span><span class="n">temp_dict</span><span class="p">[</span><span class="s1">&#39;close_flag&#39;</span><span class="p">]][</span><span class="s1">&#39;pass&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">stats</span><span class="p">[</span><span class="s1">&#39;bid_check&#39;</span><span class="p">][</span><span class="s1">&#39;total&#39;</span><span class="p">][</span><span class="s1">&#39;pass&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">stats</span><span class="p">[</span><span class="s1">&#39;bid_check&#39;</span><span class="p">][</span><span class="n">temp_dict</span><span class="p">[</span><span class="s1">&#39;close_flag&#39;</span><span class="p">]][</span><span class="s1">&#39;fail&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">stats</span><span class="p">[</span><span class="s1">&#39;bid_check&#39;</span><span class="p">][</span><span class="s1">&#39;total&#39;</span><span class="p">][</span><span class="s1">&#39;fail&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">item</span><span class="p">[</span><span class="s1">&#39;mv&#39;</span><span class="p">][</span><span class="s1">&#39;bid_check&#39;</span><span class="p">]</span> <span class="ow">and</span> <span class="n">show</span><span class="p">:</span>
                    <span class="n">display</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stats_bid</span> <span class="o">=</span> <span class="n">dict_to_df</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stats</span><span class="p">[</span><span class="s1">&#39;bid_check&#39;</span><span class="p">],</span> <span class="s1">&#39;Bid&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">stats_bid</span></div>


<div class="viewcode-block" id="RiseFall.check_payout">
<a class="viewcode-back" href="../index.html#mvapi.RiseFall.check_payout">[docs]</a>
    <span class="k">def</span> <span class="nf">check_payout</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">runs</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">show</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Validates payout accuracy for Rise/Fall contracts.</span>

<span class="sd">        This method computes the payout for saved and random contracts and compares </span>
<span class="sd">        it to API-provided values.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        runs : int, optional</span>
<span class="sd">            Number of additional random contracts to validate. Default is 0.</span>
<span class="sd">        show : bool, optional</span>
<span class="sd">            If True, displays contracts with failed payout validations. Default is False.</span>
<span class="sd">        **kwargs : dict, optional</span>
<span class="sd">            Custom parameters to override when generating random contracts.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        pd.DataFrame</span>
<span class="sd">            A DataFrame summarizing payout validation statistics.</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        Stores the validation results in `self.stats[&#39;payout_check&#39;]`.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">runs</span><span class="p">):</span>
            <span class="n">clear_output</span><span class="p">(</span><span class="n">wait</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">buy_contract</span><span class="p">(</span><span class="n">random</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_all_poc</span><span class="p">()</span>
        <span class="n">clear_output</span><span class="p">(</span><span class="n">wait</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stats</span><span class="p">[</span><span class="s1">&#39;payout_check&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;cases&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;pass&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;fail&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">}</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">messages</span><span class="p">:</span>
            <span class="k">if</span> <span class="s1">&#39;msg_type&#39;</span> <span class="ow">in</span> <span class="n">item</span> <span class="ow">and</span> <span class="n">item</span><span class="p">[</span><span class="s1">&#39;msg_type&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;proposal_open_contract&#39;</span> <span class="ow">and</span> <span class="s1">&#39;error&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">item</span> <span class="ow">and</span> \
                    <span class="n">item</span><span class="p">[</span><span class="s1">&#39;proposal_open_contract&#39;</span><span class="p">][</span><span class="s1">&#39;contract_type&#39;</span><span class="p">]</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;CALL&#39;</span><span class="p">,</span> <span class="s1">&#39;CALLE&#39;</span><span class="p">,</span> <span class="s1">&#39;PUT&#39;</span><span class="p">,</span> <span class="s1">&#39;PUTE&#39;</span><span class="p">]</span> <span class="ow">and</span> <span class="s1">&#39;entry_tick&#39;</span> <span class="ow">in</span> <span class="n">item</span><span class="p">[</span><span class="s1">&#39;proposal_open_contract&#39;</span><span class="p">]:</span>
                <span class="n">temp_dict</span> <span class="o">=</span> <span class="p">{}</span>
                <span class="n">temp_dict</span><span class="p">[</span><span class="s1">&#39;payout&#39;</span><span class="p">],</span> <span class="n">temp_dict</span><span class="p">[</span><span class="s1">&#39;payout_check&#39;</span><span class="p">],</span> <span class="n">temp_dict</span><span class="p">[</span><span class="s1">&#39;close_flag&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">risefall_payout</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
                <span class="n">insert_dict</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="s1">&#39;mv&#39;</span><span class="p">,</span> <span class="n">temp_dict</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">stats</span><span class="p">[</span><span class="s1">&#39;payout_check&#39;</span><span class="p">][</span><span class="s1">&#39;cases&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="k">if</span> <span class="n">item</span><span class="p">[</span><span class="s1">&#39;mv&#39;</span><span class="p">][</span><span class="s1">&#39;payout_check&#39;</span><span class="p">]:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">stats</span><span class="p">[</span><span class="s1">&#39;payout_check&#39;</span><span class="p">][</span><span class="s1">&#39;pass&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">stats</span><span class="p">[</span><span class="s1">&#39;payout_check&#39;</span><span class="p">][</span><span class="s1">&#39;fail&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">item</span><span class="p">[</span><span class="s1">&#39;mv&#39;</span><span class="p">][</span><span class="s1">&#39;payout_check&#39;</span><span class="p">]</span> <span class="ow">and</span> <span class="n">show</span><span class="p">:</span>
                    <span class="n">display</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stats_payout</span> <span class="o">=</span> <span class="n">dict_to_df</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stats</span><span class="p">[</span><span class="s1">&#39;payout_check&#39;</span><span class="p">],</span> <span class="s1">&#39;Payout&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">stats_payout</span></div>
</div>


<span class="c1"># def multiplier_barriers(prop) -&gt; float:</span>
<span class="c1">#     &quot;&quot;&quot;</span>
<span class="c1">#     Calculates the ask price for a turbo contract.</span>

<span class="c1">#     Parameters</span>
<span class="c1">#     ----------</span>
<span class="c1">#     symbol : str</span>
<span class="c1">#         The underlying symbol for contract.</span>
<span class="c1">#     spot : float</span>
<span class="c1">#         The current spot price of the instrument.</span>
<span class="c1">#     barrier : float</span>
<span class="c1">#         The barrier level for the contract.</span>
<span class="c1">#     duration_unit : str</span>
<span class="c1">#         The unit of duration, e.g., &#39;t&#39; for ticks, &#39;d&#39; for days, etc.</span>
<span class="c1">#     phi : int</span>
<span class="c1">#         The direction of the contract, 1 for long, -1 for short.</span>

<span class="c1">#     Returns</span>
<span class="c1">#     -------</span>
<span class="c1">#     float</span>
<span class="c1">#         The calculated ask price for the turbo contract.</span>
<span class="c1">#     &quot;&quot;&quot;</span>
<span class="c1">#     tick_comm = &#39;tick_comm_&#39; + (&#39;up&#39; if phi == 1 else &#39;down&#39;)</span>
<span class="c1">#     tick_comm += &#39;_t&#39; if  duration_unit == &#39;t&#39; else  &#39;_d&#39; if duration_unit == &#39;d&#39; else &#39;_i&#39;</span>
<span class="c1">#     sigma = get_sigma(symbol)</span>
<span class="c1">#     is_r = 2 if re.search(re.compile(r&#39;R&#39;), symbol) else 1</span>
<span class="c1">#     if phi == 1:</span>
<span class="c1">#         commup = BO[&#39;turbos&#39;][tick_comm][symbol] * sigma * np.sqrt(is_r/365/86400)</span>
<span class="c1">#         return spot * (1 + commup) - barrier</span>
<span class="c1">#     else:</span>
<span class="c1">#         commdown = BO[&#39;turbos&#39;][tick_comm][symbol] * sigma * np.sqrt(is_r/365/86400)</span>
<span class="c1">#         return barrier - spot * (1 - commdown) </span>

<div class="viewcode-block" id="mult_dc_price">
<a class="viewcode-back" href="../index.html#mvapi.mult_dc_price">[docs]</a>
<span class="k">def</span> <span class="nf">mult_dc_price</span><span class="p">(</span><span class="n">prop</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Computes the dynamically adjusted cancellation (DC) price for a multiplier contract.</span>

<span class="sd">    This function calculates the DC price based on the underlying asset&#39;s details, the </span>
<span class="sd">    multiplier, commission, and other financial parameters. It accounts for the contract </span>
<span class="sd">    type (UP/DOWN), barrier adjustments, and relevant financial formulas.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    prop : dict</span>
<span class="sd">        The proposal data, containing all relevant contract details, such as `multiplier`, </span>
<span class="sd">        `entry_spot`, `current_spot`, `cancellation`, and other properties.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    float</span>
<span class="sd">        The dynamically calculated DC price rounded to the appropriate currency precision.</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    - The calculation involves barrier adjustments, option pricing models, and spot </span>
<span class="sd">      price movement adjustments.</span>
<span class="sd">    - The method also takes into account commission fees and contract multipliers.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">r</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">q</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">symbol</span> <span class="o">=</span> <span class="n">prop</span><span class="p">[</span><span class="s1">&#39;proposal_open_contract&#39;</span><span class="p">][</span><span class="s1">&#39;underlying&#39;</span><span class="p">]</span>
    <span class="n">sigma</span> <span class="o">=</span> <span class="n">get_sigma</span><span class="p">(</span><span class="n">symbol</span><span class="p">)</span>
    <span class="n">stake</span> <span class="o">=</span> <span class="n">get_stake</span><span class="p">(</span><span class="n">prop</span><span class="p">)</span>
    <span class="n">is_r</span> <span class="o">=</span> <span class="mi">2</span> <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;R&#39;</span><span class="p">),</span> <span class="n">symbol</span><span class="p">)</span> <span class="k">else</span> <span class="mi">1</span>
    <span class="n">dt</span> <span class="o">=</span> <span class="n">is_r</span><span class="o">/</span><span class="mi">365</span><span class="o">/</span><span class="mi">86400</span>
    <span class="n">t</span> <span class="o">=</span> <span class="p">(</span><span class="n">prop</span><span class="p">[</span><span class="s1">&#39;proposal_open_contract&#39;</span><span class="p">][</span><span class="s1">&#39;cancellation&#39;</span><span class="p">][</span><span class="s1">&#39;date_expiry&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">prop</span><span class="p">[</span><span class="s1">&#39;proposal_open_contract&#39;</span><span class="p">][</span><span class="s1">&#39;date_start&#39;</span><span class="p">])</span><span class="o">/</span><span class="mi">365</span><span class="o">/</span><span class="mi">86400</span>    
    <span class="k">try</span><span class="p">:</span>
        <span class="n">spot</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">prop</span><span class="p">[</span><span class="s1">&#39;proposal_open_contract&#39;</span><span class="p">][</span><span class="s1">&#39;entry_spot&#39;</span><span class="p">])</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">spot</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">prop</span><span class="p">[</span><span class="s1">&#39;proposal_open_contract&#39;</span><span class="p">][</span><span class="s1">&#39;current_spot&#39;</span><span class="p">])</span>      
    <span class="n">mult</span> <span class="o">=</span> <span class="n">prop</span><span class="p">[</span><span class="s1">&#39;proposal_open_contract&#39;</span><span class="p">][</span><span class="s1">&#39;multiplier&#39;</span><span class="p">]</span>
    <span class="n">comm</span> <span class="o">=</span> <span class="n">BO</span><span class="p">[</span><span class="s1">&#39;multipliers&#39;</span><span class="p">][</span><span class="s1">&#39;commission&#39;</span><span class="p">][</span><span class="n">symbol</span><span class="p">]</span>
    <span class="n">phi</span> <span class="o">=</span> <span class="mi">1</span> <span class="k">if</span> <span class="s1">&#39;UP&#39;</span> <span class="ow">in</span> <span class="n">prop</span><span class="p">[</span><span class="s1">&#39;proposal_open_contract&#39;</span><span class="p">][</span><span class="s1">&#39;contract_type&#39;</span><span class="p">]</span> <span class="k">else</span> <span class="o">-</span><span class="mi">1</span>
    <span class="n">k</span> <span class="o">=</span> <span class="n">spot</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">phi</span> <span class="o">*</span> <span class="n">comm</span><span class="p">)</span> <span class="c1"># barrier adjustment use negative phi in DC as when phi = 1, h&lt;k so phi for barrier adjustment is -1</span>
    <span class="n">h</span> <span class="o">=</span> <span class="n">spot</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">phi</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="n">mult</span><span class="o">-</span><span class="n">comm</span><span class="p">))</span> <span class="c1"># stop out barrier</span>
    <span class="n">h</span> <span class="o">*=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">((</span><span class="mi">1</span> <span class="k">if</span> <span class="n">h</span> <span class="o">&gt;</span> <span class="n">k</span> <span class="k">else</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="mf">0.5826</span><span class="o">*</span><span class="n">sigma</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">dt</span><span class="p">))</span>
    <span class="n">lambda_</span> <span class="o">=</span> <span class="p">(</span><span class="n">r</span> <span class="o">-</span> <span class="n">q</span> <span class="o">+</span> <span class="n">sigma</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">sigma</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">d1</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">spot</span><span class="o">/</span><span class="n">k</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">r</span> <span class="o">-</span> <span class="n">q</span> <span class="o">+</span> <span class="n">sigma</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">t</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">sigma</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">t</span><span class="p">))</span>
    <span class="n">d2</span> <span class="o">=</span> <span class="n">d1</span> <span class="o">-</span> <span class="n">sigma</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
    <span class="n">x1</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">spot</span><span class="o">/</span><span class="n">h</span><span class="p">))</span> <span class="o">/</span> <span class="p">(</span><span class="n">sigma</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">t</span><span class="p">))</span> <span class="o">+</span> <span class="n">lambda_</span> <span class="o">*</span> <span class="n">sigma</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
    <span class="n">y1</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">h</span><span class="o">/</span><span class="n">spot</span><span class="p">))</span> <span class="o">/</span> <span class="p">(</span><span class="n">sigma</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">t</span><span class="p">))</span> <span class="o">+</span> <span class="n">lambda_</span> <span class="o">*</span> <span class="n">sigma</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
    <span class="n">y</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">((</span><span class="n">h</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">spot</span><span class="o">*</span><span class="n">k</span><span class="p">)))</span> <span class="o">/</span> <span class="p">(</span><span class="n">sigma</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">t</span><span class="p">))</span> <span class="o">+</span> <span class="n">lambda_</span> <span class="o">*</span> <span class="n">sigma</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
    <span class="n">doc</span><span class="p">,</span> <span class="n">uop</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span>
    <span class="k">if</span> <span class="n">phi</span><span class="o">==</span><span class="mi">1</span><span class="p">:</span> <span class="c1">#down and out call </span>
        <span class="n">call</span> <span class="o">=</span> <span class="n">spot</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">q</span> <span class="o">*</span> <span class="n">t</span><span class="p">)</span> <span class="o">*</span> <span class="n">norm</span><span class="o">.</span><span class="n">cdf</span><span class="p">(</span><span class="n">d1</span><span class="p">)</span> <span class="o">-</span> <span class="n">k</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">r</span> <span class="o">*</span> <span class="n">t</span><span class="p">)</span> <span class="o">*</span> <span class="n">norm</span><span class="o">.</span><span class="n">cdf</span><span class="p">(</span><span class="n">d2</span><span class="p">)</span>
        <span class="n">dic</span> <span class="o">=</span> <span class="n">spot</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">q</span> <span class="o">*</span> <span class="n">t</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">h</span> <span class="o">/</span> <span class="n">spot</span><span class="p">)</span> <span class="o">**</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">lambda_</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">norm</span><span class="o">.</span><span class="n">cdf</span><span class="p">(</span><span class="n">y</span><span class="p">))</span> <span class="o">-</span> \
        <span class="n">k</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">r</span> <span class="o">*</span> <span class="n">t</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">h</span> <span class="o">/</span> <span class="n">spot</span><span class="p">)</span> <span class="o">**</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">lambda_</span> <span class="o">-</span> <span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">norm</span><span class="o">.</span><span class="n">cdf</span><span class="p">(</span><span class="n">y</span> <span class="o">-</span> <span class="n">sigma</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">t</span><span class="p">))</span>
        <span class="n">doc</span> <span class="o">=</span> <span class="n">call</span> <span class="o">-</span> <span class="n">dic</span> 
    <span class="k">else</span><span class="p">:</span>
        <span class="n">put</span> <span class="o">=</span> <span class="o">-</span><span class="n">spot</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">q</span> <span class="o">*</span> <span class="n">t</span><span class="p">)</span> <span class="o">*</span> <span class="n">norm</span><span class="o">.</span><span class="n">cdf</span><span class="p">(</span><span class="o">-</span><span class="n">d1</span><span class="p">)</span> <span class="o">+</span> <span class="n">k</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">r</span> <span class="o">*</span> <span class="n">t</span><span class="p">)</span> <span class="o">*</span> <span class="n">norm</span><span class="o">.</span><span class="n">cdf</span><span class="p">(</span><span class="o">-</span><span class="n">d2</span><span class="p">)</span>
        <span class="n">uip</span> <span class="o">=</span> <span class="o">-</span><span class="n">spot</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">q</span> <span class="o">*</span> <span class="n">t</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">h</span> <span class="o">/</span> <span class="n">spot</span><span class="p">)</span> <span class="o">**</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">lambda_</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">norm</span><span class="o">.</span><span class="n">cdf</span><span class="p">(</span><span class="o">-</span><span class="n">y</span><span class="p">))</span> <span class="o">+</span> \
        <span class="n">k</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">r</span> <span class="o">*</span> <span class="n">t</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">h</span> <span class="o">/</span> <span class="n">spot</span><span class="p">)</span> <span class="o">**</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">lambda_</span> <span class="o">-</span> <span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">norm</span><span class="o">.</span><span class="n">cdf</span><span class="p">(</span><span class="o">-</span><span class="n">y</span> <span class="o">+</span> <span class="n">sigma</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">t</span><span class="p">))</span>
        <span class="n">uop</span> <span class="o">=</span> <span class="n">put</span> <span class="o">-</span> <span class="n">uip</span>
    <span class="n">dc_comm</span> <span class="o">=</span> <span class="mf">1.05</span>
    <span class="n">dc_price</span> <span class="o">=</span> <span class="nb">round</span><span class="p">((</span><span class="n">doc</span> <span class="o">+</span> <span class="n">uop</span><span class="p">)</span><span class="o">*</span><span class="n">stake</span><span class="o">*</span><span class="n">mult</span><span class="o">/</span><span class="n">spot</span> <span class="o">*</span> <span class="n">dc_comm</span><span class="p">,</span> <span class="n">get_currency_precision</span><span class="p">(</span><span class="n">prop</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">dc_price</span></div>

                                                                                        
<div class="viewcode-block" id="multiplier_payout">
<a class="viewcode-back" href="../index.html#mvapi.multiplier_payout">[docs]</a>
<span class="k">def</span> <span class="nf">multiplier_payout</span><span class="p">(</span><span class="n">prop</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculates the payout and verifies the accuracy of a multiplier contract.</span>

<span class="sd">    Based on the contract&#39;s details, this function calculates the payout (`bid` price),</span>
<span class="sd">    examines whether the actual payout matches the expected payout, and checks for </span>
<span class="sd">    the close flag (e.g., whether the contract has been sold).</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    prop : dict</span>
<span class="sd">        The proposal data as a dictionary.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    tuple</span>
<span class="sd">        A tuple containing:</span>
<span class="sd">        - bid (float): The computed payout (`bid` price) for the contract.</span>
<span class="sd">        - dc_price (float): The dynamically adjusted cancellation price, if applicable.</span>
<span class="sd">        - match_flag (bool): A flag indicating whether the calculated payout matches the server&#39;s offered payout.</span>
<span class="sd">        - close_flag (str): A string indicating whether the contract was &#39;sold&#39; or is in &#39;bid&#39; state.</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    - The calculation adjusts for commission fees and multiplier factors.</span>
<span class="sd">    - If the contract has a `cancellation` property, the dynamically computed DC price</span>
<span class="sd">      is validated against the server&#39;s provided cancellation price.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">stake</span> <span class="o">=</span> <span class="n">get_stake</span><span class="p">(</span><span class="n">prop</span><span class="p">)</span>
    <span class="n">mult</span> <span class="o">=</span> <span class="n">prop</span><span class="p">[</span><span class="s1">&#39;proposal_open_contract&#39;</span><span class="p">][</span><span class="s1">&#39;multiplier&#39;</span><span class="p">]</span>
    <span class="n">phi</span> <span class="o">=</span> <span class="mi">1</span> <span class="k">if</span> <span class="s1">&#39;UP&#39;</span> <span class="ow">in</span> <span class="n">prop</span><span class="p">[</span><span class="s1">&#39;proposal_open_contract&#39;</span><span class="p">][</span><span class="s1">&#39;contract_type&#39;</span><span class="p">]</span> <span class="k">else</span> <span class="o">-</span><span class="mi">1</span>
    <span class="c1"># display(prop)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">entry</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">prop</span><span class="p">[</span><span class="s1">&#39;proposal_open_contract&#39;</span><span class="p">][</span><span class="s1">&#39;entry_spot&#39;</span><span class="p">])</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">entry</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">prop</span><span class="p">[</span><span class="s1">&#39;proposal_open_contract&#39;</span><span class="p">][</span><span class="s1">&#39;current_spot&#39;</span><span class="p">])</span>     
    <span class="n">symbol</span> <span class="o">=</span> <span class="n">prop</span><span class="p">[</span><span class="s1">&#39;proposal_open_contract&#39;</span><span class="p">][</span><span class="s1">&#39;underlying&#39;</span><span class="p">]</span>
    <span class="n">api_bid</span> <span class="o">=</span> <span class="n">prop</span><span class="p">[</span><span class="s1">&#39;proposal_open_contract&#39;</span><span class="p">][</span><span class="s1">&#39;bid_price&#39;</span><span class="p">]</span>
    <span class="n">api_profit</span> <span class="o">=</span>  <span class="n">prop</span><span class="p">[</span><span class="s1">&#39;proposal_open_contract&#39;</span><span class="p">][</span><span class="s1">&#39;profit&#39;</span><span class="p">]</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">spot</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">prop</span><span class="p">[</span><span class="s1">&#39;proposal_open_contract&#39;</span><span class="p">][</span><span class="s1">&#39;exit_tick&#39;</span><span class="p">])</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">spot</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">prop</span><span class="p">[</span><span class="s1">&#39;proposal_open_contract&#39;</span><span class="p">][</span><span class="s1">&#39;current_spot&#39;</span><span class="p">])</span>
    <span class="n">comm</span> <span class="o">=</span> <span class="n">BO</span><span class="p">[</span><span class="s1">&#39;multipliers&#39;</span><span class="p">][</span><span class="s1">&#39;commission&#39;</span><span class="p">][</span><span class="n">symbol</span><span class="p">]</span>
    <span class="n">bid</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="p">(((</span><span class="n">phi</span> <span class="o">*</span> <span class="p">(</span><span class="n">spot</span> <span class="o">-</span> <span class="n">entry</span><span class="p">))</span> <span class="o">/</span> <span class="n">entry</span><span class="p">)</span> <span class="o">-</span> <span class="n">comm</span><span class="p">)</span> <span class="o">*</span> <span class="n">mult</span><span class="p">)</span> <span class="o">*</span> <span class="n">stake</span>
    <span class="n">profit</span> <span class="o">=</span> <span class="n">bid</span> <span class="o">-</span> <span class="n">stake</span>
    <span class="n">match_flag</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">bid</span><span class="p">,</span> <span class="n">get_currency_precision</span><span class="p">(</span><span class="n">prop</span><span class="p">))</span> <span class="o">==</span> <span class="n">api_bid</span> <span class="ow">and</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">bid</span> <span class="o">-</span> <span class="n">stake</span><span class="p">,</span> <span class="n">get_currency_precision</span><span class="p">(</span><span class="n">prop</span><span class="p">))</span> <span class="o">==</span> <span class="n">api_profit</span>
    <span class="n">close_flag</span> <span class="o">=</span> <span class="s1">&#39;sold&#39;</span> <span class="k">if</span> <span class="s1">&#39;exit_tick&#39;</span> <span class="ow">in</span> <span class="n">prop</span><span class="p">[</span><span class="s1">&#39;proposal_open_contract&#39;</span><span class="p">]</span> <span class="k">else</span> <span class="s1">&#39;bid&#39;</span>
    <span class="n">dc_price</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">if</span> <span class="s1">&#39;cancellation&#39;</span> <span class="ow">in</span> <span class="n">prop</span><span class="p">[</span><span class="s1">&#39;proposal_open_contract&#39;</span><span class="p">]:</span>
        <span class="n">dc_price</span> <span class="o">=</span> <span class="n">mult_dc_price</span><span class="p">(</span><span class="n">prop</span><span class="p">)</span>
        <span class="n">match_flag</span> <span class="o">=</span> <span class="n">dc_price</span> <span class="o">==</span> <span class="n">prop</span><span class="p">[</span><span class="s1">&#39;proposal_open_contract&#39;</span><span class="p">][</span><span class="s1">&#39;cancellation&#39;</span><span class="p">][</span><span class="s1">&#39;ask_price&#39;</span><span class="p">]</span> <span class="ow">and</span> <span class="n">match_flag</span>
    <span class="k">return</span> <span class="n">bid</span><span class="p">,</span> <span class="n">dc_price</span><span class="p">,</span> <span class="n">match_flag</span><span class="p">,</span> <span class="n">close_flag</span></div>


<div class="viewcode-block" id="Multiplier">
<a class="viewcode-back" href="../index.html#mvapi.Multiplier">[docs]</a>
<span class="k">class</span> <span class="nc">Multiplier</span><span class="p">(</span><span class="n">Product</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A class to represent a Multiplier product, inheriting from the Product class.</span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">    species : str</span>
<span class="sd">        The type of the product, always &#39;Multiplier&#39;.</span>
<span class="sd">    contract_type : str</span>
<span class="sd">        The type of contract, default is &#39;MULTUP&#39;.</span>
<span class="sd">    growth_rate : float</span>
<span class="sd">        The growth rate of the accumulator, default is 0.05.</span>

<span class="sd">    Methods</span>
<span class="sd">    -------</span>
<span class="sd">    randomise_attributes()</span>
<span class="sd">        Randomises the attributes of the instance.</span>
<span class="sd">    _proposal()</span>
<span class="sd">        Generates a JSON-encoded proposal specific to the Multiplier product.</span>
<span class="sd">    check_payout(runs=0, show=False, **kwargs)</span>
<span class="sd">        Validates payout conditions over a specified number of runs.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="n">species</span> <span class="o">=</span> <span class="s2">&quot;Multiplier&quot;</span>
    
<div class="viewcode-block" id="Multiplier.__init__">
<a class="viewcode-back" href="../index.html#mvapi.Multiplier.__init__">[docs]</a>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initializes a Multiplier instance.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        **kwargs : dict</span>
<span class="sd">            Keyword arguments to initialize the instance attributes. Expected keys include:</span>
<span class="sd">            - &#39;growth_rate&#39;: (float) The growth rate, defaults to 0.05.</span>
<span class="sd">            - &#39;contract_type&#39;: (str) The type of contract, defaults to &#39;MULTUP&#39;.</span>
<span class="sd">            - &#39;multiplier&#39;: (int) The multiplier value, defaults to 10.</span>
<span class="sd">            - &#39;cancellation&#39;: (int) Cancellation value, defaults to 0.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>
<span class="sd">        &quot;&quot;&quot;</span>      
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">contract_type</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;contract_type&#39;</span><span class="p">,</span> <span class="s1">&#39;MULTUP&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">multiplier</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;multiplier&#39;</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cancellation</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;cancellation&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">user_input_params</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;stake&#39;</span><span class="p">,</span> <span class="s1">&#39;symbol&#39;</span><span class="p">,</span> <span class="s1">&#39;multiplier&#39;</span><span class="p">,</span> <span class="s1">&#39;contract_type&#39;</span><span class="p">,</span> <span class="s1">&#39;cancellation&#39;</span><span class="p">]</span></div>


<div class="viewcode-block" id="Multiplier.randomise_attributes">
<a class="viewcode-back" href="../index.html#mvapi.Multiplier.randomise_attributes">[docs]</a>
    <span class="k">def</span> <span class="nf">randomise_attributes</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Randomises the attributes of the Multiplier instance.</span>

<span class="sd">        Sets the symbol to a random choice from the available symbols, </span>
<span class="sd">        the stake to a random value within the defined range, and</span>
<span class="sd">        the multiplier and cancellation values from predefined lists.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">symbol</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">symbols</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stake</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">BO</span><span class="p">[</span><span class="s1">&#39;accumulators&#39;</span><span class="p">][</span><span class="s1">&#39;max_stake&#39;</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">currency</span><span class="p">]),</span> <span class="n">BO</span><span class="p">[</span><span class="s1">&#39;currency_precision&#39;</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">currency</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">contract_type</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">([</span><span class="s1">&#39;MULTUP&#39;</span><span class="p">,</span> <span class="s1">&#39;MULTDOWN&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">multiplier</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">BO</span><span class="p">[</span><span class="s1">&#39;multipliers&#39;</span><span class="p">][</span><span class="s1">&#39;multiplier&#39;</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">symbol</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cancellation</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">BO</span><span class="p">[</span><span class="s1">&#39;multipliers&#39;</span><span class="p">][</span><span class="s1">&#39;cancellation&#39;</span><span class="p">]</span><span class="o">+</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span></div>


<div class="viewcode-block" id="Multiplier._proposal">
<a class="viewcode-back" href="../index.html#mvapi.Multiplier._proposal">[docs]</a>
    <span class="k">def</span> <span class="nf">_proposal</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Generates a proposal dictionary specific to the Multiplier product.</span>

<span class="sd">        Constructs a proposal dictionary based on the instance&#39;s configured attributes. </span>
<span class="sd">        Includes additional parameters like `take_profit` and `stop_loss` if they are set. </span>
<span class="sd">        The proposal is then JSON-encoded.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        str</span>
<span class="sd">            A JSON string containing the proposal data.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">proposal</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">proposal_type</span> <span class="o">==</span> <span class="s1">&#39;price_proposal&#39;</span><span class="p">:</span>
            <span class="n">proposal</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;proposal&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
                <span class="s2">&quot;basis&quot;</span><span class="p">:</span> <span class="s1">&#39;stake&#39;</span><span class="p">,</span>
                <span class="s2">&quot;amount&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">stake</span><span class="p">,</span>
                <span class="s2">&quot;contract_type&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">contract_type</span><span class="p">,</span>
                <span class="s2">&quot;currency&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">currency</span><span class="p">,</span>
                <span class="s2">&quot;symbol&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">symbol</span><span class="p">,</span>
                <span class="s2">&quot;multiplier&quot;</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">multiplier</span><span class="p">,</span>
            <span class="p">}</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">take_profit</span><span class="p">:</span>
                <span class="n">insert_dict</span><span class="p">(</span><span class="n">proposal</span><span class="p">,</span> <span class="s1">&#39;limit_order&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;take_profit&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">take_profit</span><span class="p">})</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">stop_loss</span><span class="p">:</span>
                <span class="n">insert_dict</span><span class="p">(</span><span class="n">proposal</span><span class="p">,</span> <span class="s1">&#39;limit_order&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;stop_loss&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">stop_loss</span><span class="p">})</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cancellation</span><span class="p">:</span>
                <span class="n">insert_dict</span><span class="p">(</span><span class="n">proposal</span><span class="p">,</span> <span class="s1">&#39;cancellation&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cancellation</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">_proposal</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">proposal</span><span class="p">)</span></div>

    
    <span class="c1"># def check_barriers(self, runs=0, show=False, **kwargs) -&gt; None:</span>
    <span class="c1">#     &quot;&quot;&quot;</span>
    <span class="c1">#     Checks barrier conditions for all saved proposals and the given number of runs.</span>

    <span class="c1">#     Randomises attributes and generates price proposals for the specified number of runs.</span>
    <span class="c1">#     Analyzes messages to check if barriers are accurate and displays the results.</span>

    <span class="c1">#     Parameters</span>
    <span class="c1">#     ----------</span>
    <span class="c1">#     runs : int</span>
    <span class="c1">#         The number of times to run the check.</span>
    <span class="c1">#     show : bool</span>
    <span class="c1">#         If True, displays messages with failed barrier checks.</span>
    <span class="c1">#     **kwargs : dict</span>
    <span class="c1">#         Additional keyword arguments for setting attributes.</span>

    <span class="c1">#     Returns</span>
    <span class="c1">#     -------</span>
    <span class="c1">#     None</span>
    <span class="c1">#     &quot;&quot;&quot;</span>
    <span class="c1">#     for i in range(runs):</span>
    <span class="c1">#         clear_output(wait = True)</span>
    <span class="c1">#         self.randomise_attributes()</span>
    <span class="c1">#         self._set_attributes(**kwargs)</span>
    <span class="c1">#         self.price_proposal()</span>
    <span class="c1">#     clear_output(wait = True)</span>
    <span class="c1">#     self.accu_barrier_stats = {&#39;cases&#39;: 0, &#39;pass&#39;: 0, &#39;fail&#39;: 0}        </span>
    <span class="c1">#     for item in self.messages:</span>
    <span class="c1">#         if &#39;msg_type&#39; in item and item[&#39;msg_type&#39;] == &#39;proposal&#39; and &#39;error&#39; not in item and &#39;ACCU&#39; in item[&#39;echo_req&#39;][&#39;contract_type&#39;]:</span>
    <span class="c1">#             temp_dict = {}</span>
    <span class="c1">#             temp_dict[&#39;high_barrier&#39;], temp_dict[&#39;low_barrier&#39;], temp_dict[&#39;barrier_spot_distance&#39;], temp_dict[&#39;barrier_check&#39;] = accu_barriers(item)</span>
    <span class="c1">#             insert_dict(item, &#39;mv&#39;, temp_dict)</span>
    <span class="c1">#             self.accu_barrier_stats[&#39;cases&#39;] += 1</span>
    <span class="c1">#             if item[&#39;mv&#39;][&#39;barrier_check&#39;]: </span>
    <span class="c1">#                 self.accu_barrier_stats[&#39;pass&#39;] += 1</span>
    <span class="c1">#             else: </span>
    <span class="c1">#                 self.accu_barrier_stats[&#39;fail&#39;] += 1                </span>
    <span class="c1">#             if not item[&#39;mv&#39;][&#39;barrier_check&#39;] and show:</span>
    <span class="c1">#                 display(item)</span>

    <span class="c1">#     self.stats_barrier = dict_to_df(self.accu_barrier_stats, &#39;Barriers&#39;)   </span>
    <span class="c1">#     return self.stats_barrier</span>
        
<div class="viewcode-block" id="Multiplier.check_payout">
<a class="viewcode-back" href="../index.html#mvapi.Multiplier.check_payout">[docs]</a>
    <span class="k">def</span> <span class="nf">check_payout</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">runs</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">show</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Validates payout conditions for all saved proposals over multiple runs.</span>

<span class="sd">        Executes buy contracts with randomized or user-configured attributes for the </span>
<span class="sd">        specified number of runs and analyzes the resulting messages.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        runs : int, optional</span>
<span class="sd">            The number of iterations to validate payout conditions, defaults to 0.</span>
<span class="sd">        show : bool, optional</span>
<span class="sd">            If True, displays messages with failed payout checks, defaults to False.</span>
<span class="sd">        **kwargs : dict</span>
<span class="sd">            Additional keyword arguments to set attributes during the validation process.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">runs</span><span class="p">):</span>
            <span class="n">clear_output</span><span class="p">(</span><span class="n">wait</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">buy_contract</span><span class="p">(</span><span class="n">random</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_all_poc</span><span class="p">()</span> 
        <span class="n">clear_output</span><span class="p">(</span><span class="n">wait</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stats</span><span class="p">[</span><span class="s1">&#39;payout_check&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;total&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;cases&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;pass&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;fail&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">},</span>
            <span class="s1">&#39;sold&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;cases&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;pass&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;fail&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">},</span>
            <span class="s1">&#39;bid&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;cases&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;pass&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;fail&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">}</span>
        <span class="p">}</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">messages</span><span class="p">:</span>
            <span class="k">if</span> <span class="s1">&#39;msg_type&#39;</span> <span class="ow">in</span> <span class="n">item</span> <span class="ow">and</span> <span class="n">item</span><span class="p">[</span><span class="s1">&#39;msg_type&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;proposal_open_contract&#39;</span> <span class="ow">and</span> <span class="s1">&#39;error&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">item</span> <span class="ow">and</span> \
            <span class="s1">&#39;MULT&#39;</span> <span class="ow">in</span> <span class="n">item</span><span class="p">[</span><span class="s1">&#39;proposal_open_contract&#39;</span><span class="p">][</span><span class="s1">&#39;contract_type&#39;</span><span class="p">]:</span>
                <span class="n">temp_dict</span> <span class="o">=</span> <span class="p">{}</span>
                <span class="n">temp_dict</span><span class="p">[</span><span class="s1">&#39;payout&#39;</span><span class="p">],</span> <span class="n">temp_dict</span><span class="p">[</span><span class="s1">&#39;cancellation&#39;</span><span class="p">],</span> <span class="n">temp_dict</span><span class="p">[</span><span class="s1">&#39;payout_check&#39;</span><span class="p">],</span> <span class="n">temp_dict</span><span class="p">[</span><span class="s1">&#39;close_flag&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">multiplier_payout</span><span class="p">(</span><span class="n">item</span><span class="p">)</span> 
                <span class="n">insert_dict</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="s1">&#39;mv&#39;</span><span class="p">,</span> <span class="n">temp_dict</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">stats</span><span class="p">[</span><span class="s1">&#39;payout_check&#39;</span><span class="p">][</span><span class="n">temp_dict</span><span class="p">[</span><span class="s1">&#39;close_flag&#39;</span><span class="p">]][</span><span class="s1">&#39;cases&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">stats</span><span class="p">[</span><span class="s1">&#39;payout_check&#39;</span><span class="p">][</span><span class="s1">&#39;total&#39;</span><span class="p">][</span><span class="s1">&#39;cases&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="k">if</span> <span class="n">item</span><span class="p">[</span><span class="s1">&#39;mv&#39;</span><span class="p">][</span><span class="s1">&#39;payout_check&#39;</span><span class="p">]:</span> 
                    <span class="bp">self</span><span class="o">.</span><span class="n">stats</span><span class="p">[</span><span class="s1">&#39;payout_check&#39;</span><span class="p">][</span><span class="n">temp_dict</span><span class="p">[</span><span class="s1">&#39;close_flag&#39;</span><span class="p">]][</span><span class="s1">&#39;pass&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">stats</span><span class="p">[</span><span class="s1">&#39;payout_check&#39;</span><span class="p">][</span><span class="s1">&#39;total&#39;</span><span class="p">][</span><span class="s1">&#39;pass&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="k">else</span><span class="p">:</span> 
                    <span class="bp">self</span><span class="o">.</span><span class="n">stats</span><span class="p">[</span><span class="s1">&#39;payout_check&#39;</span><span class="p">][</span><span class="n">temp_dict</span><span class="p">[</span><span class="s1">&#39;close_flag&#39;</span><span class="p">]][</span><span class="s1">&#39;fail&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>  
                    <span class="bp">self</span><span class="o">.</span><span class="n">stats</span><span class="p">[</span><span class="s1">&#39;payout_check&#39;</span><span class="p">][</span><span class="s1">&#39;total&#39;</span><span class="p">][</span><span class="s1">&#39;fail&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">item</span><span class="p">[</span><span class="s1">&#39;mv&#39;</span><span class="p">][</span><span class="s1">&#39;payout_check&#39;</span><span class="p">]</span> <span class="ow">and</span> <span class="n">show</span><span class="p">:</span>
                    <span class="n">display</span><span class="p">(</span><span class="n">item</span><span class="p">)</span> 
        <span class="bp">self</span><span class="o">.</span><span class="n">stats_payout</span> <span class="o">=</span> <span class="n">dict_to_df</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stats</span><span class="p">[</span><span class="s1">&#39;payout_check&#39;</span><span class="p">],</span> <span class="s1">&#39;Payout&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">stats_payout</span></div>
</div>



<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">run_gui</span><span class="p">()</span>
</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2024, Matthew-Deriv, VishalMenon-Deriv.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>